var windowDevicePixelRatio=window.devicePixelRatio;!function(e){var t,o,s,i,r,a=(o=(t=e).backingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,(window.devicePixelRatio||1)/o);1!==a&&(!function(t,e){for(var o in t)t.hasOwnProperty(o)&&e(t[o],o)}({fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all"},function(s,t){var i;e[t]=(i=e[t],function(){var t,e,o=Array.prototype.slice.call(arguments);if("all"===s)o=o.map(function(t){return t*a});else if(Array.isArray(s))for(t=0,e=s.length;t<e;t++)o[s[t]]*=a;return i.apply(this,o)})}),e.stroke=(s=e.stroke,function(){this.lineWidth*=a,s.apply(this,arguments),this.lineWidth/=a}),e.fillText=(i=e.fillText,function(){var t=Array.prototype.slice.call(arguments);t[1]*=a,t[2]*=a,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,e,o){return e*a+o}),4<=t.length&&1<a&&(t[3]*=a),i.apply(this,t),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,e,o){return e/a+o})}),e.strokeText=(r=e.strokeText,function(){var t=Array.prototype.slice.call(arguments);t[1]*=a,t[2]*=a,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,e,o){return e*a+o}),r.apply(this,t),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,e,o){return e/a+o})}))}(CanvasRenderingContext2D.prototype),function(t){var i;t.getContext=(i=t.getContext,function(t){var e,o,s=i.call(this,t);return"2d"===t&&(e=s.backingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1,1<(o=(windowDevicePixelRatio||1)/e)&&"true"!=$(this).attr("val")&&!($(this).attr("class")||"").match("geetest_absolute")&&(""!=this.style.height&&Number(this.style.height.replace("px",""))*o==this.height||(this.style.height=this.height+"px",this.style.width=this.width+"px",this.width*=o,this.height*=o,$(this).attr("val",!0)))),s})}(HTMLCanvasElement.prototype),window.MouseWheel={addMouseWheelHandler:function(t,s){var e=function(t){var e=(t=t||window.event).wheelDelta||-t.deltaY||-t.detail,o=Math.max(-1,Math.min(1,e));s(t,o,o,o)},o=t.get(0);document.addEventListener?(o.addEventListener("mousewheel",e,!1),o.addEventListener("wheel",e,!1),o.addEventListener("DOMMouseScroll",e,!1)):o.attachEvent("onmousewheel",e)},removeMouseWheelHandler:function(){var t=query.get(0);document.addEventListener?(t.removeEventListener("mousewheel",MouseWheelHandler,!1),t.removeEventListener("wheel",MouseWheelHandler,!1),t.removeEventListener("DOMMouseScroll",MouseWheelHandler,!1)):t.detachEvent("onmousewheel",MouseWheelHandler)},stopDefault:function(t){return t&&t.preventDefault?t.preventDefault():window.event.returnValue=!1,!1}},function(r){"use strict";var i=function(t,e){};i.prototype={constructor:i,init:function(t,e,o){var s,i;this.type=t,this.$element=r(e),this.options=this.getOptions(o),this.enabled=!0,"manual"!=this.options.trigger&&(s="hover"==this.options.trigger?"mouseenter":"focus",i="hover"==this.options.trigger?"mouseleave":"blur",this.$element.on(s,this.options.selector,r.proxy(this.enter,this)),this.$element.on(i,this.options.selector,r.proxy(this.leave,this))),this.options.selector?this._options=r.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return(t=r.extend({},r.fn[this.type].defaults,t,this.$element.data())).delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var e=r(t.currentTarget)[this.type](this._options).data(this.type);e.options.delay&&e.options.delay.show?(e.hoverState="in",setTimeout(function(){"in"==e.hoverState&&e.show()},e.options.delay.show)):e.show()},leave:function(t){var e=r(t.currentTarget)[this.type](this._options).data(this.type);e.options.delay&&e.options.delay.hide?(e.hoverState="out",setTimeout(function(){"out"==e.hoverState&&e.hide()},e.options.delay.hide)):e.hide()},show:function(){var t,e,o,s,i,r,a;if(this.hasContent()&&this.enabled){switch(t=this.tip(),this.setContent(),this.options.animation&&t.addClass("fade"),r="function"==typeof this.options.placement?this.options.placement.call(this,t[0],this.$element[0]):this.options.placement,e=/in/.test(r),t.remove().css({top:0,left:0,display:"block"}).appendTo(e?this.$element:document.body),o=this.getPosition(e),s=t[0].offsetWidth,i=t[0].offsetHeight,e?r.split(" ")[1]:r){case"bottom":a={top:o.top+o.height,left:o.left+o.width/2-s/2};break;case"top":a={top:o.top-i,left:o.left+o.width/2-s/2};break;case"left":a={top:o.top+o.height/2-i/2,left:o.left-s};break;case"right":a={top:o.top+o.height/2-i/2,left:o.left+o.width}}t.css(a).addClass(r).addClass("in")}},setContent:function(){var t=this.tip();t.find(".tooltip-inner").html(this.getTitle()),t.removeClass("fade in top bottom left right")},hide:function(){var t,e=this.tip();e.removeClass("in"),r.support.transition&&this.$tip.hasClass("fade")?(t=setTimeout(function(){e.off(r.support.transition.end).remove()},500),e.one(r.support.transition.end,function(){clearTimeout(t),e.remove()})):e.remove()},fixTitle:function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return r.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var t=this.$element,e=this.options;return(t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)).toString().replace(/(^\s*|\s*$)/,"")},tip:function(){return this.$tip=this.$tip||r(this.options&&this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}},r.fn.tooltip=function(s){return this.each(function(){var t=r(this),e=t.data("tooltip"),o="object"==typeof s&&s;e||t.data("tooltip",e=new i(this,o)),"string"==typeof s&&e[s]()})},r.fn.tooltip.Constructor=i,r.fn.tooltip.defaults={animation:!0,delay:0,selector:!1,placement:"top",trigger:"hover",title:"",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}}(window.jQuery);var Langs={};function getLang(){var t=localStorage.lang||"cn";return Langs[t]||Langs.en}Langs.en={time:"æ—¶é—´",open:"å¼€ç›˜",high:"æœ€é«˜",low:"æœ€ä½Ž",close:"æ”¶ç›˜",increase:"æ¶¨å¹…",swing:"æŒ¯å¹…",volume:"VOL",quoteVolume:"è½¬è®©é¢",hand:"æ¢æ‰‹çŽ‡",o:"å¼€",h:"é«˜",l:"ä½Ž",c:"æ”¶",price:"ä»·æ ¼",updown:"æ¶¨è·Œ",rang:"å¹…åº¦"},Langs.cn={time:"æ—¶é—´",open:"å¼€ç›˜",high:"æœ€é«˜",low:"æœ€ä½Ž",close:"æ”¶ç›˜",increase:"æ¶¨å¹…",swing:"æŒ¯å¹…",volume:"æˆäº¤é‡",quoteVolume:"æˆäº¤é¢",hand:"æ¢æ‰‹çŽ‡",o:"å¼€",h:"é«˜",l:"ä½Ž",c:"æ”¶",price:"ä»·æ ¼",updown:"æ¶¨è·Œ",rang:"å¹…åº¦"};var BASE_URL="http://localhost/rtbtc-dev/",DATA_URL="http://localhost/rtbtc-dev/",DEBUG=!0,OFFLINE=!1,BJBTC_Class=function(o,t,s){var e=null;function i(){var u={url:""+o,debug:!1,offline:!!s,lang:"en",accounts:{},has_api:!1,prefsAccount:"",expires:millitime()+60,expires_id:-1,base:"",base_int:1,base_prec:8,quote:"CNY",quote_int:1,quote_prec:4,exch_fee:{mtgox:.0065,bitstamp:.005,btce:.002},token:"",version:"0.0.0",startTime:millitime(),offset:0,exchange:"bitstamp",exch_list:["bitstamp","btce"],handlers:{},title:""+window.document.title,ERROR:1,WARNING:2,MESSAGE:3,windows:[]};function f(t,e){if(u.handlers.hasOwnProperty(t))for(var o=0;o<u.handlers[t].length;o++)u.handlers[t][o][1](e)}var t=function(t,e){switch(e){case u.ERROR:console.error(t);break;case u.WARNING:console.warn(t);break;case u.MESSAGE:default:console.log(t)}throw{}};var d=function(t){void 0!==t.t0&&void 0!==t.t1&&void 0!==t.t2&&void 0!==t.t3&&f("timing",{latency:(-t.t0+t.t1-t.t2+t.t3)/2,processing:t.t2-t.t1})};for(var a=[""],n=[""],e=1;e<=30;e++)n.push(n[e-1]+"&nbsp;"),a.push(a[e-1]+"0");return{token:function(t){return null==t?u.token:(u.token=t,this)},account:function(){return u.accounts[u.exchange]},accounts:function(t){for(var e in u.accounts={},t)u.exch_list.indexOf(e)<0||(u.accounts[e]=t[e]);return this},prefsAccount:function(t){return null==t?u.prefsAccount:(u.prefsAccount=t,this)},hasApi:function(){return u.accounts.hasOwnProperty(u.exchange)},startTime:function(){return u.startTime},offset:function(t){return null==t?u.offset:(u.offset=t.client-t.server,this)},expires:function(t){return null==t?u.expires:(u.expires=+t+u.offset,2147483647<1e3*(e=u.expires-millitime())||(window.clearTimeout(u.expires_id),u.expires_id=window.setTimeout(function(){window.location.reload()},1e3*e)),this);var e},ajax:function(t,e,o,s,i){var r,a,n,l,c;return void 0!==t&&(r=t,a=e,n=o,l=s,c=i,$.ajax({async:!0,type:"POST",dataType:"json",crossDomain:!1,url:u.url+"api/"+r,data:{payload:a,token:u.token,aid:u.accounts[u.exchange],t0:millitime()},success:function(t,e,o){var s=millitime();if(void 0!==t.result){if(void 0!==t.timing&&d({t0:parseFloat(t.timing.t0),t1:parseFloat(t.timing.t1),t2:parseFloat(t.timing.t2),t3:s}),void 0!==t.token&&(u.token=$.trim(t.token)),void 0!==t.version){var i=$.trim(t.version);i!=u.version&&window.setTimeout(function(){f("version",i)},5e3)}if("success"==t.result)"function"==typeof n&&n(t.data);else if(void 0!==t.reason)switch(t.reason){case"session":case"auth":!OFFLINE&&window.location.reload();break;default:"function"==typeof l&&l(t.reason)}else"function"==typeof l&&l()}else"function"==typeof c&&c()},error:function(t,e,o){"function"==typeof c&&c()}})),this},json:function(t,e,o){var s,i,r;return void 0!==t&&(s=t,i=e,r=o,$.ajax({url:s,type:"GET",dataType:"json",success:function(t,e,o){"function"==typeof i&&i(t)},error:function(t,e,o){"function"==typeof r&&r()}})),this},base:function(){return u.base},quote:function(){return u.quote},symbol:function(){return u.base+"/"+u.quote},baseInt:function(){return u.base_int},quoteInt:function(){return u.quote_int},basePrec:function(){return u.base_prec},quotePrec:function(){return u.quote_prec},instrument:function(t,e,o){try{t=t.toLowerCase(),e=e.toUpperCase(),o=o.toUpperCase()}catch(t){return this}var s={exch:""+u.exchange,base:""+u.base,quote:""+u.quote};return u.exchange=t,u.base=e,u.quote=o,f("instrument",{old_instr:s,new_instr:{exch:u.exchange,base:u.base,quote:u.quote}}),this},version:function(t){if(null==t)return u.version;u.version=t;for(var e=0;e<75;e++)"=";return this},url:function(){return u.url},language:function(t){return null==t?u.lang:(u.lang=t,f("language",u.lang),this)},handler:function(t,e,o){return u.handlers.hasOwnProperty(t)||(u.handlers[t]=[]),u.handlers[t].push([e,o]),this},unregister:function(t,e,o){if(u.handlers.hasOwnProperty(t)){var s,i=void 0===o;for(s=u.handlers[t].length-1;0<=s;s--)u.handlers[t][s][0]==e&&(i||u.handlers[t][s][1]==o)&&u.handlers[t].splice(s,1);return this}},unregisterAll:function(t){var e,o;for(o in u.handlers)if(u.handlers.hasOwnProperty(o))for(e=u.handlers[o].length-1;0<=e;e--)u.handlers[o][e][0]==t&&u.handlers[o].splice(e,1)},trigger:function(t,e){f(t,e)},countdown:function(t,e){$(t).each(function(t,e){$(e).data("time",parseInt($(this).attr("name"))).removeAttr("name")});var o=function(t,i){$(t).each(function(t,e){var o=Math.max($(e).data("time"),0),s=i?dhms_from_sec(o):hms_from_sec(o);return $(e).text(s),$(e).data("time",o-1),!0})};window.setInterval(function(){o(t,e)},1e3),o(t,e)},toggle:function(t,o,s,i){return $("<span/>").addClass("control-toggle").addClass(function(){return t?"yes":"no"}).append(function(){return'<i class="icon-'+(t?"ok":"remove")+'"></i>'}).data("state",t).click(function(t){var e=$(t.currentTarget);e.data("state")?(e.data("state",!1).removeClass("yes").addClass("no").html('<i class="icon-remove"></i>'),"function"==typeof s&&s()):(e.data("state",!0).removeClass("no").addClass("yes").html('<i class="icon-ok"></i>'),"function"==typeof o&&o()),"function"==typeof i&&i(),stopEvent(t)})},select:function(e,t,o,s){var i,r,a=$("<select/>").on("change",function(t){o(t.currentTarget.value),s&&(t.currentTarget.value=e)});for(i=0;i<t.length;i++)r=$("<option/>").html(t[i].text).attr("value",t[i].val),t[i].val==e&&r.attr("selected","selected"),a.append(r);return a},numFormat:function(t,e){if(void 0===t)return"";var o=null==e?Settings.display.precision.price:e,s=t.toFixed(o),i=s.length,r=1;for(isNaN(s)&&(s="0.0");r<e;){if("0"!=s.charAt(i-r)){if(1==r)return s;break}r++}return Settings.display.zeros?s.slice(0,i-r+1)+'<span class="insig">'+a[r-1]+"</span>":s.slice(0,i-r+1)+n[r-1]},numFormatShort:function(t,e){if(void 0===t)return"";var o=null==e?Settings.display.precision.price:e,s=t.toFixed(o),i=s.length,r=1;for(isNaN(s)&&(s="0.0");r<e;){if("0"!=s.charAt(i-r)){if(1==r)return s;break}r++}return s.slice(0,i-r+1)},siteTitle:function(t){window.document.title=t+u.title},newWindow:function(){return u.windows.append(window.open(u.url+"s/platform/window",uniqueID())),this},regUnsignedNum:new RegExp(/^\d*\.?\d*$/),internals:function(){return null},debug:u.debug?t:function(t,e){},isDebug:function(){return u.debug},offline:function(){return u.offline},ERROR:u.ERROR,WARNING:u.WARNING,MESSAGE:u.MESSAGE,ZEROS:a,SPACES:n}}return new function(){this.Build=function(){return null==e&&((e=new i).constructor=null),e}}}(BASE_URL,0,OFFLINE),BJBTC=BJBTC_Class.Build(),BTC="&#3647;",BTC_U="à¸¿",BTC_INT=1;function log10(t){return Math.log(t)/Math.LN10}function millitime(){return(new Date).getTime()/1e3}function hms_from_epoch_ms(t,e){var o,s,i,r="",a=null;try{a=new Date(t),i=e?(o=a.getHours(),s=a.getMinutes(),a.getSeconds()):(o=a.getUTCHours(),s=a.getUTCMinutes(),a.getUTCSeconds()),r+=(o<10?"0"+o:o)+":",r+=(s<10?"0"+s:s)+":",r+=i<10?"0"+i:i}catch(t){r="00:00:00"}return r}function formatted_date(t,e,o){var s=new Date(1e3*t),i="";return!0===o?(e&&(i=s.getFullYear()+"-"),i+=s.getMonth()+1<10?"0":"",i+=s.getMonth()+1+"-",i+=s.getDate()<10?"0":"",i+=s.getDate()):(e&&(i=s.getUTCFullYear()+"-"),i+=s.getUTCMonth()+1<10?"0":"",i+=s.getUTCMonth()+1+"-",i+=s.getUTCDate()<10?"0":"",i+=s.getUTCDate()),i}function timestamp(t){null!=t&&void 0!==t||(t=!0);var e,o,s,i=new Date,r="";return s=t?(e=i.getHours(),o=i.getMinutes(),i.getSeconds()):(e=i.getUTCHours(),o=i.getUTCMinutes(),i.getUTCSeconds()),r+=(e<10?"0"+e:e)+":",r+=(o<10?"0"+o:o)+":",r+=s<10?"0"+s:s}function hms_from_sec(t){var e="",o=t%60,s=(t-o)/60%60,i=(t-60*s-o)/3600%3600;return e+=(i<10?"0"+i:i)+":",e+=(s<10?"0"+s:s)+":",e+=o<10?"0"+o:o}function dhms_from_sec(t){var e,o,s,i,r="",a=t;return a-=86400*(e=Math.floor(a/86400)),a-=3600*(o=Math.floor(a/3600)),r+=0<e?e+":":"",r+=(o<10?"0"+o:o)+":",r+=((s=Math.floor(a/60))<10?"0"+s:s)+":",r+=(i=a-60*s)<10?"0"+i:i}function time_delta_print(t){var e,o,s,i="",r=t;return r|=0,r-=86400*(e=Math.floor(r/86400)),r-=3600*(o=Math.floor(r/3600)),s=Math.floor(r/60),2<=e?i=e+" days":1<=e?(i=e+" day, "+o+" hour",1<o&&(i+="s")):1<=o?(i=o+" hour",1<o&&(i+="s")):i=1<=s?s+" min":r-60*s+" sec",i+" ago"}function numberWithCommas(t){var e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}function delayClass(t,e,o){window.setTimeout(function(){$(t).removeClass(e)},o)}function deepCopy(t){return $.extend(!0,{},t)}function AssertException(t){this.message=t}function assert(t,e){if(!t)throw new AssertException(e)}function stopEvent(t){try{t.preventDefault(),t.stopPropagation()}catch(t){}}function NoBreak(t){return t.replace(/ /g,"&nbsp;")}function HTMLEncode(t){return $("<div/>").text(t).html()}function HTMLDecode(t){return $("<div/>").html(t).text()}function clearingSpan(){return $("<span/>").addClass("clear").html("&nbsp;")}function clearingSpanHTML(){return'<span class="clear">&nbsp;</span>'}AssertException.prototype.toString=function(){return"AssertException: "+this.message};var lastUniqueID=0;function uniqueID(){return"id"+lastUniqueID++}function randInt(t){return Math.floor(Math.random()*t)}function randRange(t,e){return Math.floor(Math.random()*(e-t))+t}var alphabet="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split(""),alphalen=alphabet.length;function randomString(t){"number"!=typeof t&&(t=10);var e=0,o="";for(e=0;e<t;e++)o+=alphabet[randInt(alphalen)];return o}function storageSupport(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}}function wsSupport(){try{return!!window.WebSocket}catch(t){return!1}}function locationOf(t,e,o,s,i){null==o&&(o=0),null==s&&(s=e.length-1),"string"==typeof i&&("gt"==i?i=function(t,e){return e<t}:"lt"==i&&(i=function(t,e){return t<e}));var r=parseInt(o+(s-o)/2);return e[r]==t?{index:r,exact:!0}:s-o<=1?{index:r+1,exact:!1}:i(e[r],t)?locationOf(t,e,r,s,i):locationOf(t,e,o,r,i)}function has_worker(){return!!window.Worker}function pixel_ratio(){return window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1}Object.size=function(t){var e,o=0;for(e in t)t.hasOwnProperty(e)&&o++;return o},Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,o=Number(arguments[1])||0;for((o=o<0?Math.ceil(o):Math.floor(o))<0&&(o+=e);o<e;o++)if(o in this&&this[o]===t)return o;return-1});var has_dataURI=function(){return!1};!function(){var t=new Image;t.onload=function(){1==this.width&&1==this.height&&(has_dataURI=function(){return!0})},t.onerror=function(){},t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}(),function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.reqAnimFrame=void 0!==t?t:function(t){t()}}(),(window.jQuery||window.Zepto).cookie=function(t,e,o){if(1<arguments.length&&"[object Object]"!==String(e)){if(o=(window.jQuery||window.Zepto).extend({},o),null==e&&(o.expires=-1),"number"==typeof o.expires){var s=o.expires,i=o.expires=new Date;i.setDate(i.getDate()+s)}return e=String(e),document.cookie=[encodeURIComponent(t),"=",o.raw?e:encodeURIComponent(e),o.expires?"; expires="+o.expires.toUTCString():"",o.path?"; path="+o.path:"",o.domain?"; domain="+o.domain:"",o.secure?"; secure":""].join("")}var r,a=(o=e||{}).raw?function(t){return t}:decodeURIComponent;return(r=new RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)").exec(document.cookie))?a(r[1]):null};var Colors={c:{stroke:{fenshi:"#ffffff",up:"#ff0000",down:"#3AA60C",bid:"#4dd710",ask:"#d00017",grid:"#252522",border:"#333",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#ff00ff","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191919",up:"#ff0000",down:"#3AA60C",label:"#9EA694",flags:"#191919",crosshair:"#191919",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},c1:{stroke:{fenshi:"#ffffff",up:"#d00017",down:"#4dd710",bid:"#d00017",ask:"#4dd710",grid:"#252522",border:"#333",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191919",up:"#3AA60C",down:"#A10013",label:"#9EA694",flags:"#191919",crosshair:"#191919",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},f:{stroke:{up:"#00a1d9",down:"#ed111a",bid:"#ed111a",ask:"#00a1d9",grid:"#d5e4eb",border:"#014d65",order:"#014d65",majorlevel:"#014d65",minorlevel:"#014d65",crosshair:"#040f12",i:["#00a1d9","#ed111a","#014d65","#c60","#6c0","#0cc","#cc0","#0c0"]},fill:{bg:"#d5e4eb",up:"#00ACE5",down:"#FF121A",label:"#09232B",flags:"#F2F8FA",crosshair:"#fff",blankBG:"#fff",flagtext:"#040f12",ordertext:"#014d65",slottext:"#040f12"}},m:{stroke:{up:"#9C6",down:"#B40000",bid:"#7A1631",ask:"#89D12A",grid:"#454545",border:"#616161",order:"#014d65",majorlevel:"#014d65",minorlevel:"#014d65",crosshair:"#ffc200",i:["#ffc200","#0099cc","#014d65","#c60","#6c0","#0cc","#cc0","#0c0"]},fill:{bg:"#0f0f0f",up:"#658744",down:"#750000",label:"#F4FFE4",flags:"#0f0f0f",crosshair:"#0f0f0f",blankBG:"#0f0f0f",flagtext:"#F4FFE4",ordertext:"#014d65",slottext:"#F4FFE4"}},t:{stroke:{up:"#498192",down:"#daa102",bid:"#daa102",ask:"#498192",grid:"#0d1e29",border:"#014d65",order:"#014d65",majorlevel:"#014d65",minorlevel:"#014d65",crosshair:"#040f12",i:["#498192","#daa102","#014d65","#c60","#6c0","#0cc","#cc0","#0c0"]},fill:{bg:"#05232c",up:"#d6f7fb",down:"#f9f15f",label:"#daa102",flags:"#F2F8FA",crosshair:"#fff",blankBG:"#050b0f",flagtext:"#040f12",ordertext:"#014d65",slottext:"#040f12"}},s:{stroke:{up:"#999",down:"#000",bid:"#333",ask:"#999",grid:"#ddd",border:"#000",order:"#014d65",majorlevel:"#ccc",minorlevel:"#ddd",crosshair:"#000",i:["#aaa","#999","#ccc","#777"]},fill:{bg:"#fff",up:"#bbb",down:"#333",label:"#333",flags:"#fff",crosshair:"#fff",blankBG:"#fff",flagtext:"#000",ordertext:"#014d65",slottext:"#000"}},a:{stroke:{up:"#d00017",down:"#4dd710",bid:"#4dd710",ask:"#d00017",grid:"#d3d3d3",border:"#999999",order:"red",majorlevel:"#666",minorlevel:"#666",crosshair:"#008fdb",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#ffffff",up:"#A10013",down:"#3AA60C",label:"#999999",flags:"#ffffff",crosshair:"#ffffff",blankBG:"#ffffff",flagtext:"#999999",ordertext:"#ffc200",slottext:"#165d82"}},a1:{stroke:{fenshi:"#267cd1",up:"#f24957",down:"#1dbf60",bid:"#4dd710",ask:"#d00017",grid:"#d3d3d3",border:"#999999",arrow:"#008fbd",order:"red",opacity:!0,majorlevel:"#666",minorlevel:"#666",crosshair:"#008fdb",i:["#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#ffffff",up:"#f24957",down:"#1dbf60",label:"#999999",flags:"#ffffff",crosshair:"#ffffff",blankBG:"#ffffff",flagtext:"#999999",ordertext:"#ffc200",slottext:"#165d82"}},a2:{stroke:{fenshi:"#267cd1",up:"#f24957",down:"#1dbf60",bid:"#4dd710",ask:"#d00017",grid:"#d3d3d3",border:"#999999",arrow:"#008fbd",order:"red",priceShow:!0,opacity:!0,majorlevel:"#666",minorlevel:"#666",crosshair:"#008fdb",i:["#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#ffffff",up:"#f24957",down:"#1dbf60",label:"#999999",flags:"#ffffff",crosshair:"#ffffff",blankBG:"#ffffff",flagtext:"#999999",ordertext:"#ffc200",slottext:"#165d82"}},"depth-white":{stroke:{up:"#d00017",down:"#ff6c78",bid:"#70a800",ask:"#ff6c78",grid:"#dedede",border:"#dedede",order:"#f0b90b",majorlevel:"blue",minorlevel:"blue",crosshair:"#f5bc00",orderHighLine:"#333333",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#ffffff",up:"#ff6c78",down:"#70a800",label:"#999999",flags:"#191919",crosshair:"#fff",blankBG:"#ffffff",flagtext:"#666666",ordertext:"#f0b90b",slottext:"blue",order:"#e6e6e6"}},"chart-white2":{stroke:{fenshi:"#267cd1",up:"#70a800",fillUp:"#73c921",down:"#ea0070",bid:"#79b48a",ask:"#f32f3f",grid:"#f1f1f1",border:"#f1f1f1",arrow:"#444",order:"red",majorlevel:"#666",minorlevel:"#666",crosshair:"#008fdb",i:["#ffc200","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#ffffff",up:"#70a800",down:"#ea0070",label:"#999999",flags:"#ffffff",crosshair:"#ffffff",blankBG:"#ffffff",flagtext:"#999999",ordertext:"#ffc200",slottext:"#165d82"}},"depth-black-bnb":{stroke:{up:"#d00017",down:"#4dd710",bid:"#a3ff61",ask:"#ff3394",grid:"#1d1d1d",border:"#333",order:"#ffffff",majorlevel:"#666",minorlevel:"#666",crosshair:"#deac37",orderHighLine:"#f0b90b",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#131722",up:"#ff3394",down:"#00C087",label:"#9EA694",flags:"#191919",crosshair:"#191919",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffffff",slottext:"#999",order:"#333333"}},"depth-black-bnb-pro":{stroke:{up:"#d00017",down:"#4dd710",bid:"#a3ff61",ask:"#ff3394",grid:"#1d1d1d",border:"#333",order:"#ffffff",majorlevel:"#666",minorlevel:"#666",crosshair:"#deac37",orderHighLine:"#f0b90b",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#262d33",up:"#ff3394",down:"#a3ff61",label:"#9EA694",flags:"#191919",crosshair:"#191919",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffffff",slottext:"#999",order:"#333333"}},"depth-black-mobile-bnb":{stroke:{up:"#d00017",down:"#4dd710",bid:"#a3ff61",ask:"#ff3394",grid:"#262d33",border:"#333",order:"#ffffff",majorlevel:"#666",minorlevel:"#666",crosshair:"#f5bc00",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191d21",up:"#ff3394",down:"#a3ff61",label:"#9EA694",flags:"#191919",crosshair:"#191919",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffffff",slottext:"#f4ffe4"}},"chart-black-bnb":{stroke:{fenshi:"#ffffff",up:"#70a800",down:"#ea0070",bid:"#4dd710",ask:"#d00017",grid:"#262626",border:"#333",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#ff00ff","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#1d1d1d",up:"#70a800",down:"#ea0070",label:"#9EA694",flags:"#1d1d1d",crosshair:"#1d1d1d",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},"chart-black-bnb-pro":{stroke:{fenshi:"#ffffff",up:"#70a800",down:"#ea0070",bid:"#4dd710",ask:"#d00017",grid:"#31383d",border:"#31383d",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#ff00ff","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#262d33",up:"#70a800",down:"#ea0070",label:"#9EA694",flags:"#1d1d1d",crosshair:"#1d1d1d",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},"chart-black-mobile-bnb":{stroke:{fenshi:"#ffffff",up:"#73c921",down:"#ca2c78",bid:"#4dd710",ask:"#d00017",grid:"#323c45",border:"#323c45",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#262d33",up:"#73c921",down:"#ca2c78",label:"#9EA694",flags:"#262d33",crosshair:"#262d33",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},"depth-black-ico":{stroke:{fenshi:"#ffffff",up:"#4dd710",down:"#d00017",bid:"#4dd710",ask:"#d00017",grid:"#252522",border:"#333",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191919",up:"#A10013",down:"#3AA60C",label:"#9EA694",flags:"#191919",crosshair:"#191919",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},"chart-black-ico":{stroke:{fenshi:"#ffffff",up:"#3AA60C",down:"#ff0000",bid:"#4dd710",ask:"#d00017",grid:"#323c45",border:"#333",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191919",up:"#3AA60C",down:"#ff0000",label:"#9EA694",flags:"#191919",crosshair:"#262d33",blankBG:"#191919",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},"chart-black-zql":{stroke:{fenshi:"#ffffff",up:"#3AA60C",down:"#ff0000",bid:"#4dd710",ask:"#d00017",grid:"#323c45",border:"#333",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191919",up:"#3AA60C",down:"#ff0000",label:"#9EA694",flags:"#191919",crosshair:"#262d33",blankBG:"#191919",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},"chart-black-mobile-zql":{stroke:{fenshi:"#ffffff",up:"#00c087",down:"#ea0070",bid:"#4dd710",ask:"#d00017",grid:"#323c45",border:"#323c45",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191d21",up:"#00c087",down:"#ea0070",label:"#9EA694",flags:"#262d33",crosshair:"#262d33",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},"depth-black-zql":{stroke:{fenshi:"#ffffff",up:"#4dd710",down:"#d00017",bid:"#4dd710",ask:"#d00017",grid:"#252522",border:"#333",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191919",up:"#A10013",down:"#3AA60C",label:"#9EA694",flags:"#191919",crosshair:"#191919",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},"depth-black-mobile-zql":{stroke:{up:"#d00017",down:"#4dd710",bid:"#a3ff61",ask:"#ff3394",grid:"#323c45",border:"#333",order:"#ffffff",majorlevel:"#666",minorlevel:"#666",crosshair:"#f5bc00",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191d21",up:"#ff3394",down:"#a3ff61",label:"#9EA694",flags:"#191919",crosshair:"#191919",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffffff",slottext:"#f4ffe4"}},"chart-black-dae":{stroke:{fenshi:"#ffffff",up:"#00c087",down:"#ea0070",bid:"#4dd710",ask:"#d00017",grid:"#323c45",border:"#323c45",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191919",up:"#00c087",down:"#ea0070",label:"#9EA694",flags:"#262d33",crosshair:"#262d33",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},"chart-black-mobile-dae":{stroke:{fenshi:"#ffffff",up:"#00c087",down:"#ea0070",bid:"#4dd710",ask:"#d00017",grid:"#323c45",border:"#323c45",arrow:"#fff",order:"#ffc200",majorlevel:"#666",minorlevel:"#666",crosshair:"#fff",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191d21",up:"#00c087",down:"#ea0070",label:"#9EA694",flags:"#262d33",crosshair:"#262d33",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffc200",slottext:"#f4ffe4"}},"depth-black-dae":{stroke:{up:"#d00017",down:"#4dd710",bid:"#a3ff61",ask:"#ff3394",grid:"#323c45",border:"#333",order:"#ffffff",majorlevel:"#666",minorlevel:"#666",crosshair:"#f5bc00",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#262d33",up:"#ff3394",down:"#a3ff61",label:"#9EA694",flags:"#191919",crosshair:"#191919",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffffff",slottext:"#f4ffe4"}},"depth-black-mobile-dae":{stroke:{up:"#d00017",down:"#4dd710",bid:"#a3ff61",ask:"#ff3394",grid:"#323c45",border:"#333",order:"#ffffff",majorlevel:"#666",minorlevel:"#666",crosshair:"#f5bc00",i:["#0066cc","#ffc200","#6600cc","#cc0066","#00cccc","#CC401D","#fff385","#9665cc","#cc5c79","#cc9056","#86ccb6"]},fill:{bg:"#191d21",up:"#ff3394",down:"#a3ff61",label:"#9EA694",flags:"#191919",crosshair:"#191919",blankBG:"#0A0A09",flagtext:"#f4ffe4",ordertext:"#ffffff",slottext:"#f4ffe4"}}},Validator=function(){var e=null,o=null,s=1,i=2,r=3,a=4,n=(BJBTC.debug,function(t){switch(o){case s:if("boolean"==typeof t)return e=t,!0;break;case i:if("number"==typeof t)return e=parseInt(t),!0;break;case r:if("number"==typeof t)return e=parseFloat(t),!0;break;case a:if("string"==typeof t)return e=""+t,!0}return!1});return{create:function(t){if(t===s&&(o=t),t===i&&(o=t),t===r&&(o=t),t===a&&(o=t),null==o)throw"Invalid type.";return{get:function(){return e},set:function(t){return n(t),this},toString:function(){return""+e}}},BOOL:s,INT:i,FLOAT:r,STRING:a}},V=new Validator,Settings={base:"BTC",quote:"USD",exchange:"mtgox",display:{precision:{price:5,volume:4},zeros:!0,grid:5},sounds:{},localTime:!0,theme:"c",version:"0.0.0",layouts:[{name:"Market Overview",modules:[{m:{t:"order-book",w:478,h:478,x:510,y:100,l:!0},c:{g:!0,i:.01,s:!0,d:50}},{m:{t:"time-sales",w:488,h:178,x:10,y:400,l:!0},c:{f:!0,s:!0}},{m:{t:"ticker",w:478,h:78,x:510,y:10,l:!0},c:{a:!0,h:!0,l:!0,v:!0}},{m:{t:"orders",w:488,h:108,x:10,y:280,l:!0},c:{}},{m:{t:"order-entry",w:238,h:258,x:10,y:10,l:!0},c:{b:!0,c:!0,l:!1}},{m:{t:"order-entry",w:238,h:258,x:260,y:10,l:!0},c:{b:!1,c:!0,l:!1}}]}]},Settings_Helper=function(){var l=(new Validator).create(V.BOOL),c=(new Validator).create(V.INT),u=((new Validator).create(V.FLOAT),(new Validator).create(V.STRING)),f={},d={dpp:Settings.display.precision.price,dpv:Settings.display.precision.volume,dz:Settings.display.zeros,dg:Settings.display.grid,b:Settings.base,q:Settings.quote,ex:Settings.exchange,lt:Settings.localTime,thm:Settings.theme,snd:Settings.sounds,version:Settings.version},p=(BJBTC.debug,function(t,e,o){return void 0===f[t]?e:o.set(e).set(f[t]).get()});return{process:function(t){return function(t){f=t,Settings.display.precision.price=p("dpp",d.dpp,c),Settings.display.precision.volume=p("dpv",d.dpv,c),Settings.display.zeros=p("dz",d.dz,l),Settings.display.grid=p("dg",d.dg,c),Settings.display.grid=5,Settings.localTime=p("lt",d.lt,l),Settings.theme=p("thm",d.thm,u),Settings.version=p("version",d.version,u);var e=p("b",d.b,u);Currency.valid(e)&&(Settings.base=e);var o=p("q",d.q,u);Currency.valid(o)&&(Settings.quote=o);var s=p("ex",d.ex,u);if(Exchanges.valid(s)&&(Settings.exchange=s),Settings.sounds=t.hasOwnProperty("snd")?t.snd:{},void 0!==t.layouts&&0<t.layouts.length){var i,r;Settings.layouts=[];for(var a=0;a<t.layouts.length;a++){if(i={},void 0!==t.layouts[a].name&&0<t.layouts[a].name.length&&(i.name=""+t.layouts[a].name),void 0!==t.layouts[a].modules){i.modules=[];for(var n=0;n<t.layouts[a].modules.length;n++)r={m:{},c:{}},void 0!==t.layouts[a].modules[n].m&&(r.m=t.layouts[a].modules[n].m),void 0!==t.layouts[a].modules[n].c&&(r.c=t.layouts[a].modules[n].c),i.modules.push(deepCopy(r))}Settings.layouts.push(deepCopy(i))}}}(t),this},save:function(){var t={};for(var e in d)d.hasOwnProperty(e)&&(t[e]=d[e]);return t.layouts=Settings.layouts,JSON.stringify(t)},saveToStructure:function(t,e){d[t]=e}}}();function _(t,e){return t}var mobile,i18n={Account:{ru:"ÑÑ‡ÐµÑ‚",de:"Konto",cn:"å¸æˆ·",pl:"konto",vi:"Tï¿½i kho?n",da:"konto",es:"",sv:"",fi:"",bg:"",it:""},Close:{ru:"?????????",de:"schlieï¿½en",cn:"??",pl:"zamkn??",vi:"?ï¿½ng",da:"Luk",es:"",sv:"",fi:"",bg:"",it:""},Settings:{ru:"?????????",de:"Einstellungen",cn:"??",pl:"Ustawienia",vi:"Cï¿½i ??t",da:"Indstillinger",es:"",sv:"",fi:"",bg:"",it:""},Layout:{ru:"????????????",de:"Layout",cn:"??",pl:"uk?ad",vi:"Giao di?n",da:"Layout",es:"",sv:"",fi:"",bg:"",it:""},Locking:{ru:"??????????",de:"Sperren",cn:"??",pl:"Blokowanie",vi:"khï¿½a",da:"Lï¿½sning",es:"",sv:"",fi:"",bg:"",it:""},"Place Order":{ru:"?????????? ?????",de:"Bestellung aufgeben",cn:"???",pl:"Z?ï¿½? zamï¿½wienie",vi:"??t th? t?",da:"Afgiv ordre",es:"",sv:"",fi:"",bg:"",it:""},Sending:{ru:"??????????",de:"Senden",cn:"??",pl:"wysy?anie",vi:"g?i",da:"Sende",es:"",sv:"",fi:"",bg:"",it:""},Bid:{ru:"???",de:"Geld",cn:"??",pl:"oferta",vi:"Giï¿½ th?u",da:"Bud",es:"",sv:"",fi:"",bg:"",it:""},Ask:{ru:"???",de:"Brief","en-gb":"Offer",cn:"?",pl:"zapyta?",vi:"xin",da:"Spï¿½rg",es:"",sv:"",fi:"",bg:"",it:""},Sum:{ru:"?????",de:"Summe",cn:"??",pl:"suma",vi:"Sum",da:"Sum",es:"",sv:"",fi:"",bg:"",it:""},Size:{ru:"??????",de:"Grï¿½ï¿½e",cn:"??",pl:"rozmiar",vi:"Kï¿½ch th??c",da:"Stï¿½rrelse",es:"",sv:"",fi:"",bg:"",it:""}},Data_Class=function(){var t=null;function e(){var l={cache:{bars:{},ticks:[],ticker:{}},links:{},currentPeriod:60,online:[2592e3,604800,259200,86400,43200,21600,14400,7200,3600,1800,900,300,180,60],offline:[2592e3,604800,259200,86400,43200,21600,14400,7200,3600,1800,900,300,180,60],lock:{},storage:null,hasStorage:storageSupport(),config:{saveTimeout:3e4,saveID:-1,tradeCount:0,tradeSave:100,tradeBuffer:1500,ticksMaxAge:300},self:null,debug:BJBTC.isDebug()},a=BJBTC.debug,n="/api/v1";function e(){l.hasStorage&&(l.storage=window.localStorage),function(){var t,e,o=BJBTC.base(),s=BJBTC.quote();for(l.cache.ticks=[],l.cache.ticker={},e=0;e<l.offline.length;e++)t=l.offline[e],l.cache.bars[t]=[];for(e=0;e<l.online.length;e++)t=l.online[e],l.links[t]={prev:null,next:null,last:null},l.lock[t]=!1;if(c(l.currentPeriod,!0),l.hasStorage){var i=o+s+"_ticks";if(void 0!==l.storage[i]){var r=JSON.parse(l.storage[i]);r.hasOwnProperty("stamp")&&r.stamp+l.config.ticksMaxAge>millitime()&&(l.cache.ticks=r.ticks)}}}()}function c(t,e){if(!l.lock[t]){l.lock[t]=!0;var o,s,i=BJBTC.base(),r=n+"/klines?symbol="+BJBTC.base()+"&interval="+function(t){switch(t){case 0:case 60:return"1m";case 180:return"3m";case 300:return"5m";case 900:return"15m";case 1800:return"30m";case 3600:return"1h";case 7200:return"2h";case 14400:return"4h";case 21600:return"6h";case 43200:return"12h";case 86400:return"1d";case 259200:return"3d";case 604800:return"1w";case 2592e3:return"1M"}}(t);if(null!=l.links[t].prev)r+="&endTime="+l.links[t].prev;else if(!e)return void(l.lock[t]=!1);BJBTC.json(r,(s=t,function(t){i==BJBTC.base()&&function(t,e,o){l.lock[e]=!1,0<=t.length&&l._onLoaded&&l._onLoaded(),t[t.length-1];var s,i=!1;if(0<t.length&&(i=!l.links[e].prev,l.links[e].prev=t[0][0]-1e3*e),BJBTC.trigger("console","Loaded "+t.length+" chart bars."),0!=t.length){for(i&&(l.cache.bars[e]=[]),s=t.length-1;0<=s;s--)l.cache.bars[e].push([t[s][0],Number(t[s][1]),Number(t[s][2]),Number(t[s][3]),Number(t[s][4]),Number(t[s][5]),Number(t[s][7])]);BJBTC.trigger("barclose",e)}}(t,s)}),(o=t,function(t){var e;e=o,(l.lock[e]=!1)&&a("Data: load failure for period "+e+"!")}))}}function u(){if(l.hasStorage){millitime();var t=BJBTC.exchange()+"_"+BJBTC.base()+BJBTC.quote()+"_ticks",e=l.cache.ticks.slice(0,l.config.tradeBuffer),o={};if(0!=e.length){o.stamp=millitime(),o.ticks=e;try{l.storage[t]=JSON.stringify(o)}catch(t){}window.clearTimeout(l.config.saveID),l.config.saveID=-1}}}return{setup:function(t){return"undifined"!=t&&0<=l.online.indexOf(t)&&(l.currentPeriod=t),e(),this},self:function(t){return l.self=t,BJBTC.handler("trade","data",l.self.onTrade),BJBTC.handler("ticker","data",l.self.onTicker),BJBTC.handler("instrument","data",e),this},onTrade:function(t){!function(t){var e,o=[t.time,t.price,t.amount];l.cache.ticks.splice(0,0,o);var s,i,r,a=l.cache.ticks.length,n=l.config.tradeBuffer;for(i in n<a&&l.cache.ticks.splice(n-1,n-a),l.cache.bars)l.cache.bars.hasOwnProperty(i)&&(s=+i,e=(r=+(r=t.time))-r%s,0==l.cache.bars[i].length||e>=l.cache.bars[i][0][0]+s?(l.cache.bars[i].splice(0,0,[e,o[1],o[1],o[1],o[1],o[2]]),BJBTC.trigger("barclose",i)):e==l.cache.bars[i][0][0]&&(o[1]>l.cache.bars[i][0][2]&&(l.cache.bars[i][0][2]=o[1]),o[1]<l.cache.bars[i][0][3]&&(l.cache.bars[i][0][3]=o[1]),l.cache.bars[i][0][4]=o[1],l.cache.bars[i][0][5]+=o[2]));++l.config.tradeCount%l.config.tradeSave==0?u():-1==l.config.saveID&&(l.config.saveID=window.setTimeout(u,l.config.saveTimeout))}(t)},onTicker:function(t){var e;e=t,l.cache.ticker=e},onBar:function(t,e){!function(t,e){if(null!=l.cache.bars[e])if(0<l.cache.bars[e].length){if(t[0]<l.cache.bars[e][0][0])return;if(t[0]==l.cache.bars[e][0][0]&&t[5]<=l.cache.bars[e][0][5])return;t[0]==l.cache.bars[e][0][0]?l.cache.bars[e][0]=t:l.cache.bars[e].splice(0,0,t),BJBTC.trigger("barclose",e)}else l.cache.bars[e].splice(0,0,t),BJBTC.trigger("barclose",e)}(t,e)},onLoaded:function(t){l._onLoaded=t},data:l.cache,loadPrev:function(t){var e=t;if(-1==l.online.indexOf(t))for(var o=0;o<l.online.length;o++)if(l.online[o]<=t){e=l.online[o];break}c(e,!1)},internals:l.debug?function(){return l}:function(){return{}},debug:l.debug?a:function(t,e){}}}return new function(){this.Build=function(){return null==t&&((t=new e).constructor=null),t}}}(),Data=Data_Class.Build(),digit=8,Indicator=function(){var k={type:"",shortName:"IND",color:null,min:0,max:1,p:[],ps:[],V:new Validator,input:null,output:[],cache:{i0:-1,i1:-1,t0:-1,values:[]},CANDLE:0,OHLC:1,HLC:2,LINE:3,MOUNTAIN:4,BANDS:5,PSAR:6,HIST:7,LBLHIST:8,HISTLINE:9,draw:function(){return[]},statics:function(){return{}},update:function(t,e,o){},label:function(t){return""},debug:BJBTC.isDebug()};BJBTC.debug;function o(t){var e=_("DMI");return e+="("+~~k.p[0]+")",0<=t&&0<k.output.length&&t<k.output[0].length&&(e+=": ",e+=k.output[2][t].toFixed(1),e+=", +DI: ",e+=k.output[1][t].toFixed(1),e+=", -DI: ",e+=k.output[0][t].toFixed(1)),e}function s(){return[{type:k.LINE,data:k.output[0]},{type:k.LINE,data:k.output[1]},{type:k.LINE,data:k.output[2]}]}function i(t,e,o){var s,i,r,a,n,l,c=0,u=0,f=0,d=0,p=0,h=0;for(k.output=[[0],[0],[0]],k.min=1/0,k.max=-1/0,s=Math.min(t.length-2,o+150-1);e<=s;s--)u=Math.max(t[s][2]-t[s][3],Math.abs(t[s][2]-t[s+1][4]),Math.abs(t[s][3]-t[s+1][4])),i=t[s][2]-t[s+1][2]>t[s+1][3]-t[s][3]?Math.max(t[s][2]-t[s+1][2],0):0,r=t[s+1][3]-t[s][3]>t[s][2]-t[s+1][2]?Math.max(t[s+1][3]-t[s][3],0):0,c<k.p[0]?(f+=u,d+=i,p+=r):(f=f-f/k.p[0]+u,d=d-d/k.p[0]+i,p=p-p/k.p[0]+r),a=100*d/f,n=100*p/f,l=100*Math.abs(a-n)/(a+n+1e-6),c<k.p[0]?h=0:c<2*k.p[0]?h+=l/k.p[0]:h=(h*(k.p[0]-1)+l)/k.p[0],k.output[0].splice(0,0,n),k.output[1].splice(0,0,a),k.output[2].splice(0,0,h),s<o&&(n<k.min&&(k.min=n),a<k.min&&(k.min=a),h<k.min&&(k.min=h),n>k.max&&(k.max=n),a>k.max&&(k.max=a),h>k.max&&(k.max=h)),c++}function r(){return{major:[50],minor:[30,70]}}function a(){return[{type:k.LINE,data:k.output[0]},{type:k.LINE,data:k.output[1]},{type:k.LINE,data:k.output[2]}]}function n(t,e,o){var s,i,r=k.p[0],a=k.p[1],n=0,l=0,c=0,u=.05,f=[],d=0,p=[];for(k.output=[[],[],[]],s=Math.min(t.length-1,o+r);e<=s;s--)i=t[s][4],f.splice(0,0,i),p.splice(0,0,i*i),l+=i,c+=p[0],f.length>r&&(l-=f.pop(),c-=p.pop()),n=l/f.length,u=1<f.length?(d=f.length,Math.sqrt((d*c-l*l)/(d*(d-1)))):0,k.output[0].splice(0,0,n),k.output[1].splice(0,0,n+a*u),k.output[2].splice(0,0,n-a*u)}function l(t){var e=_("Bands");return e+="("+~~k.p[0]+", "+k.p[1].toFixed(1)+")",0<=t&&0<k.output.length&&t<k.output[0].length&&(e+=": ",e+=k.output[2][t].toFixed(digit)+", ",e+=k.output[0][t].toFixed(digit)+", ",e+=k.output[1][t].toFixed(digit)),e}function c(){return[{type:k.LINE,data:k.output[0]}]}function u(){return{major:[-200,-100,100,200],minor:[0]}}function f(t,e,o){var s,i,r,a,n,l=k.p[0],c=[],u=Math.min(t.length-1,o+k.p[0]);for(k.output=[[]],s=u;e<=s;s--){a=(t[s][2]+t[s][3]+t[s][4])/3;var f=0;for(i=s;i<=Math.min(s+l-1,u);i++)f+=t[i][4];var d=f/(Math.min(s+l-1,u)-s+1);c.splice(0,0,d),c.length>l&&c.pop();var p=0;for(r=0;r<=c.length-1;r++)p+=Math.abs(c[r]-t[s+r][4]);var h=p/c.length;n=0==h?0:(a-d)/h/.015,k.output[0].splice(0,0,n)}}function d(t){var e="CCI";return e+="("+~~k.p[0]+")",0<=t&&0<k.output.length&&t<k.output[0].length&&(e+=" "+k.output[0][t].toFixed(digit)),e}function p(){return[{type:k.LINE,data:k.output[0]},{type:k.LINE,data:k.output[1]},{type:k.LINE,data:k.output[2]}]}function h(t,e,o){var s,i,r,a=k.p[0],n=Math.min(t.length-1,o+a),l=[],c=t[n][2],u=t[n][3];for(k.output=[[],[],[]],s=n;e<=s;s--){if(r=t[s][4],l.splice(0,0,r),c<r&&(c=r),r<u&&(u=r),l.length>a)for(l.pop(),c=-(u=1e15),i=0;i<l.length;i++)l[i]>c&&(c=l[i]),l[i]<u&&(u=l[i]);k.output[0].splice(0,0,(c+u)/2),k.output[1].splice(0,0,c),k.output[2].splice(0,0,u)}}function g(t){var e=_("Channel");return e+="("+~~k.p[0]+")",0<=t&&0<k.output.length&&t<k.output[0].length&&(e+=": ",e+=k.output[2][t].toFixed(digit)+", ",e+=k.output[0][t].toFixed(digit)+", ",e+=k.output[1][t].toFixed(digit)),e}function b(){return[{type:k.LINE,data:k.output}]}function m(t,e,o){var s,i,r=2/(k.p[0]+1),a=Math.ceil(Math.log(.01)/Math.log(1-r));for(k.output=[t[Math.min(t.length-1,o+a+1)][4]],s=Math.min(t.length-2,o+a);e<=s;s--)i=r*t[s][4]+(1-r)*k.output[0],k.output.splice(0,0,i)}function x(t){var e="";return 0<=t&&t<k.output.length&&(e=_("EMA"),e+="("+~~k.p[0]+"): ",e+=k.output[t].toFixed(digit)),e}function v(){return[{type:k.LINE,data:k.output}]}function w(t,e,o){var s,i=k.p[0],r=0,a=0;for(k.output=[],s=Math.min(t.length-1,o+i);e<=s;s--){if(r==i-1){for(var n=a=0;n<=i-1;n++)a+=t[s+n][4];k.output.splice(0,0,a/i)}else i-1<r?(a=k.output[0]*i,a-=t[s+i][4],a+=t[s][4],k.output.splice(0,0,a/i)):k.output.splice(0,0,void 0);r++}}function y(t){var e="";return 0<=t&&t<k.output.length&&(e=_("MA"),e+="("+~~k.p[0]+"): ",e+=(k.output[t]||0).toFixed(digit)),e}function C(){return[{type:k.LINE,data:k.output}]}function T(){return{major:[-500,500],minor:[0]}}function S(t,e,o){var s,i,r=2/(k.p[1]+1),a=Math.ceil(Math.log(.01)/Math.log(1-r));if(k.min=1/0,k.max=-1/0,k.output=[],s=Math.min(t.length-1,o+a+1),!(--s<0)){for(i=0==t[s][5]?0:k.p[0]*(t[s][2]-t[s][3])/t[s][5]*(t[s][2]+t[s][3]-t[s+1][2]-t[s+1][3])*.5,k.output.splice(0,0,i),--s;e<=s;s--)(i=r*(0==t[s][5]?0:k.p[0]*(t[s][2]-t[s][3])/t[s][5]*(t[s][2]+t[s][3]-t[s+1][2]-t[s+1][3])*.5)+(1-r)*i)>k.max&&(k.max=i),i<k.min&&(k.min=i),k.output.splice(0,0,i);k.max=k.max+.05*(k.max-k.min)}}function B(t){var e=_("EMV");return 0<=t&&t<k.output.length&&(e+="("+~~k.p[0]+", "+~~k.p[1]+"): ",e+=k.output[t].toFixed(digit)),e}function D(){return[{type:k.LINE,data:k.output}]}function P(t,e,o){var s,i,r,a,n=2/(k.p[0]+1),l=Math.ceil(Math.log(.01)/Math.log(1-n));for(a=r=i=t[Math.min(t.length-1,o+l+1)][4],s=Math.min(t.length-2,o+l);e<=s;s--)a=n*(r=n*(i=n*t[s][4]+(1-n)*i)+(1-n)*r)+(1-n)*a,k.output.splice(0,0,a)}function O(t){var e=_("TRIX");return 0<=t&&t<k.output.length&&(e+="("+~~k.p[0]+"): ",e+=k.output[t].toFixed(digit)),e}function I(){return[{type:k.HIST,data:k.output[0]},{type:k.LINE,data:k.output[1]},{type:k.LINE,data:k.output[2]}]}function A(){return{minor:[0]}}function M(t,e,o){var s,i,r,a=0,n=0,l=0,c=2/(1+k.p[0]),u=2/(1+k.p[1]),f=2/(1+k.p[2]),d=Math.ceil(Math.log(.01)/Math.log(1-Math.min(c,u))),p=t[Math.min(t.length-1,o+d+1)][4];for(k.output=[[0],[0],[0]],n=a=p,l=0,k.min=0,k.max=0,s=Math.min(t.length-2,o+d);e<=s;s--)r=(i=(a=c*(p=t[s][4])+(1-c)*a)-(n=u*p+(1-u)*n))-(l=f*i+(1-f)*l),k.output[0].splice(0,0,r),k.output[1].splice(0,0,l),k.output[2].splice(0,0,i),s<o&&(i>k.max&&(k.max=i),i<k.min&&(k.min=i),r>k.max&&(k.max=r),r<k.min&&(k.min=r));k.max=k.max+.05*(k.max-k.min),0==k.max&&0==k.min&&(k.max=10,k.min=-10)}function E(t){var e=_("MACD");return e+="("+~~k.p[0]+", "+~~k.p[1]+", "+~~k.p[2]+")",0<=t&&0<k.output.length&&t<k.output[0].length&&(e+=": ",e+=k.output[0][t].toFixed(digit)+", ",e+=k.output[1][t].toFixed(digit)+", ",e+=k.output[2][t].toFixed(digit)),e}function N(){return{major:[20,80]}}function $(){return[{type:k.LINE,data:k.output}]}function L(){return{minor:[0]}}function F(t,e,o){var s;if(!(t.length<=1))for(k.output=[t[Math.min(t.length-2,o-1)][5]/BTC_INT],k.min=k.output[0],k.max=k.min,s=Math.min(t.length-2,o-1);e<=s;s--)t[s][4]>t[s+1][4]?k.output.splice(0,0,k.output[0]+t[s][5]/BTC_INT):k.output.splice(0,0,k.output[0]-t[s][5]/BTC_INT),k.output[0]<k.min&&(k.min=k.output[0]),k.output[0]>k.max&&(k.max=k.output[0])}function R(t){var e=_("On Balance Volume");return 0<=t&&t<k.output.length&&(e+=": ",e+=k.output[t].toFixed(1)),e}function j(){return[{type:k.PSAR,data:k.output}]}function J(t,e,o){var s,i,r,a=!0,n=k.p[0],l=(k.p[1],Math.min(t.length-1,o+100)),c=t[l][2],u=t[l][3],f=c,d=u;for(k.output=[d],r=l-1;e<=r;r--)s=t[r][2],i=t[r][3],d=k.output[0]+n*(f-k.output[0]),a?(f<s&&(f=s,(n+=k.p[0])>k.p[1]&&(n=k.p[1])),i<d&&(a=!1,d=f,n=k.p[0],f=i)):(i<f&&(f=i,(n+=k.p[0])>k.p[1]&&(n=k.p[1])),d<s&&(a=!0,d=f,n=k.p[0],f=s)),c=s,u=i,k.output.splice(0,0,d)}function V(t){var e="PSAR";return e+="("+k.p[0].toFixed(3)+", "+k.p[1].toFixed(digit)+")",0<=t&&t<k.output.length&&(e+=": ",e+=k.output[t].toFixed(digit)),e}function q(){return[{type:k.LINE,data:k.output}]}function H(){return{major:[30,70],minor:[50]}}function z(t,e,o){var s,i,r=0,a=[],n=[],l=0,c=0,u=0,f=!1,d=0;for(k.output=[50],s=Math.min(t.length-2,o+250);e<=s;s--){if(f=t[s][4]>t[s+1][4],d=t[s][4]-t[s+1][4],f?a.push(d):n.push(-d),r<k.p[0])k.output.splice(0,0,50);else if(r==k.p[0]){for(i=0;i<a.length;i++)l+=a[i];for(0==a.length?l=0:l/=a.length,i=0;i<n.length;i++)c+=n[i];0==n.length?c=0:c/=n.length,u=l/(c+1e-8),k.output.splice(0,0,100-100/(1+u))}else u=(l=(l*(k.p[0]-1)+(f?d:0))/k.p[0])/((c=(c*(k.p[0]-1)+(f?0:-d))/k.p[0])+1e-8),k.output.splice(0,0,100-100/(1+u));r++}}function U(t){var e=_("RSI");return 0<=t&&t<k.output.length&&(e+="("+~~k.p[0]+"): ",e+=k.output[t].toFixed(1)),e}function G(){return[{type:k.LINE,data:k.output[0]},{type:k.LINE,data:k.output[1]}]}function Y(){return{major:[20,80],minor:[50]}}function W(t,e,o){var s,i,r,a,n=[],l=1e15,c=-1e15,u=0,f=0,d=2/(k.p[2]+1),p=2/(k.p[3]+1),h=0,g=[],b=[],m=0,x=0,v=0,w=!(k.output=[[],[]]),y=0;for(r=Math.min(t.length-2,o+250);e<=r;r--){if(w=t[r][4]>t[r+1][4],y=t[r][4]-t[r+1][4],w?g.push(y):b.push(-y),h<k.p[0])v=50;else if(h==k.p[0]){for(a=0;a<g.length;a++)m+=g[a];for(0==g.length?m=0:m/=g.length,a=0;a<b.length;a++)x+=b[a];0==b.length?x=0:x/=b.length,v=100-100/(1+m/(x+1e-8))}else v=100-100/(1+(m=(m*(k.p[0]-1)+(w?y:0))/k.p[0])/((x=(x*(k.p[0]-1)+(w?0:-y))/k.p[0])+1e-8));if(h++,n.splice(0,0,v),c<v&&(c=v),v<l&&(l=v),n.length>k.p[1]&&(c<=(i=n.pop())||i<=l))for(c=-(l=1e15),s=0;s<n.length;s++)n[s]>c&&(c=n[s]),n[s]<l&&(l=n[s]);f=p*(u=d*(c==l?100:100*(v-l)/(c-l))+(1-d)*u)+(1-p)*f,k.output[0].splice(0,0,u),k.output[1].splice(0,0,f)}}function X(t){var e="STORSI";return e+="("+~~k.p[0]+", "+~~k.p[1]+", "+~~k.p[2]+", "+~~k.p[3]+")",0<=t&&0<k.output.length&&t<k.output[0].length&&(e+=" K:"+k.output[0][t].toFixed(digit)+", ",e+=" D:"+k.output[1][t].toFixed(digit)),e}function K(){return[{type:k.LINE,data:k.output}]}function Z(t,e,o){var s,i,r=[],a=0,n=k.p[0];for(k.output=[],s=Math.min(t.length-1,o+n);e<=s;s--)i=t[s][4],r.length<n?(r.push(i),a=(a*(r.length-1)+i)/r.length):(a-=r[0]/n,a+=i/n,r.splice(0,1),r.push(i)),k.output.splice(0,0,a)}function Q(t){var e=_("SMA");return 0<=t&&t<k.output.length&&(e+="("+~~k.p[0]+"): ",e+=k.output[t].toFixed(digit)),e}function tt(){return[{type:k.LINE,data:k.output[0]},{type:k.LINE,data:k.output[1]}]}function et(){return{major:[20,80],minor:[50]}}function ot(t,e,o){var s,i,r,a,n=[],l=1e15,c=-1e15,u=0,f=0,d=2/(k.p[1]+1),p=2/(k.p[2]+1);for(k.output=[[],[]],s=Math.min(t.length-1,o+k.p[0]);e<=s;s--){if(r=t[s][4],n.splice(0,0,r),c<r&&(c=r),r<l&&(l=r),n.length>k.p[0]&&(c<=(a=n.pop())||a<=l))for(c=-(l=1e15),i=0;i<n.length;i++)n[i]>c&&(c=n[i]),n[i]<l&&(l=n[i]);f=p*(u=d*(c==l?100:100*(r-l)/(c-l))+(1-d)*u)+(1-p)*f,k.output[0].splice(0,0,u),k.output[1].splice(0,0,f)}}function st(t){var e="STO";return 0<=t&&0<k.output.length&&t<k.output[0].length&&(e+=" %K("+~~k.p[0]+", "+~~k.p[1]+"): ",e+=k.output[0][t].toFixed(1),e+=" %D("+~~k.p[2]+"): ",e+=k.output[1][t].toFixed(1)),e}function it(){return[{type:k.LINE,data:k.output[0]},{type:k.LINE,data:k.output[1]},{type:k.LINE,data:k.output[2]}]}function rt(){return{major:[0,100],minor:[50]}}function at(t,e,o){var s,i,r,a,n=[],l=1e15,c=-1e15,u=0,f=0,d=0,p=1/k.p[1],h=1/k.p[2];for(k.output=[[],[],[]],s=Math.min(t.length-1,o+k.p[0]);e<=s;s--){if(r=t[s][4],n.splice(0,0,r),c<r&&(c=r),r<l&&(l=r),n.length>k.p[0]&&(c<=(a=n.pop())||a<=l))for(c=-(l=1e15),i=0;i<n.length;i++)n[i]>c&&(c=n[i]),n[i]<l&&(l=n[i]);d=3*(u=p*(c==l?100:100*(r-l)/(c-l))+(1-p)*u)-2*(f=h*u+(1-h)*f),k.output[0].splice(0,0,u),k.output[1].splice(0,0,f),k.output[2].splice(0,0,d)}}function nt(t){var e="KDJ";return e+="("+~~k.p[0]+", "+~~k.p[1]+", "+~~k.p[2]+")",0<=t&&0<k.output.length&&t<k.output[0].length&&(e+=" K:"+k.output[0][t].toFixed(digit)+", ",e+=" D:"+k.output[1][t].toFixed(digit)+", ",e+=" J:"+k.output[2][t].toFixed(digit)),e}function lt(t,e,o){var s,i;if(!(void 0===t||t.length<=e)){for(k.max=-1/0,s=0;s<=o-e;s++){(i=t[s+e][5]/BTC_INT)>k.max&&(k.max=i);var r=!0;r=t[s+e][4]>=t[s+e][1]&&!(t[s+e][1]==t[s+e][4]&&t[s+e+1]&&t[s+e+1][4]>t[s+e][4]),k.output.push([i,r])}0==k.max?k.max=10:k.max=k.max}}function ct(){return[{type:k.LBLHIST,data:k.output}]}function ut(t){var e="";return 0<=t&&t<k.output.length&&(e=_(getLang().volume),e+=" "+k.output[t][0].toFixed(4)),e}function ft(){return[{type:k.LINE,data:k.output}]}function dt(t,e,o){var s,i=0,r=0,a=0;for(k.output=[],s=Math.min(t.length-1,o+k.p[0]);e<=s;s--)i+=t[s][4]*(t[s][5]/BTC_INT),r+=t[s][5]/BTC_INT,a>=k.p[0]&&(i-=t[s+k.p[0]][4]*(t[s+k.p[0]][5]/BTC_INT),r-=t[s+k.p[0]][5]/BTC_INT),k.output.splice(0,0,i/r),a++}function pt(t){var e="VWAP";return e+="("+~~k.p[0]+")",0<=t&&t<k.output.length&&(e+=": ",e+=k.output[t].toFixed(digit)),e}function ht(){return{major:[20,80],minor:[50]}}function gt(){return[{type:k.LINE,data:k.output}]}function bt(t,e,o){var s,i,r,a,n=[],l=1e15,c=-1e15,u=0;for(k.output=[],s=Math.min(t.length-1,o+k.p[0]);e<=s;s--){if(r=t[s][4],n.splice(0,0,r),c<r&&(c=r),r<l&&(l=r),n.length>k.p[0]&&(c<=(a=n.pop())||a<=l))for(c=-(l=1e15),i=0;i<n.length;i++)n[i]>c&&(c=n[i]),n[i]<l&&(l=n[i]);u=c==l?100:100*(r-l)/(c-l),k.output.splice(0,0,u)}}function mt(t){var e="Wm %R";return e+="("+~~k.p[0]+")",0<=t&&t<k.output.length&&(e+=": ",e+=k.output[t].toFixed(1)),e}function xt(){return{major:[-5,5],minor:[0]}}function vt(t){var e=_("MTM");return e+="("+~~k.p[0]+")",0<=t&&0<k.output.length&&t<k.output.length&&(e+=": ",e+=k.output[t].toFixed(digit)),e}function wt(){return[{type:k.LINE,data:k.output}]}function yt(t,e,o){var s;for(k.min=1/0,k.max=-1/0,k.output=[],s=Math.min(t.length-1-k.p[0],o);e<=s;s--){var i=t[s][4]-t[s+k.p[0]][4];i>k.max&&(k.max=i),i<k.min&&(k.min=i),k.output.splice(0,0,i)}k.max=k.max+.05*(k.max-k.min)}function kt(){return[{type:k.LINE,data:k.output}]}function Ct(t,e,o){var s=0,i=0;k.output=[];for(var r=Math.min(t.length-1,o);e<=r;r--)s+=t[r][6],0==(i+=t[r][5])?k.output.splice(0,0,t[r][4]):k.output.splice(0,0,s/i)}function Tt(t){var e="";return 0<=t&&t<k.output.length&&(e=_("AVL"),e+=k.output[t].toFixed(digit)),e}function St(){return[{type:k.LINE,data:k.output}]}function Bt(t,e,o){var s=0,i=0;k.output=[];for(var r=Math.min(t.length-1,o);e<=r;r--)s+=(t[r][1]+t[r][2]+t[r][3]+t[r][4])/4*t[r][5],0==(i+=t[r][5])?k.output.splice(0,0,t[r][4]):k.output.splice(0,0,s/i)}function Dt(t){var e="";return 0<=t&&t<k.output.length&&(e=_("AVL"),e+=k.output[t].toFixed(digit)),e}return{build:function(t,e){return function(t){switch(t){case"dmi":k.shortName="DMI",k.p=[14],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[2,1/0]}],k.label=o,k.draw=s,k.update=i;break;case"arn":k.shortName="Aroon",k.min=0,k.max=100,k.p=[25],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[2,1/0]}],k.statics=r;break;case"atr":k.shortName="ATR",k.p=[14],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[2,1/0]}];break;case"bnd":k.shortName="Bands",k.p=[21,2],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[2,1/0]},{label:_("z Score"),type:k.V.FLOAT,bounds:[.1,1/0],inc:.1,places:1}],k.draw=a,k.update=n,k.label=l;break;case"cci":k.shortName="CCI",k.min=-250,k.max=250,k.p=[20],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[2,1/0]}],k.draw=c,k.statics=u,k.update=f,k.label=d;break;case"dcn":k.shortName="Channels",k.p=[21],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[2,1/0]}],k.draw=p,k.update=h,k.label=g;break;case"ema":k.shortName="EMA",k.p=[5],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[1,1/0]}],k.draw=b,k.update=m,k.label=x;break;case"ma":k.shortName="MA",k.p=[5],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[1,1/0]}],k.draw=v,k.update=w,k.label=y;break;case"trix":k.shortName="TRIX",k.p=[9],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[1,1/0]}],k.draw=D,k.update=P,k.label=O;break;case"macd":k.shortName="MACD",k.p=[12,26,9],k.ps=[{label:"Short EMA",type:k.V.INT,bounds:[2,1/0]},{label:"Long EMA",type:k.V.INT,bounds:[2,1/0]},{label:"Signal",type:k.V.INT,bounds:[2,1/0]}],k.label=E,k.draw=I,k.statics=A,k.update=M;break;case"mfi":k.shortName="MFI",k.min=0,k.max=100,k.p=[14],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[2,1/0]}],k.statics=N;break;case"obv":k.shortName="OBV",k.p=[],k.draw=$,k.statics=L,k.update=F,k.label=R;break;case"emv":k.shortName="EMV",k.p=[1e4,14],k.ps=[{label:"é™¤æ•°",type:k.V.INT,bounds:[2,1/0]},{label:"é•¿åº¦",type:k.V.INT,bounds:[2,1/0]}],k.draw=C,k.statics=T,k.update=S,k.label=B;break;case"psar":k.shortName="PSAR",k.p=[.02,.2],k.ps=[{label:"AF",type:k.V.FLOAT,bounds:[0,1],inc:.01,places:3},{label:"Max AF",type:k.V.FLOAT,bounds:[0,1],inc:.01,places:3}],k.draw=j,k.update=J,k.label=V;break;case"rsi":k.shortName="RSI",k.min=0,k.max=100,k.p=[14],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[2,1/0]}],k.draw=q,k.statics=H,k.update=z,k.label=U;break;case"storsi":k.shortName="STORSI",k.min=0,k.max=100,k.p=[14,9,3,3],k.ps=[{label:"RSIé•¿åº¦",type:k.V.INT,bounds:[1,1/0]},{label:"Stoché•¿åº¦",type:k.V.INT,bounds:[1,1/0]},{label:"å¹³æ»‘%K",type:k.V.INT,bounds:[1,1/0]},{label:"å¹³æ»‘%D",type:k.V.INT,bounds:[1,1/0]}],k.draw=G,k.statics=Y,k.update=W,k.label=X;break;case"sma":k.shortName="SMA",k.p=[21],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[2,1/0]}],k.draw=K,k.update=Z,k.label=Q;break;case"sto":k.shortName="STO",k.min=0,k.max=100,k.p=[14,3,3],k.ps=[{label:"é•¿åº¦",type:k.V.INT,bounds:[1,1/0]},{label:"å¹³æ»‘%K",type:k.V.INT,bounds:[1,1/0]},{label:"å¹³æ»‘%D",type:k.V.INT,bounds:[1,1/0]}],k.draw=tt,k.statics=et,k.update=ot,k.label=st;break;case"kdj":k.shortName="KDJ",k.min=-50,k.max=150,k.p=[9,3,3],k.ps=[{label:"%K",type:k.V.INT,bounds:[1,1/0]},{label:"%D",type:k.V.INT,bounds:[1,1/0]},{label:"%J",type:k.V.INT,bounds:[1,1/0]}],k.draw=it,k.statics=rt,k.update=at,k.label=nt;break;case"vol":k.shortName="VOL",k.min=0,k.update=lt,k.draw=ct,k.label=ut;break;case"vwap":k.shortName="VWAP",k.p=[14],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[1,1/0]}],k.draw=ft,k.update=dt,k.label=pt;break;case"wpr":k.shortName="Wm %R",k.min=0,k.max=100,k.p=[14],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[1,1/0]}],k.draw=gt,k.statics=ht,k.update=bt,k.label=mt;break;case"mtm":k.shortName="MTM",k.p=[14],k.ps=[{label:_("Period"),type:k.V.INT,bounds:[2,1/0]}],k.label=vt,k.draw=wt,k.statics=xt,k.update=yt;break;case"avl":k.shortName="AVL",k.draw=kt,k.update=Ct,k.label=Tt;break;case"avlIndex":k.shortName="AVL",k.draw=St,k.update=Bt,k.label=Dt}k.type=t}(t),function(t){var e;if(void 0!==t&&t.hasOwnProperty("length"))for(e=0;e<k.ps.length;e++)t.length<=e||t[e]<k.ps[e].bounds[0]||t[e]>k.ps[e].bounds[1]||(k.p[e]=t[e])}(e),this},reset:function(){return k.output=[],this},bounds:function(){return[k.min,k.max]},update:function(t,e,o){if(k.output=[],void 0!==t&&t.hasOwnProperty("length")&&0!=t.length)return k.update(t,e,o),this},draw:function(){return k.draw()},statics:function(){return k.statics()},label:function(t){return k.label(t)},color:function(t){return void 0===t?k.color:(k.color=t,this)},shortName:function(){return k.shortName},settings:function(){return k.p},paramSettings:function(){return k.ps},params:function(t){},paramUpdate:function(t,e){return k.p[t]=e,this},internals:k.debug?function(){return k}:function(){return null}}},Chart=function(){var P={element:"",parent:null,module:null,self:null,canvas:{base:null,bg:null,main:null,fg:null,orders:null,lbl:null,i:null,line:null},w:0,h:0,mode:{current:0,avail:["Time Bars"],display:0,avail_display:["Candle","OHLC","HLC","Line"]},TIME_BAR:0,CANDLE:0,OHLC:1,HLC:2,LINE:3,MOUNTAIN:4,BANDS:5,PSAR:6,HIST:7,LBLHIST:8,period:{current:13,string:"M15",avail:[2592e3,604800,259200,86400,43200,28800,21600,14400,7200,3600,2700,1800,900,300,180,60,0]},bars:{visible:-1,offset:0,blank:0,endpad:0,data:[],noload:{},startTime1:"9:30:00",endTime1:"11:30:00",startTime2:"13:00:00",endTime2:"15:00:00",ticks:[],fixTime:!1},slots:[{main:!0,px:0,h:50,u:[{t:"ema",i:null,s:[5]}],o:[]},{t:"vol",i:null,px:5,h:10,s:[]}],resize:{avail:0,slots:[],pct:[]},price:{high:100,low:50,range:50,bid:NaN,ask:NaN},log:{m:0,b:0,b10:0},px:{pad:5,lbl:{w:65,h:14,tick:5,halftick:2,font:11},bar:{width:7,dx:4,spacing:1},price:1,crosshairs:{x:0,y:0},slotmin:50},flags:{redraw:{base:!0,main:!0,underlay:!0,overlay:!0,inds:!0},recompute:!0,widget:!1},mouse:{down:!1,zoom:!1,w0:null,x:0,y:0,bar:null,sx:0,sy:0,origOffset:0,origSpacing:1,resize:!1,re_slot:0,re_slots:{px0:0,h0:0,px1:0,h1:0},slot:-1},colors:Colors.c,lastColorIndex:0,defaultColors:null,SOLID:0,DOTTED:1,DASHED:2,DASHDOT:3,font:{precision:2,labels:'10px/1.0em BinanceDIN, "Microsoft YaHei", Arial, sans-serif',size:11,lineHeight:1,face:' BinanceDIN, "Microsoft YaHei", Consolas, "Courier New", monospace',indicators:'10px/1.0em  BinanceDIN, "Microsoft YaHei", Arial, sans-serif',heading:'12px/1.0em  BinanceDIN, "Microsoft YaHei", Arial, sans-serif',headingBold:'bold 12px/1.0em  BinanceDIN, "Microsoft YaHei", Arial, sans-serif',headingSize:12},watermark:"bijietech.com",settings:{repaint:!0,grid:!0,crosshairs:!0,icontrols:!0,bidask:!0,logscale:!1,userorders:!1},indicators:{macd:"MACD",kdj:"KDJ",cci:"Commodity Channel Index",dmi:"Directional Movement Index",obv:"On-Balance Volume",rsi:"Relative Strength Index",sto:"Stochastic Oscillator",storsi:"Stochastic RSI",vol:"Volume",wpr:"Williams %R",emv:"Ease of movement value",mtm:"Momentum"},mobileIndicators:["macd","kdj","cci","dmi","obv","rsi","sto","storsi","wpr","emv","mtm","avl"],currentIndicator:0,overlays:{ema:"Exponential Moving Average",bnd:"Bollinger Bands &reg;",psar:"Parabolic SAR",dcn:"Price Channels",sma:"Simple Moving Average",vwap:"Volume Weighted Average Price",trix:"Triple Exponentially Smoothed Average",avl:"avl",ma:"ma"},mobileOverlays:["ema","bnd","psar","dcn","sma","vwap","trix","avl","ma"],currentOverlay:0,lastPinchTime:-1,lastZoomTime:-1,startTouchCoords:[],crossHairH:!0,setShowRateOnLeft:!1,data:{},curIndex:1,offset:0,preClose:0,showMainCrosshairs:!0,stopEvent:!1,preTradingDay:0,notClicked:!0,removeIndicatorCallback:function(){},debug:BJBTC.isDebug()},s=BJBTC.debug;function h(){var t,e=(P.slots.length-1)*(2+P.px.pad)+1+P.px.lbl.h,o=P.h-e,s=-1;for(t=0;t<P.slots.length;t++)P.slots[t].hasOwnProperty("main")?P.slots[t].h=(P.mainSlotHeightPercent||.67)*o|0:P.slots[t].h=(1-P.mainSlotHeightPercent||.33)*o/(P.slots.length-1)|0,P.slots[t].px=s,s+=P.slots[t].h+2+P.px.pad+1}function i(t){if(h(),void 0!==t){var e=new Validator,o=(new Validator).create(e.INT),s=(new Validator).create(e.BOOL);t.hasOwnProperty("r")&&(P.settings.repaint=s.set(P.settings.repaint).set(t.r).get()),t.hasOwnProperty("g")&&(P.settings.grid=s.set(P.settings.grid).set(t.g).get()),t.hasOwnProperty("c")&&(P.settings.crosshairs=s.set(P.settings.crosshairs).set(t.c).get()),t.hasOwnProperty("k")&&(P.settings.icontrols=s.set(P.settings.icontrols).set(t.k).get()),t.hasOwnProperty("b")&&(P.settings.bidask=s.set(P.settings.bidask).set(t.b).get()),t.hasOwnProperty("l")&&(P.settings.logscale=s.set(P.settings.logscale).set(t.l).get()),t.hasOwnProperty("o")&&(P.settings.userorders=s.set(P.settings.userorders).set(t.o).get()),t.hasOwnProperty("time")&&(P.settings.time=s.set(P.settings.userorders).set(t.time).get()),t.hasOwnProperty("m")&&(P.mode.current=o.set(P.mode.current).set(t.m).get()),t.hasOwnProperty("d")&&(P.mode.display=o.set(P.mode.display).set(t.d).get()),t.hasOwnProperty("w")&&(P.px.bar.width=o.set(P.px.bar.width).set(t.w).get()),t.hasOwnProperty("s")&&(P.px.bar.spacing=o.set(P.px.bar.spacing).set(t.s).get());for(var i=o.set(P.period.avail[P.period.current]).set(t.t).get(),r=0;r<P.period.avail.length;r++)P.period.avail[r]==i&&(P.period.current=r);if(t.hasOwnProperty("i")){var a,n,l,c,u=[],f=["m","p","h"],d=[],p=[];for(r in P.indicators)P.indicators.hasOwnProperty(r)&&d.push(r);for(r in P.overlays)P.overlays.hasOwnProperty(r)&&p.push(r);for(r=0;r<t.i.length;r++){for(n=!0,a=0;a<f.length;a++)n=n&&t.i[r].hasOwnProperty(f[a]);if(n){if(l={px:~~+t.i[r].p,h:~~+t.i[r].h},t.i[r].m){if(l.main=!0,l.o=[],l.u=[],t.i[r].hasOwnProperty("o"))for(a=0;a<t.i[r].o.length;a++)c=null,t.i[r].o[a].hasOwnProperty("t")&&0<=p.indexOf(t.i[r].o[a].t)&&t.i[r].o[a].hasOwnProperty("s")&&(t.i[r].o[a].hasOwnProperty("c")&&(c=t.i[r].o[a].c),l.o.push({t:t.i[r].o[a].t,i:null,s:t.i[r].o[a].s,c:c}));if(t.i[r].hasOwnProperty("u"))for(a=0;a<t.i[r].u.length;a++)t.i[r].u[a].hasOwnProperty("t")&&0<=p.indexOf(t.i[r].u[a].t)&&t.i[r].u[a].hasOwnProperty("s")&&(t.i[r].u[a].hasOwnProperty("c")&&(c=t.i[r].u[a].c),l.u.push({t:t.i[r].u[a].t,i:null,s:t.i[r].u[a].s,c:c}))}else{if(!(0<=d.indexOf(t.i[r].t)&&t.i[r].hasOwnProperty("r")))continue;l.t=t.i[r].t,l.i=null,l.s=t.i[r].r}u.push(l)}}0<u.length&&(P.slots=u,h())}}}function r(t){var e=t[0],o=Ht();0==P.bars.data.length||0==o||e>=P.bars.data[0][0]+1e3*o?P.bars.data.splice(0,0,[e,t[1],t[1],t[1],t[1],t[2]]):(t[1]>P.bars.data[0][2]&&(P.bars.data[0][2]=t[1]),t[1]<P.bars.data[0][3]&&(P.bars.data[0][3]=t[1]),P.bars.data[0][4]=t[1],P.bars.data[0][5]+=t[2]),P.flags.recompute=!0,(t[1]>P.highPrice||t[1]<P.lowPrice||P.bars.data[0][5]>P.maxVol)&&(P.flags.recompute=!0)}function a(t){var e=parseFloat(t[0]),o=parseFloat(t[1]),s=parseFloat(t[2]);return!(isNaN(e)||isNaN(o)||isNaN(s))}function n(){$(P.element).append($('<div id="chartCtrlFixed" class="chartCtrl" hidden><div class="content"><div>æ—¶é—´:<span id="date"></span></div><div>å¼€ç›˜:<span id="open"></span></div><div>æœ€é«˜:<span id="high"></span></div><div>æœ€ä½Ž:<span id="low"></span></div><div>æ”¶ç›˜:<span  id="close"></span></div><div>æ¶¨å¹…:<span id="updownPercent" ></span></div><div>æŒ¯å¹…:<span  id="updown1"></span></div><div>æˆäº¤é‡:<span  id="volume"></span></div><div>æˆäº¤é¢:<span  id="quoteVolume"></span></div><div>æ¢æ‰‹çŽ‡:<span  id="hand"></span></div></div></div>'));$(P.element).mouseover(function(){P.mode.display,P.CANDLE}),$(P.element).mouseout(function(){P.mode.display==P.CANDLE&&$("#chartCtrlFixed").hide()}),P.updateXFK=function(t){if(t)s=e=[(new Date).getTime(),0,0,0,0,0];else var e=P.bars.data[P.curIndex],o=P.curIndex+1>=P.bars.data.length?P.curIndex:P.curIndex+1,s=P.bars.data[o];var i,r=P.period.avail[P.period.current];0<r&&r<=3600?i=new Date(e[0]).Format("MM-dd hh:mm"):86400==r?i=new Date(e[0]).Format("yyyy/MM/dd/")+function(t){var e="";switch(t){case 0:e="æ—¥";break;case 1:e="ä¸€";break;case 2:e="äºŒ";break;case 3:e="ä¸‰";break;case 4:e="å››";break;case 5:e="äº”";break;case 6:e="å…­"}return e}(new Date(e[0]).getDay()):604800==r&&(i=new Date(e[0]).Format("yyyy-MM-dd")),t&&(i="--"),$("#chartCtrlFixed #date").text(i),$("#chartCtrlFixed #open").text(t?"--":ut(e[1])),$("#chartCtrlFixed #open").css("color",e[1]<s[4]?"#ff4056":e[1]>s[4]?"#34ce6b":""),$("#chartCtrlFixed #high").text(t?"--":ut(e[2])),$("#chartCtrlFixed #high").css("color",e[2]<s[4]?"#ff4056":e[2]>s[4]?"#34ce6b":""),$("#chartCtrlFixed #low").text(t?"--":ut(e[3])),$("#chartCtrlFixed #low").css("color",e[3]<s[4]?"#ff4056":e[3]>s[4]?"#34ce6b":""),$("#chartCtrlFixed #close").text(t?"--":ut(e[4])),$("#chartCtrlFixed #close").css("color",e[4]<s[4]?"#ff4056":e[4]>s[4]?"#34ce6b":""),$("#chartCtrlFixed #updownPercent").text(t?"--":(100*(e[4]-s[4])/s[4]).toFixed(2)+"%"),$("#chartCtrlFixed #updownPercent").css("color",e[4]<s[4]?"#ff4056":e[4]>s[4]?"#34ce6b":""),$("#chartCtrlFixed #updown1").text(t?"--":(100*(e[2]-e[3])/s[4]).toFixed(2)+"%"),$("#chartCtrlFixed #volume").text(t?"--":e[5].toFixed(0)),$("#chartCtrlFixed #hand").text(t?"--":(100*(P.data.circulation?e[5]/P.data.circulation:0)).toFixed(6)+"%")}}function f(t){var e,o,s=[],i=0,r=$("<div/>").addClass("control-"+t);return s[i++]='<span class="settings-popout">',s[i++]='<span class="icon settings">',s[i++]='<i class="icon-wrench"></i></span>',s[i++]="</span>",r.addClass("icontrol").html(s.join("")).css("top",P.slots[t].px+3+"px"),r.hide(),0==t?$("span.move-up i",r).addClass("disable"):$("span.move-up",r).tooltip({placement:"right",title:_("Move Up")}).click((e=t,function(){!function(t,e){if(!(P.slots.length<=1)&&(0!=t||!e)&&(t!=P.slots.length-1||e)){$(".icontrol",P.element).each(function(t,e){$(e).data("popped")&&x(t)});var o,s,i=e?t-1:t+1;s=P.slots[i].px,P.slots[i].px=P.slots[t].px,P.slots[t].px=s,o=P.slots.splice(t,1)[0],P.slots.splice(i,0,o),jt(),qt()}}(e,!0)})),$("span.settings",r).tooltip({placement:"right",title:_("Settings")}).click((o=t,function(){x(o)})),t==P.slots.length-1&&$("span.move-down i",r).addClass("disable"),r}function x(i){if(!(P.slots.length<=i||i<0||0<$(".popout .extra-settings").length)){var t=$(".control-"+i,P.element);if(t.click(function(t){t.stopPropagation()}),$(document).click(function(){$(".extra-settings",t).remove(),$(".colorpicker").hide(),t.data("popped",!1)}),t.data("popped"))return $(".extra-settings",t).remove(),t.removeClass("popout"),t.data("popped",!1),void $(".settings",t).tooltip("enable");var e,o,s=$("<span/>").addClass("extra-settings"),r=[];if(P.slots[i].hasOwnProperty("main")){var a,n,l,c=$("<div/>").addClass("underlays sortable"),u=$("<div/>").addClass("overlays sortable"),f=$("<div/>").addClass("rows");for(f.append($("<div/>").addClass("title").html(_("Behind Price"))),m=0;m<P.slots[i].u.length;m++){for(n=B(i,m,"u"),"bidask"==P.slots[i].u[m].t&&(n=null),l=uniqueID(),a=$("<div/>").addClass("row").addClass("row1").addClass("u"+m).data({j:m,place:"u"}).append($("<span/>").addClass("icon reorder-icon").append($("<i/>").addClass("icon-reorder").css("color",n).attr("id",l))).append($("<u/>").html(P.slots[i].u[m].i.shortName()+": ")),d=P.slots[i].u[m].i.settings(),p=P.slots[i].u[m].i.paramSettings(),h="",0==d.length&&a.append($("<u/>").text(" --- ")),b=0;b<d.length;b++)h=uniqueID(),a.append($("<span/>").addClass("param-field").append($("<strong/>").text(p[b].hasOwnProperty("label")?p[b].label:"P"+(b+1))).append($("<input/>").attr("type","text").val(d[b]).addClass("param-input").attr("id",h))),r.push({val:d[b],sel:"#"+h,set:p[b],fn:function(e,o,s){return function(t){"function"==typeof e&&e(o,t),P.slots[i].u[s].s=[t],S()}}(P.slots[i].u[m].i.paramUpdate,b,m)});h=uniqueID(),a.append($("<span/>").addClass("icon remove-icon").attr("id",h).append($("<i/>").addClass("icon-trash")).click(function(t,e,o,s){return function(){$("#"+t).tooltip("hide"),C(e,"u",s),x(s),x(s),P.removeIndicatorCallback()}}(h,m,0,i)).tooltip({placement:"right",title:_("Remove")})),g=uniqueID(),a.append($("<span/>").addClass("icon edit-icon").attr("id",g).append($("<i/>").addClass("icon-edit")).click(v(g,i,"u",m,l)).tooltip({placement:"right",title:_("Pick Color")})),a.append(clearingSpan()),c.append(a)}for(f.append(c),f.append($("<div/>").addClass("title").html(_("In Front of Price"))),m=0;m<P.slots[i].o.length;m++){for(n=B(i,m,"o"),"bidask"==P.slots[i].o[m].t&&(n=null),l=uniqueID(),a=$("<div/>").addClass("row").addClass("o"+m).data({j:m,place:"o"}).append($("<span/>").addClass("icon reorder-icon").append($("<i/>").addClass("icon-reorder").css("color",n).attr("id",l))).append($("<u/>").html(P.slots[i].o[m].i.shortName()+": ")),d=P.slots[i].o[m].i.settings(),p=P.slots[i].o[m].i.paramSettings(),h="",0==d.length&&a.append($("<u/>").text(" --- ")),b=0;b<d.length;b++)h=uniqueID(),a.append($("<span/>").addClass("param-field").append($("<strong/>").text(p[b].hasOwnProperty("label")?p[b].label:"P"+(b+1))).append($("<input/>").attr("type","text").val(d[b]).addClass("param-input").attr("id",h))),r.push({val:d[b],sel:"#"+h,set:p[b],fn:function(e,o,s){return function(t){"function"==typeof e&&e(o,t),P.slots[i].o[s].s=[t],S()}}(P.slots[i].o[m].i.paramUpdate,b,m)});h=uniqueID(),a.append($("<span/>").addClass("icon remove-icon").attr("id",h).append($("<i/>").addClass("icon-trash")).click(function(t,e,o,s){return function(){$("#"+t).tooltip("hide"),C(e,"o",s),x(s),x(s),P.removeIndicatorCallback()}}(h,m,0,i)).tooltip({placement:"right",title:_("Remove")})),g=uniqueID(),a.append($("<span/>").addClass("icon edit-icon").attr("id",g).append($("<i/>").addClass("icon-edit")).click(v(g,i,"o",m,l)).tooltip({placement:"right",title:_("Pick Color")})),a.append(clearingSpan()),u.append(a)}f.append(u),s.append(f);$(".rows",s),$(".reorder-icon",s),e=$(".rows",s);$(".overlays",s).append("<div class='row' style='height:0'></div>"),$(".underlays",s).append("<div class='row' style='height:0'></div>")}else{s.append($("<span/>").addClass("icon remove-icon").append($("<i/>").addClass("icon-trash")).click((o=i,function(){$(".control-"+o+" .remove-icon",P.element).tooltip("hide"),T(o),P.removeIndicatorCallback()})).tooltip({placement:"bottom",title:_("Remove")}));for(var d=P.slots[i].i.settings(),p=P.slots[i].i.paramSettings(),h="",g="",b=0;b<d.length;b++)h=uniqueID(),s.append($("<span/>").addClass("param-field").append($("<strong/>").text(p[b].hasOwnProperty("label")?p[b].label:"P"+(b+1))).append($("<input/>").attr("type","text").val(d[b]).addClass("param-input").attr("id",h))),r.push({val:d[b],sel:"#"+h,set:p[b],fn:function(e,o){return function(t){"function"==typeof e&&e(o,t),S()}}(P.slots[i].i.paramUpdate,b)})}s.append(clearingSpan()),$(".settings-popout",t).append(s);for(var m=0;m<r.length;m++)$(r[m].sel).data("value",r[m].val),y(i,r[m].sel,r[m].set,r[m].fn,S);t.addClass("popout"),$(".settings",t).tooltip("disable"),t.data("popped",!0)}}function e(){var t;for(t=0;t<P.slots.length;t++)$(".control-"+t,P.element).data("popped")&&x(t)}function v(t,s,i,r,a){return function(){$("#"+t).ColorPicker({color:B(s,r,i),onChange:function(t,e,o){!function(t,e,o,s){var i=null;i=P.slots[t].hasOwnProperty("main")&&void 0!==o?P.slots[t][o][e].i:P.slots[t].i;null!=i&&i.color(s)}(s,r,i,"#"+e),"o"==i?P.flags.redraw.overlay=!0:"u"==i&&(P.flags.redraw.underlay=!0),window.reqAnimFrame(u),$("#"+a).css("color","#"+e)},onHide:function(){}}).ColorPickerShow(),$(".colorpicker").click(function(t){t.stopPropagation()})}}function y(f,d,p,h,t,e){new Validator;var g=(new Validator).create(p.type),b=p.hasOwnProperty("inc")?p.inc:1,m=p.hasOwnProperty("places")?p.places:0;$(d).on({keyup:function(t){var e=$(d),o=t.keyCode||t.which,s=38,i=40,r=13,a=27,n=!1,l=e.data("value");switch(o){case s:l+b<=p.bounds[1]&&(e.data("value",l+b),e.val((l+b).toFixed(m)),"function"==typeof h&&h(l+b));break;case i:l-b>=p.bounds[0]&&(e.data("value",l-b),e.val((l-b).toFixed(m)),"function"==typeof h&&h(l-b));break;case r:case a:t.preventDefault(),t.stopPropagation(),x(f);break;default:n=!0}if(n){var c=+e.val(),u=g.set(l).set(c).get();u!=l&&(u>=p.bounds[0]&&u<=p.bounds[1]?(e.data("value",u),"function"==typeof h&&h(u)):0<e.val().length&&e.val(l))}},blur:function(){0==$(d).val().length&&$(d).val($(d).data("value")),"function"==typeof t&&t()}})}function l(t,e){var o={t:t,i:(new Indicator).build(t),s:[]};o.s=o.i.settings(),e&&o.i.paramUpdate(0,e),o.i.color(P.colors.stroke.i[P.lastColorIndex%P.colors.stroke.i.length]),P.lastColorIndex++;var s,i=-1;for(s=0;s<P.slots.length;s++)if(P.slots[s].hasOwnProperty("main")){i=s;break}-1!=i&&(P.slots[i].u.push(o),$(".control-"+i,P.element).data("popped")&&(x(i),x(i)),S())}function c(t){var e,o=(P.slots.length-1)*(2+P.px.pad)+1+P.px.lbl.h,s=(P.h,Math.max(P.slots[P.slots.length-1].h*P.slots.length/(P.slots.length+1),P.px.slotmin)),i=0,r=0,a=0,n=!1,l=0,c={t:t,h:s,px:0,i:(new Indicator).build(t),s:[]};for(c.s=c.i.settings();i<s;)if(!n&&P.slots[r%P.slots.length].h<=P.px.slotmin)++a==P.slots.length&&(n=!0),r++;else{for(a=0,P.slots[r%P.slots.length].h-=1,i+=1,e=1+r%P.slots.length;e<P.slots.length;e++)P.slots[e].px-=1;if(r++,1500<++l)break}c.px=P.slots[P.slots.length-1].h+2+P.px.pad+1,P.slots.push(c);for(var u=1;u<=P.slots.length-2;u++)$(".control-"+u,P.element).remove(),P.slots[u].control=f(u),$(P.element).append(P.slots[u].control);P.slots[P.slots.length-1].control=f(P.slots.length-1),$(P.element).append(P.slots[P.slots.length-1].control),h(),jt(),qt()}function C(t,e,o){P.slots[o].hasOwnProperty(e)&&(P.slots[o][e].splice(t,1),$(".control-"+o+" ."+e+t,P.element).remove(),S())}function T(t){if(!P.slots[t].hasOwnProperty("main")){var e,o=+P.slots[t].h+P.px.pad+3,s=-1;for($(".control-"+(P.slots.length-1),P.element).remove(),$(".icontrol",P.element).each(function(t,e){$(e).data("popped")&&x(t)}),e=0;e<P.slots.length;e++)if(e!=t&&(s<0&&t<e&&(P.slots[e].px-=P.slots[t].h),P.slots[e].hasOwnProperty("main"))){s=e,P.slots[e].h+=o;break}for(e=0;e<P.slots.length;e++);P.slots.splice(t,1),jt(),qt()}}function u(){var t,e,o=P.canvas.base[0].getContext("2d"),s=P.canvas.orders[0].getContext("2d"),i=P.canvas.bg[0].getContext("2d"),r=P.canvas.main[0].getContext("2d"),a=P.canvas.fg[0].getContext("2d");for(P.flags.recompute&&function(t){function e(){var t,e=wt();if(-1<e[1]&&(P.price.high=0,P.price.low=1e15),P.mode.display==P.CANDLE)for(t=e[0];t<=e[1];t++)P.bars.data[t][2]>P.price.high&&(P.price.high=P.bars.data[t][2]),P.bars.data[t][3]<P.price.low&&(P.price.low=P.bars.data[t][3]);else for(t=e[0];t<=e[1];t++)P.bars.data[t][4]>P.price.high&&(P.price.high=P.bars.data[t][4]),P.bars.data[t][4]<P.price.low&&(P.price.low=P.bars.data[t][4])}P.px.bar.spacing=2<P.px.bar.width/3?P.px.bar.width/3:2,P.bars.visible=0|parseInt((P.w-P.px.lbl.tick-1)/(P.px.bar.width+P.px.bar.spacing)),e(),P.bars.visible=0|parseInt((P.w-P.px.lbl.tick-P.px.lbl.w-1)/(P.px.bar.width+P.px.bar.spacing));var o=P.canvas.base[0].getContext("2d");o.font=P.font.labels,P.px.lbl.w=o.measureText(ut(P.price.high)).width+4,P.LblWidthChange&&P.LblWidthChange(P.px.lbl.w);e();var s=P.price.high-P.price.low;P.settings.logscale&&(P.price.high=Math.min(1.1*P.price.high,P.price.high+.1*s),P.price.low=Math.max(P.price.low/1.1,P.price.low-.1*s));P.price.low<0&&(P.price.low=0);P.px.bar.dx=(P.px.bar.width-1)/2|0,P.period.string=Ut();var i=wt();for(j=0;j<P.slots.length;j++)if(P.slots[j].hasOwnProperty("main")){if(P.settings.logscale){var r=P.slots[j].px,a=r+P.slots[j].h;try{P.log.m=(r-a)/log10(p1/p0),P.log.b=(r*log10(p0)-a*log10(p1))/log10(p0/p1)}catch(t){P.log.m=0,P.log.b=0}}P.price.high,P.price.low;for(k=0;k<P.slots[j].o.length;k++)if(P.slots[j].o[k].hasOwnProperty("i")){P.slots[j].o[k].i.update(P.bars.data,i[0],i[1]);var n=P.slots[j].o[k].i.draw();if(n)for(var l=0;l<n.length;l++)for(var c=n[l].data,u=0;u<i[1]-i[0];u++){var f=c[u];f>P.price.high&&(P.price.high=f),f<P.price.low&&(P.price.low=f)}}for(k=0;k<P.slots[j].u.length;k++)if(P.slots[j].u[k].hasOwnProperty("i")){"ema"==P.slots[j].u[k].t&&P.slots[j].u[k].s&&P.slots[j].u[k].i.paramUpdate(0,P.slots[j].u[k].s[0]),P.slots[j].u[k].i.update(P.bars.data,i[0],i[1]);var n=P.slots[j].u[k].i.draw();if(n)for(var l=0;l<n.length;l++)for(var c=n[l].data,u=0;u<i[1]-i[0];u++){var f=c[u];f>P.price.high&&(P.price.high=f),f<P.price.low&&(P.price.low=f)}}}else P.slots[j].i.update(P.bars.data,i[0],i[1]);var d=P.slots[0].h,p=40*(P.price.high-P.price.low)/(d-40),h=void 0===Data.qouteFixed?1e-5:Math.pow(.1,Data.qouteFixed-2);h<p?(P.price.high+=3*p/4,P.price.low-=p/4):(P.price.high=1.01*P.price.high,P.price.low=P.price.low/1.01);P.price.low<0&&(P.price.low=0);P.price.range=P.price.high-P.price.low,P.flags.recompute=!1,P.flags.redraw.base=!0,P.flags.redraw.main=!0,P.flags.redraw.underlay=!0,P.flags.redraw.overlay=!0,P.flags.redraw.inds=!0}(),P.flags.redraw.base&&(o.clearRect(0,0,P.w,P.h),function(t,e){void 0===e&&(e=!1);var o,s;for(t.fillStyle=P.colors.fill.bg,s=P.w-P.px.lbl.w-P.px.lbl.tick,pt(t,s,0,P.px.lbl.w+P.px.lbl.tick,P.h),pt(t,0,0,P.offset,P.h),o=0;o<P.slots.length;o++)o<P.slots.length-1?pt(t,0,P.slots[o].px+P.slots[o].h+2,s,P.px.pad):pt(t,0,P.slots[o].px+P.slots[o].h+2,s,P.px.lbl.h);for(function(t){P.w;var e,o,s,i,r,a,n,l,c,u=Ht(),f=Settings.localTime,d=[];if(st(t,!0),t.strokeStyle=P.colors.stroke.grid,t.lineWidth=1,a=t.measureText("00:00").width,n=t.measureText("12/30").width,t.measureText("Jan").width,l=1.25*a,(c=2*Math.ceil(l/(P.px.bar.width+P.px.bar.spacing)))<=0&&(c=1),t.beginPath(),u<14400){for(s=0;;s++)if(!((r=yt(s))<0)){if(r>=P.bars.data.length)break;if(ot(y=P.bars.data[r][0],f)){if(d.push(s),1==tt(y,f)?1==K(y,f)?it(t,X(y,f),s):it(t,Z(y,f),s):it(t,Q(y,!1,f),s),P.settings.grid)for(i=0;i<P.slots.length;i++);if(s>P.bars.visible)break;s+=c-1}}if(0==d.length&&d.push(kt(P.bars.data.length-1)),t.stroke(),t.beginPath(),st(t,!1),t.strokeStyle=P.colors.stroke.grid,P.bars.fixTime){var p=new Date,h=new Date(p.getFullYear()+"/"+(p.getMonth()+1)+"/"+p.getDate()+" "+P.bars.startTime1),g=new Date(p.getFullYear()+"/"+(p.getMonth()+1)+"/"+p.getDate()+" "+P.bars.endTime1),b=new Date(p.getFullYear()+"/"+(p.getMonth()+1)+"/"+p.getDate()+" "+P.bars.startTime2),m=new Date(p.getFullYear()+"/"+(p.getMonth()+1)+"/"+p.getDate()+" "+P.bars.endTime2),x=g.getTime()-h.getTime();x/=6e4;var v=g.getTime()-h.getTime()+m.getTime()-b.getTime();v/=6e4;var w=Math.ceil(v/P.w*17),y=(Math.ceil(v/P.w*P.offset),m.getTime());for(e=et(y,!1,f),it(t,e,w+Math.ceil(v/P.w*2)),y=(m.getTime()+b.getTime())/2,e=et(y,!1,f),it(t,e,60),y=g.getTime(),e=et(y,!1,f),it(t,e,120),y=(g.getTime()+h.getTime())/2,e=et(y,!1,f),it(t,e,180),y=h.getTime(),e=et(y,!1,f),it(t,e,240-w),P.mode.display!=P.CANDLE&&function(t){for(var e=1;e<=5;e++)H(t,gt(e*(P.price.high-P.price.low)/6+P.price.low,0),P.DOTTED)}(t),i=0;i<P.slots.length;i++)J(t,i,0,P.DOTTED);for(i=0;i<P.slots.length;i++)J(t,i,v/4,P.DOTTED);for(i=0;i<P.slots.length;i++)J(t,i,x+1,P.DOTTED);for(i=0;i<P.slots.length;i++)J(t,i,v+1,P.DOTTED);for(i=0;i<P.slots.length;i++)J(t,i,3*v/4+1,P.DOTTED)}else for(o=d.length-1;0<=o;o--)for(s=d[o]-c;;s-=c)if(!(s>P.bars.visible)){if(0==o&&s<0)break;if((r=yt(s))<0)break;if(!(r>=P.bars.data.length)){if(P.settings.grid)for(i=0;i<P.slots.length;i++);if(s<=d[o-1])break;if(0<o&&bt(s)+a/2>=bt(d[o-1])-n/2)break;y=P.bars.data[r][0],e=et(y,!1,f),it(t,e,s)}}t.stroke()}else if(u<86400){var k=-1,C=-1;for(s=0;;s++)if(!((r=yt(s))<0)){if(r>=P.bars.data.length-1)break;if(y=P.bars.data[r][0],C=tt(y,f),k=tt(P.bars.data[r+1][0],f),86400<u&&K(y,f)!=K(P.bars.data[r+1][0],f)||1<k&&1==C){if(d.push(s),1==K(y,f)?it(t,X(y,f),s):it(t,Z(y,f),s),P.settings.grid)for(i=0;i<P.slots.length;i++);if(d[d.length-1]>P.bars.visible)break;s+=c-1}}for(d.push(kt(P.bars.data.length-1)),t.stroke(),t.beginPath(),st(t,!1),t.strokeStyle=P.colors.stroke.grid,o=d.length-1;0<=o;o--)for(s=d[o]-c;;s-=c)if(!(s>P.bars.visible)){if(0==o&&s<0)break;if((r=yt(s))<0)break;if(!(r>=P.bars.data.length)){if(P.settings.grid)for(i=0;i<P.slots.length;i++);if(s<=d[o-1])break;if(0<o&&bt(s)+a/2>=bt(d[o-1])-n/2)break;y=P.bars.data[r][0],e=ot(y,f)?u<86400?tt(y,f):Q(y,!1,f):et(y,!1,f),it(t,e,s)}}t.stroke()}else if(u<2592e3){var k=-1,C=-1;for(s=0;;s++)if(!((r=yt(s))<0)){if(r>=P.bars.data.length-1)break;if(y=P.bars.data[r][0],C=tt(y,f),k=tt(P.bars.data[r+1][0],f),86400<u&&K(y,f)!=K(P.bars.data[r+1][0],f)||1<k&&1==C){if(d.push(s),1==K(y,f)?it(t,X(y,f),s):it(t,Z(y,f),s),P.settings.grid)for(i=0;i<P.slots.length;i++);if(d[d.length-1]>P.bars.visible)break;s+=c-1}}for(d.push(kt(P.bars.data.length-1)),t.stroke(),t.beginPath(),st(t,!1),t.strokeStyle=P.colors.stroke.grid,o=d.length-1;0<=o;o--)for(s=d[o]-c;;s-=c)if(!(s>P.bars.visible)){if(0==o&&s<0)break;if((r=yt(s))<0)break;if(!(r>=P.bars.data.length)){if(P.settings.grid)for(i=0;i<P.slots.length;i++);if(s<=d[o-1])break;if(0<o&&bt(s)+a/2>=bt(d[o-1])-n/2)break;y=P.bars.data[r][0],e=u<86400?tt(y,f):Q(y,!1,f),it(t,e,s)}}t.stroke()}}(t),t.textAlign="left",t.textBaseline="middle",t.font=P.font.labels,t.fillStyle=P.colors.fill.label,o=0;o<P.slots.length;o++)P.slots[o].hasOwnProperty("main")?(t.strokeStyle=P.colors.stroke.border,t.beginPath(),O(t,o),t.stroke()):m(t,o),R(t,o)}(o),P.flags.redraw.base=!1,P.settings.userorders?p(s):s.clearRect(0,0,P.w,P.h)),(P.flags.redraw.inds||P.flags.redraw.overlay)&&(a.clearRect(0,0,P.w,P.h),P.flags.redraw.inds=!0,P.flags.redraw.overlay=!0),P.flags.redraw.underlay&&i.clearRect(0,0,P.w,P.h),t=0;t<P.slots.length;t++)if(P.slots[t].hasOwnProperty("main")){if(P.flags.redraw.main&&(r.clearRect(0,0,P.w,P.h),b(r,t),P.flags.redraw.main=!1),P.flags.redraw.underlay){for(d(i,t),e=0;e<P.slots[t].u.length;e++)D(i,t,P.slots[t].u[e].i);P.flags.redraw.underlay=!1}if(P.flags.redraw.overlay){for(d(a,t),e=0;e<P.slots[t].o.length;e++)D(a,t,P.slots[t].o[e].i);P.flags.redraw.overlay=!1}}else(P.flags.redraw.inds||"vol"==P.slots[t].t)&&(d(a,t),D(a,t,P.slots[t].i));P.flags.redraw.inds=!1,P.notClicked||1==mobile||(a.strokeStyle="#f9ee30",a.strokeRect(0,0,P.w,P.h))}function S(){var t=Ht(),e=0;if(P.bars.data=[],Data.data.bars[t])if(1==P.bars.fixTime)for(e=0;e<Data.data.bars[t].length;e++)P.bars.data.push(Data.data.bars[t][e]);else P.bars.data=Data.data.bars[t];void 0===P.bars.data&&(P.bars.data=[]),P.flags.recompute=!0,u()}function d(t,e){t.clearRect(0,P.slots[e].px-P.px.pad,P.w,P.slots[e].h+2*P.px.pad)}function o(){var t=P.canvas.orders[0].getContext("2d");try{p(t)}catch(t){}}function p(t){void 0===t&&(t=P.canvas.orders[0].getContext("2d"));for(var e=-1,o=0;o<P.slots.length;o++)if(P.slots[o].hasOwnProperty("main")){e=o;break}if(-1!=e){try{t.clearRect(0,0,P.w,P.h)}catch(t){return}if(P.settings.userorders){var s=UserAccount.orders(),i="",r="",a={},n=[],l=[],c=[],u=[],f=(o=0,0);for(i in s)if(s.hasOwnProperty(i)&&i==BJBTC.exchange())for(r in s[i])s[i].hasOwnProperty(r)&&((a=s[i][r]).exch=i,a.hasOwnProperty("base")&&a.base==BJBTC.base()&&a.hasOwnProperty("quote")&&a.quote==BJBTC.quote()&&((f=gt(a.price,e))<P.slots[e].px||f>P.slots[e].px+P.slots[e].h||("buy"==a.action?(n.push(a),c.push(g(a))):"sell"==a.action&&(l.push(a),u.push(g(a))))));if(0<n.length+l.length&&(t.textAlign="left",t.font=P.font.indicators),0<n.length){for(t.strokeStyle=P.colors.stroke.bid,t.fillStyle=P.colors.stroke.bid,t.textBaseline="top",t.beginPath(),o=0;o<n.length;o++)q(t,e,n[o].price,P.DASHDOT),(f=gt(n[o].price,e)+1)>P.slots[e].px+P.slots[e].h-10||t.fillText(c[o],2,f);for(t.stroke(),t.font=P.font.labels,t.textBaseline="middle",o=0;o<n.length;o++)t.fillStyle=P.colors.fill.flags,lt(t,e,n[o].price,ut(n[o].price))}if(0<l.length){for(t.strokeStyle=P.colors.stroke.ask,t.fillStyle=P.colors.stroke.ask,t.textBaseline="top",t.font=P.font.indicators,t.beginPath(),o=0;o<l.length;o++)q(t,e,l[o].price,P.DASHDOT),f=gt(l[o].price,e)+1,t.fillText(u[o],2,f);for(t.stroke(),t.font=P.font.labels,t.textBaseline="middle",o=0;o<l.length;o++)t.fillStyle=P.colors.fill.flags,lt(t,e,l[o].price,ut(l[o].price))}}}}function g(t){var e="";return"buy"==t.action?e+=_("BUY"):"sell"==t.action?e+=_("SELL"):e+="UNKNOWN ACTION",e+=" ",e+=parseFloat(t.amount).toFixed(Exchanges.cur_prec(t.exch,t.base))}function b(t,e){if(void 0!==P.bars.data&&0!=P.bars.data.length)switch(P.settings.bidask&&function(t,e){if(isNaN(P.price.bid)&&isNaN(P.price.ask))return;var o=P.price.bid,s=P.price.ask;t.textBaseline="middle",t.textAlign="left",t.font=P.font.labels,t.fillStyle=P.colors.fill.flags,t.strokeStyle=P.colors.stroke.ask,t.beginPath(),q(t,e,s,P.SOLID),t.stroke(),lt(t,e,s,ut(s)),t.fillStyle=P.colors.fill.flags,t.strokeStyle=P.colors.stroke.bid,t.beginPath(),q(t,e,o,P.SOLID),t.stroke(),lt(t,e,o,ut(o))}(t,e),P.mode.display){case P.CANDLE:case P.OHLC:case P.HLC:!function(t,e,o,s){var i,r,a,n,l=wt(),c=null,u=[],f=[];i=o.length-1>l[1]?o[l[1]+1]:o[l[1]];if(void 0===i)return;switch(s){case P.CANDLE:c=E;break;case P.OHLC:c=N;break;case P.HLC:c=L;break;default:return}var d,p,h=0,g=1e5;for(r=l[1];r>=l[0];r--)o[r][4]>=o[r][1]?o[r][1]==o[r][4]&&o[r+1]&&o[r+1][4]>o[r][1]?f.push([r,kt(r)]):u.push([r,kt(r)]):f.push([r,kt(r)]),i=o[r],o[r][2]>=h&&(h=o[r][2],d=r),o[r][3]<=g&&(g=o[r][3],p=r);for(t.strokeStyle=P.colors.stroke.down,t.fillStyle=P.colors.fill.down,t.beginPath(),r=0;r<f.length;r++)(a=o[f[r][0]].slice())[5]/=BTC_INT,c(t,e,f[r][1],a,!0);for(t.stroke(),t.strokeStyle=P.colors.stroke.up,t.fillStyle=P.colors.fill.up,t.beginPath(),r=0;r<u.length;r++)(a=deepCopy(o[u[r][0]]))[5]/=BTC_INT,c(t,e,u[r][1],a,!1);t.stroke(),n=i[4],2<=o.length&&o[1][4]>o[0][4]&&(t.strokeStyle=P.colors.stroke.down);if(t.fillStyle=P.colors.fill.flags,t.textBaseline="middle",t.font=P.font.labels,lt(t,e,n,ut(n)),s==P.CANDLE){t.textBaseline="middle",t.fillStyle=P.colors.stroke.arrow;var b=gt(h,e),m=bt(kt(d)),x=gt(g,e),v=bt(kt(p)),w=t.measureText(ut(h)).width+19,y=t.measureText(ut(g)).width+21;0<m-w?(Bt(t,0,0,m-15,b,m-2,b),t.fillText(ut(h),m-w,b)):(Bt(t,0,0,m+15,b,m+2,b),t.fillText(ut(h),m+19,b)),0<v-y?(Bt(t,0,0,v-15,x,v-2,x),t.fillText(ut(g),v-w,x)):(Bt(t,0,0,v+15,x,v+2,x),t.fillText(ut(g),v+19,x))}}(t,e,P.bars.data,P.mode.display);break;case P.LINE:case P.MOUNTAIN:I(t,e,P.bars.data,P.mode.display==P.MOUNTAIN,!0,!0)}}function m(t,e){var o,s,i=P.slots[e].i.statics(),r=!0,a=P.slots[e].i.bounds();if(t.lineWidth=1,i.hasOwnProperty("minor")){for(t.strokeStyle=P.colors.stroke.minorlevel,t.fillStyle=P.colors.fill.label,t.beginPath(),o=0;o<i.minor.length;o++)(s=i.minor[o])<a[0]||s>a[1]||(q(t,e,s,P.DASHDOT),at(t,e,s,ut(s)));for(t.stroke(),t.strokeStyle=P.colors.stroke.border,t.beginPath(),o=0;o<i.minor.length;o++)(s=i.minor[o])<a[0]||s>a[1]||at(t,e,s,ut(s));t.stroke(),r=!1}if(i.hasOwnProperty("major")){for(t.strokeStyle=P.colors.stroke.majorlevel,t.fillStyle=P.colors.fill.label,t.beginPath(),o=0;o<i.major.length;o++)(s=i.major[o])<a[0]||s>a[1]||(q(t,e,s,P.SOLID),at(t,e,s,ut(s)));for(t.stroke(),t.strokeStyle=P.colors.stroke.border,t.beginPath(),o=0;o<i.major.length;o++)(s=i.major[o])<a[0]||s>a[1]||at(t,e,s,ut(s));t.stroke(),r=!1}r&&(t.strokeStyle=P.colors.stroke.border,t.beginPath(),O(t,e),t.stroke())}function B(t,e,o){var s=null,i=P.colors.stroke.i,r=null;return P.slots[t].hasOwnProperty("main")&&void 0!==o&&(r=P.slots[t][o][e].i),null!=r&&(s=r.color()),null===s&&(void 0!==e?s=i[e%i.length]:(s=i[P.lastColorIndex%i.length],P.lastColorIndex++)),s}function D(t,e,o,s){if(void 0!==o){var i,r=o.draw(),a=null,n=P.slots[e].hasOwnProperty("main");for(i=0;i<r.length;i++)switch(a=null,r[i].type){case P.CANDLE:case P.OHLC:case P.HLC:break;case P.LINE:n&&(a=o.color()),null==a&&(a=B(e,i)),t.strokeStyle=a,t.beginPath(),I(t,e,r[i].data,!1,!1),t.stroke();break;case P.MOUNTAIN:I(t,e,r[i].data,!0,!1);break;case P.BANDS:break;case P.PSAR:n&&(a=o.color()),null==a&&(a=B(e,i)),t.strokeStyle=a,t.beginPath(),M(t,e,r[i].data),t.stroke();break;case P.HIST:A(t,e,r[i].data,!0);break;case P.LBLHIST:A(t,e,r[i].data,!1)}}}function O(t,e){var o,s,i,r,a,n,l,c,u,f,d,p,h,g=[],b=0,m=0,x=[5,2.5,2];if(P.slots[e].hasOwnProperty("main"))s=P.price.high,i=P.price.low;else{var v=P.slots[e].i.bounds();i=v[0],s=v[1]}if(!((o=s-i)<0||(r=o/~~(P.slots[e].h/(4*P.px.lbl.font)))<0)){for(l=Math.log(r)/Math.LN10,a=Math.pow(10,0<l?~~l:Math.floor(l)),.5,b=0;b<x.length;b++)1<(p=Math.log(r/a/(x[b]/10))/Math.LN10)&&g.push([a*x[b],Math.abs(.5-p),p]);for(0==g.length&&g.push([a,0,0]),n=1e8,b=0;b<g.length;b++)g[b][1]<n&&(n=g[b][1],r=g[b][0]);if(c=~~(s/r)*r,u=P.w-P.px.lbl.tick-P.px.lbl.w,f=gt(c,e),d=gt(i,e)-P.px.lbl.font/2|0,1!=e){if(P.slots[e].hasOwnProperty("main")&&0!=P.offset){t.textAlign="right";for(b=0;b<=6;b++){var w=P.price.low+b*(P.price.high-P.price.low)/6;D=gt(w,e);t.textBaseline=6==b?"top":0==b?"bottom":"middle",t.fillText((100*(P.preClose?w/P.preClose-1:0)).toFixed(2)+"%",P.offset-3,D,P.offset-3)}t.textAlign="start"}for(b=0,2;i<=c&&f<d&&b<100;){for(f>=P.slots[e].px+P.px.lbl.font/2&&(nt(t,u,f,ut(c)),P.settings.grid&&H(t,f,P.DASHED),m++),h=0;h<2;h++)T=t,void 0,S=gt(c-(h+1)*r/3,e),B=P.w-P.px.lbl.tick-P.px.lbl.w,ft(y=T,k=B,C=S),dt(y,k+P.px.lbl.halftick,C);f=gt(c-=r,e),b++}var y,k,C,T,S,B;0==m&&nt(t,u,f=gt(c=i+o/2,e),ut(c))}else{var D;nt(t,u,D=gt(s,e),s.toFixed(2))}}}function I(t,e,o,s,i,r){if(void 0!==o&&o.hasOwnProperty("length")&&0<o.length){var a,n,l,c,u,f=wt();if(!s){if(l=bt(kt(f[1])),c=gt(i?o[f[1]][4]:o[f[1]-f[0]],e),i){var d,p=[],h={};for((d=[]).push(f[1]),l=bt(kt(f[1])),c=gt(o[f[1]][4],e),h[f[1]]=[+l,+c],a=f[1]-1;a>=f[0];a--)l=bt(kt(a)),c=gt(o[a][4],e),o[a+1][4]<=o[a][4]?d.push(a):p.push(a),h[a]=[+l,+c];for(u=o.length+2,t.lineWidth=1,t.strokeStyle=P.colors.stroke.fenshi||P.colors.stroke.down,t.beginPath(),n=0;n<p.length;n++)(a=p[n])<u-1&&h.hasOwnProperty(a+1)&&ft(t,h[a+1][0],h[a+1][1]),dt(t,h[a][0],h[a][1]),u=a;for(t.stroke(),t.strokeStyle=P.colors.stroke.fenshi||P.colors.stroke.up,t.beginPath(),u=o.length+2,a=0;a<d.length;a++)d[a]<u-1&&h.hasOwnProperty(d[a]+1)&&ft(t,h[d[a]+1][0],h[d[a]+1][1]),dt(t,h[d[a]][0],h[d[a]][1]),u=d[a];t.stroke(),1<o.length?t.strokeStyle=o[1][4]<=o[0][4]?P.colors.stroke.up:P.colors.stroke.down:t.strokeStyle=d,u=o[0][4]}else{var g=!1;for(ft(t,l,c),a=f[1]-f[0];0<=a;a--)l=bt(kt(a+f[0])),(c=gt(o[a],e))>=P.slots[e].px&&c<=P.slots[e].px+P.slots[e].h?g?(g=!1,t.beginPath(),ft(t,l,c)):dt(t,l,c):g||(t.stroke(),g=!0);u=o[0],t.stroke()}t.lineWidth=1,t.fillStyle=P.colors.fill.flags,t.textBaseline="middle",t.font=P.font.labels,r&&lt(t,e,u,ut(u))}}}function A(t,e,o,s){if(void 0!==o&&o.hasOwnProperty("length")&&0<o.length){var i,r,a=wt(),n=[],l=[];if(s)for(i=0;i<=a[1]-a[0];i++)0<o[i]?n.push([i,kt(i+a[0])]):l.push([i,kt(i+a[0])]);else for(i=0;i<=a[1]-a[0];i++)o&&void 0!==o[i]&&(o[i][1]?n.push([i,kt(i+a[0])]):l.push([i,kt(i+a[0])]));for(t.strokeStyle=P.colors.stroke.down,t.fillStyle=P.colors.fill.down,t.beginPath(),i=0;i<l.length;i++)F(t,e,l[i][1],s?o[l[i][0]]:o[l[i][0]][0],!1);for(t.stroke(),t.strokeStyle=P.colors.stroke.up,t.fillStyle=P.colors.fill.up,t.beginPath(),i=0;i<n.length;i++)F(t,e,n[i][1],s?o[n[i][0]]:o[n[i][0]][0]);t.stroke(),s?(r=o[0])<0&&(t.strokeStyle=P.colors.stroke.down):(r=o[0][0],o[0][1]||(t.strokeStyle=P.colors.stroke.down)),t.lineWidth=1,t.fillStyle=P.colors.fill.flags,t.textBaseline="middle",t.font=P.font.labels,lt(t,e,r,ut(r)),t.stroke()}}function M(t,e,o){if(o.hasOwnProperty("length")&&0<o.length){var s,i,r,a=wt(),n=P.slots[e].px+3,l=n+P.slots[e].h-3;for(s=0;s<=a[1]-a[0];s++)i=bt(kt(s+a[0])),(r=gt(o[s],e))<n||l<r||ht(t,i-1,r-1,2,2)}}function E(t,e,o,s,i){var r=gt(s[1],e),a=gt(s[2],e),n=gt(s[3],e),l=gt(s[4],e),c=Math.min(r,l),u=bt(o);i?1==mobile&&pt(t,u-P.px.bar.dx+1,c,P.px.bar.width-2,Math.abs(l-r)):pt(t,u-P.px.bar.dx+1,Math.min(r,l),P.px.bar.width-2,Math.abs(r-l)),ht(t,u-P.px.bar.dx,Math.min(r,l),P.px.bar.width-1,Math.abs(r-l)),a<Math.min(r,l)&&(ft(t,u,a),dt(t,u,Math.min(r,l)-1)),n>Math.max(r,l)&&(ft(t,u,n),dt(t,u,Math.max(r,l))),i&&pt(t,u-P.px.bar.dx,c,P.px.bar.width-1,Math.abs(l-r))}function N(t,e,o,s){var i=gt(s[1],e),r=gt(s[2],e),a=gt(s[3],e),n=gt(s[4],e),l=bt(o);ft(t,l-P.px.bar.dx,i),dt(t,l,i),ft(t,l,n),t.lineTo(.6+(l+P.px.bar.dx|0),.5+(0|n)),ft(t,l,r),dt(t,l,a)}function L(t,e,o,s){var i=gt(s[2],e),r=gt(s[3],e),a=gt(s[4],e),n=bt(o);ft(t,n,a),t.lineTo(.6+(n+P.px.bar.dx|0),.5+(0|a)),ft(t,n,i),dt(t,n,r)}function F(t,e,o,s,i){var r=gt(s,e),a=bt(o),n=gt(0,e),l=Math.abs(n-r),c=Math.min(r,n);r<P.slots[e].px?r=P.slots[e].px:r>P.slots[e].px+P.slots[e].h&&(r=P.slots[e].px+P.slots[e].h),ht(t,a-P.px.bar.dx,c,P.px.bar.width-1<=0?0:P.px.bar.width-1,l),pt(t,a-P.px.bar.dx+1,c+1,P.px.bar.width-2<=0?0:P.px.bar.width-2,l)}function R(t,e){t.lineWidth=mobile?2:1,t.strokeStyle=P.colors.stroke.border;var o=P.offset-1,s=P.slots[e].px-1;ht(t,o<=0?0:o,s<=0?0:s,P.w-P.px.lbl.w-P.offset-P.px.lbl.tick-(o<=0?-o:0),P.slots[e].h+2-(s<=0?-s:0))}function J(t,e,o,s){V(t,e,bt(o),s)}function V(t,e,o,s){var i,r=P.slots[e].px-1,a=P.slots[e].px+P.slots[e].h;if(r<a&&!(a<0||o<0||o>P.w||25e3<o))switch(ft(t,o,r),i=r,s){case P.DOTTED:for(;i<a;)dt(t,o,++i),ft(t,o,++i);break;case P.DASHED:for(;i<a;)dt(t,o,i=a<(i+=6)?a:i),ft(t,o,i+=2);break;case P.DASHDOT:for(;i<a&&(dt(t,o,i=a<(i+=7)?a:i),!(a<=(i+=4)));)ft(t,o,i),dt(t,o,i=a<(i+=2)?a:i),ft(t,o,i+=4);break;case P.SOLID:default:dt(t,o,a)}}function q(t,e,o,s){var i=gt(o,e);i<P.slots[e].px||i>P.slots[e].px+P.slots[e].h||H(t,i,s)}function H(t,e,o){var s,i=P.w-P.px.lbl.tick-P.px.lbl.w-1,r=P.offset;if(r<i)switch(ft(t,i,e),s=i,o){case P.DOTTED:for(;r+1<s;)dt(t,--s,e),ft(t,--s,e);break;case P.DASHED:for(;r<s;)dt(t,s=(s-=6)<r?r:s,e),ft(t,s-=2,e);break;case P.DASHDOT:for(;r<s&&(dt(t,s=(s-=7)<r?r:s,e),!((s-=4)<=r));)ft(t,s,e),dt(t,s=(s-=2)<r?r:s,e),ft(t,s-=4,e);break;case P.SOLID:default:dt(t,r,e)}}function z(t,e,o){if(P.settings.crosshairs&&!(t<P.offset)){var s=P.canvas.i[0].getContext("2d"),i=xt(t),r=Ct(t,e);if(!(null==r||r<0)){var a,n,l,c,u,f,d,p,h,g,b,m=vt(r,e),x=yt(i),v=bt(i);if(U(s),s.textBaseline="middle",s.textAlign="left",s.font=P.font.labels,s.lineWidth=1,s.fillStyle=P.colors.fill.crosshair,s.strokeStyle=P.colors.stroke.crosshair,s.beginPath(),P.showMainCrosshairs)for(P.crossHairH&&H(s,e,P.SOLID),a=0;a<P.slots.length;a++)V(s,a,v,P.SOLID);if(s.stroke(),s.fillStyle=P.colors.fill.crosshair,P.crossHairH&&(o&&(m=P.bars.data[x]&&P.bars.data[x][4]||0),function(t,e,o,s){var i,r=P.w-P.px.lbl.tick-P.px.lbl.w-3;i=P.slots[e].px+1+Math.ceil(P.px.lbl.font/2),o<i?o=i:(i=P.slots[e].px+P.slots[e].h-Math.ceil(P.px.lbl.font/2))<o&&(o=i);ct(t,r,o,s)}(s,r,e,ut(m))),mobile&&P.updateXFK&&P.updateXFK(!0),0<=x&&x<P.bars.data.length){st(s,!0);var w=Y(P.bars.data[x][0],!1,Settings.localTime),y=s.measureText(w).width,k=s.fillStyle,C=s.strokeStyle;s.fillStyle=P.colors.fill.crosshair,s.strokeStyle=P.colors.stroke.crosshair,f=s,d=0|y,p=bt(i),h=0|rt(p,d+10),g=d/2+5|0,b=rt(p,7),f.beginPath(),ft(f,h-g,P.h-1),dt(f,h+g,P.h-1),dt(f,h+g,P.h-P.px.lbl.h),dt(f,b+3.5,P.h-P.px.lbl.h),dt(f,b,P.h-P.px.lbl.h-4),dt(f,b-3.5,P.h-P.px.lbl.h),dt(f,h-g,P.h-P.px.lbl.h),dt(f,h-g,P.h-1),f.fill(),f.stroke(),s.fillStyle=k,s.strokeStyle=C,n=s,l=w,c=rt(bt(i),y+10),u=P.h-(P.px.lbl.h-P.px.lbl.font)/2,n.fillText(l,c,u),function(t){var e,o,s,i,r,a=P.canvas.lbl[0].getContext("2d"),n=~~(1.25*P.px.lbl.font),l=wt(),c=yt(0),u=yt(t),f=(P.colors.stroke.i,P.w-P.px.lbl.tick-P.px.lbl.w-2);l[0],l[1],c<0&&(t+=c),t<0&&(t=-1),a.strokeStyle=P.colors.fill.blankBG,a.lineWidth=1.5,a.fillStyle=P.colors.fill.slottext,a.textBaseline="top",a.font=P.font.indicators;var d=3+P.offset,p=3+P.offset;for(a.clearRect(0,0,P.w,P.h),e=0;e<P.slots.length;e++)if(P.slots[e].hasOwnProperty("main")){if(i=G(u),s=P.slots[e].px+1,a.strokeText(i,p,s,f),a.fillText(i,p,s,f),p=6+P.offset+a.measureText(i).width,1==P.colors.stroke.priceShow){var h=P.w-P.px.lbl.tick-P.px.lbl.w,g=P.canvas.base[0].getContext("2d"),b=h-g.measureText(ut(P.price.high)).width-3;p=h-g.measureText(ut(P.price.low)).width-3,a.clearRect(b,s,f,13),a.strokeText(ut(P.price.high),b,s,f),a.fillText(ut(P.price.high),b,s,f);var m=P.slots[e].h-14;a.strokeText(ut(P.price.low),p,m,f),a.fillText(ut(P.price.low),p,m,f)}for(o=0;o<P.slots[e].u.length;o++)if((r=P.slots[e].u[o].i).hasOwnProperty("label")){if(s+n>P.slots[e].px+P.slots[e].h)break;1!=mobile?(i=r.label(t),a.fillStyle=B(e,o,"u"),p+a.measureText(i).width+2>f&&(s+=n,p=2),a.fillText(i,p,s,f),p+=a.measureText(i).width+2):(i=r.label(t),a.fillStyle=B(e,o,"u"),a.fillText(i,d,s,f),s+=n)}for(o=0;o<P.slots[e].o.length;o++)if((r=P.slots[e].o[o].i).hasOwnProperty("label")){if((s+=n)+n>P.slots[e].px+P.slots[e].h)break;1!=mobile?(i=r.label(t),a.fillStyle=B(e,o,"o"),p+a.measureText(i).width+2>f&&(s+=n,p=2),a.fillText(i,p,0,f),p+=a.measureText(i).width+2):(i=r.label(t),a.fillStyle=B(e,o,"o"),a.fillText(i,d,s,f))}a.fillStyle=P.colors.fill.flagtext}else{if(!(r=P.slots[e].i).hasOwnProperty("label"))continue;i=r.label(t),s=P.slots[e].px+1,a.fillText(i,d,s,f)}}(i)}P.px.crosshairs.x=v,P.px.crosshairs.y=e,P.mouse.bar=i}}}function U(t){if(P.settings.crosshairs){var e=t||P.canvas.i[0].getContext("2d");e.clearRect(0,P.px.crosshairs.y-30,P.w,60),e.clearRect(P.px.crosshairs.x-30,0,60,P.h),e.clearRect(0,P.h-P.px.lbl.h-4,P.w,P.px.lbl.h+4),P.mouse.bar=null,P.canvas.lbl[0].getContext("2d").clearRect(0,0,P.w,P.h)}}function G(t){var e,o;if(P.curIndex=t,e=t,P.mode.display!=P.CANDLE&&(o=e<0||e>P.bars.data.length?[(new Date).getTime(),0,0,0,0,0]:P.bars.data[e])&&($("#time").text(new Date(o[0]).Format("hh:mm")),$("#price").text(o[4].toFixed(6)),$("#volume").text(o[5].toFixed(0)),$("#updown").text((0==o[4]?0:o[4]-P.preClose).toFixed(6)),$("#price").css("color",o[4]>=P.preClose?"red":"green"),$("#updown").css("color",o[4]>=P.preClose?"red":"green")),t<0||t>=P.bars.data.length)return"";if(0!=Ct(P.mouse.x,P.mouse.y)&&1!=Ct(P.mouse.x,P.mouse.y)&&2!=Ct(P.mouse.x,P.mouse.y)&&3!=Ct(P.mouse.x,P.mouse.y)||(P.curIndex=t,mobile&&P.updateXFK&&P.updateXFK(!1)),void 0===P.bars.data[t])return"";var s=P.bars.data[t][0],i=P.bars.data[t][1],r=P.bars.data[t][2],a=P.bars.data[t][3],n=P.bars.data[t][4],l=(P.bars.data[t][5],[]),c=P.bars.data[t+1];return l=[Y(s,!1,Settings.localTime),"  "," O:",ut(i)," H:",ut(r)," L:",ut(a)," C:",ut(n)," CHANGE:",(c?100*(n-c[4])/c[4]:0).toFixed(2)+"%"," AMPLITUDE:",(c?100*(r-a)/c[4]:0).toFixed(2)+"%"],"cn"==localStorage.lang&&(l=[Y(s,!1,Settings.localTime),"  "," å¼€:",ut(i)," é«˜:",ut(r)," ä½Ž:",ut(a)," æ”¶:",ut(n)," æ¶¨å¹…:",(c?100*(n-c[4])/c[4]:0).toFixed(2)+"%"," æŒ¯å¹…:",(c?100*(r-a)/c[4]:0).toFixed(2)+"%"]),mobile?"":l.join("")}function Y(t,e,o){var s=new Date(t),i="";return!0===o?(i=s.getFullYear()+"-",i+=s.getMonth()+1<10?"0":"",i+=s.getMonth()+1+"-",i+=s.getDate()<10?"0":"",i+=s.getDate()+" ",i+=s.getHours()<10?"0":"",i+=s.getHours()+":",i+=s.getMinutes()<10?"0":"",i+=s.getMinutes(),e&&(i+=(s.getSeconds(),"0"),i+=s.getSeconds())):(i=s.getUTCFullYear()+"-",i+=s.getUTCMonth()+1<10?"0":"",i+=s.getUTCMonth()+1+"-",i+=s.getUTCDate()<10?"0":"",i+=s.getUTCDate()+" ",i+=s.getUTCHours()<10?"0":"",i+=s.getUTCHours()+":",i+=s.getUTCMinutes()<10?"0":"",i+=s.getUTCMinutes(),e&&(i+=(s.getUTCSeconds(),"0"),i+=s.getUTCSeconds())),i}Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var o in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[o]:("00"+e[o]).substr((""+e[o]).length)));return t};var W=[_("Jan"),_("Feb"),_("Mar"),_("Apr"),_("May"),_("Jun"),_("Jul"),_("Aug"),_("Sep"),_("Oct"),_("Nov"),_("Dec")];function X(t,e){var o=new Date(t);return!0===e?o.getFullYear():o.getUTCFullYear()}function K(t,e){var o=new Date(t);return!0===e?o.getMonth()+1:o.getUTCMonth()+1}function Z(t,e){var o=new Date(t);return!0===e?W[o.getMonth()]:W[o.getUTCMonth()]}function Q(t,e,o){var s=new Date(t),i="";return!0===o?(e&&(i=s.getFullYear()+"/"),i+=s.getMonth()+1+"/",i+=s.getDate()):(e&&(i=s.getUTCFullYear()+"/"),i+=s.getUTCMonth()+1+"/",i+=s.getUTCDate()),i}function tt(t,e){var o=new Date(t),s="";return s+=!0===e?o.getDate():o.getUTCDate()}function et(t,e,o){var s=new Date(t),i="";return!0===o?(i=s.getHours()+":",i+=s.getMinutes()<10?"0":"",i+=s.getMinutes(),e&&(i+=":"+(s.getSeconds()<10?"0":""),i+=s.getSeconds())):(i=s.getUTCHours()+":",i+=s.getUTCMinutes()<10?"0":"",i+=s.getUTCMinutes(),e&&(i+=":"+(s.getUTCSeconds()<10?"0":""),i+=s.getUTCSeconds())),i}function ot(t,e){if(!0!==e)return t%86400==0;var o=new Date(t);return 0==o.getHours()&&0==o.getMinutes()&&0==o.getSeconds()}function st(t,e){t.textBaseline="bottom",t.textAlign="center";var o=P.font.size+"px/"+P.font.lineHeight+"em "+P.font.face;t.fillStyle=e?(o+=" bold",P.colors.stroke.crosshair):P.colors.fill.label,t.font=o}function it(t,e,o){var s=P.h-(P.px.lbl.h-P.px.lbl.font)/2,i=bt(o);t.fillText(e,i,s)}function rt(t,e){return t>P.w-P.px.lbl.w-P.px.lbl.tick-1-e/2?P.w-P.px.lbl.w-P.px.lbl.tick-1-e/2:t<e/2?e/2:t}function at(t,e,o,s){var i=gt(o,e);nt(t,P.w-P.px.lbl.tick-P.px.lbl.w,i,s)}function nt(t,e,o,s){ft(t,e,o),dt(t,e+P.px.lbl.tick,o),t.fillText(s,e+P.px.lbl.tick+2,o,P.px.lbl.w)}function lt(t,e,o,s){if(1!=P.colors.stroke.opacity){var i,r=gt(o,e),a=P.w-P.px.lbl.tick-P.px.lbl.w-3;r<(i=P.slots[e].px+1+Math.ceil(P.px.lbl.font/2))?r=i:(i=P.slots[e].px+P.slots[e].h-Math.ceil(P.px.lbl.font/2))<r&&(r=i),ct(t,a,r,s)}}function ct(t,e,o,s){var i,r,a=P.px.lbl.font/2;t.beginPath(),ft(t,e,o),dt(t,i=e+~~a,r=~~(o-1-a)),i=e+P.px.lbl.w+P.px.lbl.tick+1,t.lineTo(.6+(0|i),.5+(0|r)),ft(t,i,r),dt(t,i,r=Math.ceil(o+1+a)),dt(t,i=e+~~a,r),dt(t,e,o),t.fill(),t.stroke(),t.fillStyle=P.colors.fill.flagtext,t.fillText(s,e+P.px.lbl.tick+5,o+1)}function ut(t){return t.toFixed(void 0===Data.qouteFixed?8:Data.qouteFixed)}function ft(t,e,o){t.moveTo(.5+(0|e),.5+(0|o))}function dt(t,e,o){t.lineTo(.5+(0|e),.5+(0|o))}function pt(t,e,o,s,i){t.fillRect(0|e,0|o,0|s,0|i)}function ht(t,e,o,s,i){t.strokeRect(.5+(0|e),.5+(0|o),0|s,0|i)}function gt(t,e){var o,s=null;if(P.slots[e].hasOwnProperty("main")){if(s=[P.price.low,P.price.high],P.settings.logscale)return P.log.m*log10(t)+P.log.b;o=P.price.range}else s=P.slots[e].i.bounds(),o=Math.max(s[1]-s[0],1e-8);var i=(s[1]-t)/o;return P.slots[e].px+Math.ceil(P.slots[e].h*i)}function bt(t){var e=wt();return P.bars.visible>P.bars.data.length?mt(t)-mt(e[1])+(P.px.bar.width+1)/2:mt(t)}function mt(t){return P.w-P.px.lbl.w-P.px.lbl.tick-1-(t+1)*(P.px.bar.spacing+P.px.bar.width)+(P.px.bar.width+1)/2|0}function xt(t){var e,o=wt();return P.bars.visible>P.bars.data.length?o[1]-(t-(P.px.bar.spacing+P.px.bar.width)/2)/(P.px.bar.spacing+P.px.bar.width)|0:(e=t,(P.w-P.px.lbl.w-P.px.lbl.tick-1-P.px.bar.spacing/2-e)/(P.px.bar.spacing+P.px.bar.width)|0)}function vt(t,e){var o=null;if(P.slots[t].hasOwnProperty("main")){if(P.settings.logscale)return Math.pow(10,(e-P.log.b)/P.log.m);o=[P.price.low,P.price.high]}else o=P.slots[t].i.bounds();var s=Math.max(o[1]-o[0],1e-8),i=(e-P.slots[t].px)/P.slots[t].h;return o[1]-i*s}function wt(){return void 0===P.bars.data||0==P.bars.data.length?[0,-1]:[Math.max(0,yt(0)),Math.min(P.bars.data.length-1,yt(P.bars.visible))]}function yt(t){return t+P.bars.offset-P.bars.blank}function kt(t){return t-P.bars.offset+P.bars.blank}function Ct(t,e){if(t>=P.w-P.px.lbl.w-P.px.lbl.tick-1)return null;if(t<P.offset)return null;if(e>=P.h-P.px.lbl.h-1)return null;if(e<=P.slots[0].px+P.slots[0].h)return 0;for(var o=1;o<P.slots.length;o++){if(e<P.slots[o].px)return-o;if(e<=P.slots[o].px+P.slots[o].h)return o}}function Tt(t,e){return!(e<P.h-P.px.lbl.h)&&(!(t>P.w-P.px.lbl.w)&&!(t<P.offset))}function St(){P.settings.crosshairs&&window.reqAnimFrame(function(){U()})}function Bt(t,e,o,s,i,r,a){var n=new Array(s,i),l=new Array(r,a);t.fillStyle=P.colors.stroke.arrow,t.strokeStyle=P.colors.stroke.arrow,t.beginPath(),t.translate(e,o,0),t.moveTo(n[0],n[1]),t.lineTo(l[0],l[1]),t.fill(),t.stroke(),t.save(),t.translate(l[0],l[1]);var c=(l[0]-n[0])/(l[1]-n[1]);c=Math.atan(c),0<=l[1]-n[1]?t.rotate(-c):t.rotate(Math.PI-c),t.lineTo(-5,-10),t.lineTo(0,-5),t.lineTo(5,-10),t.lineTo(0,0),t.fill(),t.restore(),t.closePath()}var Dt,Pt,Ot,It=0,At=0;function Mt(){P.canvas.i.on({mousedown:function(t){if(!P.stopEvent&&!mobile){P.mouse.origOffset=P.bars.offset,P.mouse.origOffsetBlank=P.bars.blank,P.mouse.origSpacing=P.px.bar.spacing,Nt(t),P.mouse.sx=P.mouse.x,P.mouse.sy=P.mouse.y,Pt=t.offsetX,Ot=t.offsetY;var e,o,s=Ct(P.mouse.x,P.mouse.y);if(null==s?(Tt(P.mouse.x,P.mouse.y)?(P.canvas.i.css("cursor","e-resize"),P.mouse.zoom=!0,P.mouse.w0=+P.px.bar.width):P.canvas.i.css("cursor","default"),St()):s<0?(P.canvas.i.css("cursor","n-resize"),P.mouse.resize=!0,P.mouse.re_slot=-s,P.mouse.re_slots.px0=P.slots[P.mouse.re_slot-1].px,P.mouse.re_slots.h0=P.slots[P.mouse.re_slot-1].h,P.mouse.re_slots.px1=P.slots[P.mouse.re_slot].px,P.mouse.re_slots.h1=P.slots[P.mouse.re_slot].h,St()):(P.mouse.down=!0,St(),P.settings.crosshairs?(P.canvas.i.css("cursor","none"),window.reqAnimFrame(function(){z(P.mouse.x,P.mouse.y)})):P.canvas.i.css("cursor","crosshair")),P.settings.icontrols&&s!=P.mouse.slot)for(null!=s&&0<=s&&$(".control-"+s,P.element).show(),e=0;e<P.slots.length;e++)e!=s&&((o=$(".control-"+e,P.element)).data("popped")||o.hide());P.mouse.slot=s,Ft(t),t.preventDefault(),t.stopPropagation()}},mouseup:function(t){P.stopEvent||mobile||(P.mouse.down=!1,P.mouse.resize=!1,P.mouse.zoom=!1,Math.abs(Pt-t.offsetX)<1&&Math.abs(Ot-t.offsetY)<1&&(P.notClicked=!P.notClicked,$(P.element).focus(),S()),Ft(t),Tt(P.mouse.x,P.mouse.y)?P.canvas.i.css("cursor","e-resize"):P.canvas.i.css("cursor","none"),t.ctrlKey&&t.shiftKey&&0<=Ct(P.mouse.x,P.mouse.y)&&P.settings.crosshairs&&(P.canvas.i.css("cursor","none"),z(P.mouse.x,P.mouse.y)))},contextmenu:function(t){return Nt(t),0<=Ct(P.mouse.x,P.mouse.y)&&P.settings.crosshairs&&(P.canvas.i.css("cursor","none"),z(P.mouse.x,P.mouse.y)),t.stopPropagation(),t.preventDefault(),!1},mouseout:function(t){P.mouse.down=!1,P.mouse.resize=!1,P.mouse.zoom=!1,P.canvas.i.css("cursor","none"),St(),P.mouse.slot=-1},mousemove:function(t){if(!mobile&&((P.mouse.down||P.mouse.resize||P.mouse.zoom)&&(P.flags.recompute=!0,Ft(t)),t.offsetY!=It||t.offsetX!=At)){It=t.offsetY,At=t.offsetX,Nt(t);var e,o,s=Ct(P.mouse.x,P.mouse.y);P.canvas.i[0].getContext("2d");if(null==s?(Tt(P.mouse.x,P.mouse.y)?P.canvas.i.css("cursor","e-resize"):P.canvas.i.css("cursor","default"),St()):s<0?(P.canvas.i.css("cursor","n-resize"),St()):P.settings.crosshairs?(P.canvas.i.css("cursor","none"),window.reqAnimFrame(function(){z(P.mouse.x,P.mouse.y)})):P.canvas.i.css("cursor","crosshair"),P.settings.icontrols&&s!=P.mouse.slot)for(null!=s&&0<=s&&$(".control-"+s,P.element).show(),e=0;e<P.slots.length;e++)e!=s&&((o=$(".control-"+e,P.element)).data("popped")||o.hide());P.mouse.slot=s,(P.mouse.down||P.mouse.resize||P.mouse.zoom)&&(P.mouse.down||P.mouse.zoom?$(P.canvas.i).css("cursor","e-resize"):P.canvas.i.css("cursor","n-resize"))}},dblclick:function(t){P.stopEvent||(P.mode.display,P.CANDLE,P.mouse.down=!1)},touchstart:function(t){if(1==t.originalEvent.touches.length&&(timeOutEvent=setTimeout(function(){Dt=!0,$t(t),$(".chartDetail").show(),$("html,body",parent.document).addClass("hidden")},300)),P.mouse.origOffset=P.bars.offset,P.mouse.origSpacing=P.px.bar.spacing,t.originalEvent.touches[0].clientX)P.mouse.sx=t.originalEvent.touches[0].clientX,P.mouse.sy=t.originalEvent.touches[0].clientY;else if(t.originalEvent.touches[0].pageX){var e=P.canvas.i.offset();P.mouse.sx=t.originalEvent.touches[0].pageX-e.left,P.mouse.sy=t.originalEvent.touches[0].pageY-e.top}P.startTouchCoords=[];for(var o=0;o<t.originalEvent.touches.length;++o)P.startTouchCoords.push([t.originalEvent.touches[o].clientX,t.originalEvent.touches[o].clientY])},touchmove:function(t){var e,o;if(t.originalEvent.touches[0].clientX)e=t.originalEvent.touches[0].clientX,o=t.originalEvent.touches[0].clientY;else if(t.originalEvent.touches[0].pageX){var s=P.canvas.i.offset();e=t.originalEvent.touches[0].pageX-s.left,o=t.originalEvent.touches[0].pageY-s.top}(6<Math.abs(P.mouse.sx-e)||6<Math.abs(P.mouse.sy-o))&&clearTimeout(timeOutEvent),0!=Dt?$t(t):function(t){if(P.bars.allowScale=!0,(new Date).getTime()-P.lastPinchTime<1e3)return;if(2==t.originalEvent.touches.length&&2==P.startTouchCoords.length){var e=Math.sqrt(Math.pow(P.startTouchCoords[0][0]-P.startTouchCoords[1][0],2)+Math.pow(P.startTouchCoords[0][1]-P.startTouchCoords[1][1],2)),o=Math.sqrt(Math.pow(t.originalEvent.touches[0].clientX-t.originalEvent.touches[1].clientX,2)+Math.pow(t.originalEvent.touches[0].clientY-t.originalEvent.touches[1].clientY,2)),s=o/e;if(1<s&&(s*=1.3),s<1&&(s*=.7),null!=s){w=P.px.bar.width;var i=Math.round(P.px.bar.width*s);P.px.bar.width=i+(i+1)%2,P.px.bar.width<2&&(P.px.bar.width=2),51<P.px.bar.width&&(P.px.bar.width=51),P.px.bar.width!=w&&(_t(),S(),Lt()),P.lastZoomTime=(new Date).getTime()}return}if(1<t.originalEvent.touches.length)return;if((new Date).getTime()-P.lastZoomTime<1e3)return;P.flags.recompute=!0,P.bars.offset=P.mouse.origOffset+Math.round((t.originalEvent.touches[0].clientX-P.mouse.sx)/(P.px.bar.width+P.px.bar.spacing)),_t(),P.bars.offset!=P.mouse.origOffset&&(S(),Lt());P.canvas.i.css("cursor","e-resize")}(t)},touchend:function(t){clearTimeout(timeOutEvent),Dt=!1,$(".chartDetail").hide(),$("html,body",parent.document).removeClass("hidden"),function(t){if(P.bars.allowScale=!0,1==t.originalEvent.changedTouches.length&&1==P.startTouchCoords.length&&P.startTouchCoords[0][1]!=t.originalEvent.changedTouches[0].clientY&&Math.abs((P.startTouchCoords[0][0]-t.originalEvent.changedTouches[0].clientX)/(P.startTouchCoords[0][1]-t.originalEvent.changedTouches[0].clientY))<.15){var e=Ct(P.mouse.sx,P.mouse.sy),o=0;o=t.originalEvent.changedTouches[0].clientY>P.startTouchCoords[0][1]?1:-1,0==e?(P.currentOverlay=(P.currentOverlay+P.mobileOverlays.length+o)%P.mobileOverlays.length,function(t){if(P.overlays.hasOwnProperty(t)){for(;0<P.slots[0].u.length;)C(P.slots[0].u.length-1,"u",0);l(t)}}(P.mobileOverlays[P.currentOverlay])):0<e&&(P.currentIndicator=(P.currentIndicator+P.mobileIndicators.length+o)%P.mobileIndicators.length,function(t){if(P.indicators.hasOwnProperty(t)){for(;2<P.slots.length;)T(P.slots.length-1);c(t)}}(P.mobileIndicators[P.currentIndicator]))}}(t),St()}}),window.MouseWheel.addMouseWheelHandler($(P.canvas.i),Et),P.canvas.i.bind("pinch",t),BJBTC.handler("barclose",P.element,Yt)}function Et(t,e,o,s){if(!(P.stopEvent||P.notClicked||(stopEvent(t),isNaN(s)||isNaN(o)))){if(0!=o){var i=P.px.bar.width;P.px.bar.width+=o,Rt(),P.px.bar.width<2&&(P.px.bar.width=2),51<P.px.bar.width&&(P.px.bar.width=51),P.px.bar.width!=i&&(_t(),S(),Lt())}localStorage.barWidth=P.px.bar.width}}function Nt(t){if(t.offsetX)P.mouse.x=t.offsetX,P.mouse.y=t.offsetY;else if(t.pageX){var e=P.canvas.i.offset();P.mouse.x=t.pageX-e.left,P.mouse.y=t.pageY-e.top}}function t(t,e){if(null!=e.scale){w=P.px.bar.width;var o=Math.round(P.px.bar.width*e.scale);P.px.bar.width=o+(o+1)%2,P.px.bar.width<2&&(P.px.bar.width=2),51<P.px.bar.width&&(P.px.bar.width=51),P.px.bar.width!=w&&(_t(),S(),Lt()),P.lastPinchTime=(new Date).getTime()}e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()}function $t(t){t.pageX=t.originalEvent.touches[0].pageX,t.pageY=t.originalEvent.touches[0].pageY,Nt(t);var e=Ct(P.mouse.x,P.mouse.y);P.canvas.i[0].getContext("2d");null==e?St():e<0?(P.canvas.i.css("cursor","n-resize"),St()):P.settings.crosshairs?(P.canvas.i.css("cursor","none"),window.reqAnimFrame(function(){z(P.mouse.x,P.mouse.y)})):P.canvas.i.css("cursor","crosshair"),P.mouse.slot=e,t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()}function Lt(){-1<wt()[1]&&P.bars.offset>=P.bars.data.length-P.bars.visible+P.bars.blank+P.bars.endpad-3&&Data.loadPrev(Ht())}function Ft(t){if(Nt(t),P.mouse.down)if(t.ctrlKey){var e=P.px.bar.spacing;P.px.bar.spacing=P.mouse.origSpacing+Math.round((P.mouse.sx-P.mouse.x)/10),P.px.bar.spacing<0&&(P.px.bar.spacing=0),51<P.px.bar.spacing&&(P.px.bar.spacing=51),P.px.bar.spacing!=e&&(S(),Lt())}else 0==P.mouse.origOffsetBlank&&(P.bars.offset=P.mouse.origOffset+Math.round((P.mouse.x-P.mouse.sx)/(P.px.bar.width+P.px.bar.spacing))),0==P.mouse.origOffset&&(P.bars.blank=P.mouse.origOffsetBlank+Math.round((P.mouse.sx-P.mouse.x)/(P.px.bar.width+P.px.bar.spacing)),Rt()),_t(),P.bars.offset==P.mouse.origOffset&&0!=P.bars.offset||(S(),Lt());else if(P.mouse.zoom){var o=P.mouse.x-P.mouse.sx,s=+P.px.bar.width;P.px.bar.width=P.mouse.w0-2*(o/10|0),P.px.bar.width<3&&(P.px.bar.width=3),51<P.px.bar.width&&(P.px.bar.width=51),P.px.bar.width!=s&&(_t(),S(),Lt())}else if(P.mouse.resize){var i=P.mouse.y-P.mouse.sy;if(P.slots[P.mouse.re_slot-1].h=P.mouse.re_slots.h0+i,P.slots[P.mouse.re_slot-1].h<P.px.slotmin&&(i=P.px.slotmin-P.mouse.re_slots.h0,P.slots[P.mouse.re_slot-1].h=P.px.slotmin),P.slots[P.mouse.re_slot].h=P.mouse.re_slots.h1-i,P.slots[P.mouse.re_slot].px=P.mouse.re_slots.px1+i,P.slots[P.mouse.re_slot].h<P.px.slotmin&&(i=P.mouse.re_slots.h1-P.px.slotmin,P.slots[P.mouse.re_slot].h=P.px.slotmin,P.slots[P.mouse.re_slot].px=P.mouse.re_slots.px1+i),P.slots[P.mouse.re_slot-1].h=P.mouse.re_slots.h0+i,P.slots[P.mouse.re_slot-1].h<P.px.slotmin){var r=(P.slots[P.mouse.re_slot-1].h+P.slots[P.mouse.re_slot].h)/2;P.slots[P.mouse.re_slot].h=r,P.slots[P.mouse.re_slot-1].h=r,P.slots[P.mouse.re_slot].px=P.slots[P.mouse.re_slot-1].px+P.slots[P.mouse.re_slot-1].h+P.px.pad+3}for(var a=0;a<P.slots.length;a++)$(".control-"+a,P.element).css("top",P.slots[a].px+3+"px");S()}}function _t(){P.bars.offset>P.bars.data.length-P.bars.visible+P.bars.blank+P.bars.endpad&&(P.bars.offset=P.bars.data.length-P.bars.visible+P.bars.blank+P.bars.endpad),P.bars.offset<0&&(P.bars.offset=0)}function Rt(){var t=0|parseInt((P.w-P.px.lbl.tick-P.px.lbl.w-1)/(P.px.bar.width+P.px.bar.spacing)),e=0;e=P.bars.data.length>t?t/2:P.bars.data.length>t/2?(P.bars.data.length-t/2)/2:0,e=parseInt(e),P.bars.blank>e&&(P.bars.blank=e),P.bars.blank<0&&(P.bars.blank=0)}function jt(){P.resize.avail=P.h-(P.slots.length*(2+P.px.pad)-P.px.pad-1+P.px.lbl.h),P.resize.slots=[],P.resize.pct=[];for(var t=0;t<P.slots.length;t++)P.resize.slots.push(P.slots[t].h),P.resize.pct.push(P.slots[t].h/P.resize.avail);e()}function Jt(){var t=$(P.element).width(),e=$(P.element).height();if(P.w!=t||P.h!=e){P.w=t,P.h=e,$("canvas",P.element).each(function(t,e){$(e).attr("width",P.w+"px").attr("height",P.h+"px")}),$("canvas",P.element).attr("val",!1),Vt();P.canvas.i[0].getContext("2d");P.canvas.line[0].getContext("2d"),Rt(),S()}}function Vt(){var t,e,o=(P.slots.length-1)*(2+P.px.pad)+1+P.px.lbl.h,s=P.h-o,i=-1,r=0;for(t=0;t<P.slots.length;t++)P.slots[t].h=P.resize.pct[t]*s|0,P.slots[t].px=i,i+=P.slots[t].h+2+P.px.pad,r+=P.slots[t].h;for(t=0;r<s;){for(P.slots[t%P.slots.length].h+=1,r+=1,e=1+t%P.slots.length;e<P.slots.length;e++)P.slots[e].px+=1;t++}for(t=0;s<r;){for(P.slots[t%P.slots.length].h-=1,r-=1,e=1+t%P.slots.length;e<P.slots.length;e++)P.slots[e].px-=1;t++}for(t=0;t<P.slots.length;t++)$(".control-"+t,P.element).css("top",P.slots[t].px+3+"px")}function qt(){Vt(),S()}function Ht(){return P.period.avail[P.period.current]}function zt(){switch(P.mode.current){case P.TIME_BAR:return Ut();case P.VOL_BAR:return e=void 0===t?P.volume.avail[P.volume.current]:t,(e|=0)<1e3?"V"+e:e<1e6?"V"+~~(e/1e3)+"K":e<1e9?"V"+~~(e/1e6)+"M":"V"+~~(e/1e9)+"B";default:return""}var t,e}function Ut(t){var e=void 0===t?P.period.avail[P.period.current]:t;return 0==e?"Ticks":e<60?"S"+e:e<3600?"M"+(e/60|0):e<86400?"H"+(e/3600|0):e<604800?"D"+(e/86400|0):e<2592e3?"W"+(e/604800|0):(e/2592e3|0)+"M"}function Gt(){var t=BJBTC.exchangeName()+" "+BJBTC.base()+"/"+BJBTC.quote()+", "+zt();P.module.setTitle(t)}function Yt(t){void 0===t&&(t=Ht()),isNaN(+t)||P.mode.current==P.TIME_BAR&&t==P.period.avail[P.period.current]&&(P.bars.data=Data.data.bars[t],S())}return{build:function(t,e,o){return P.element=t,P.parent=e,$(P.element).empty(),P.w=$(P.element).width(),P.h=$(P.element).height(),P.canvas.base=$("<canvas/>").attr("width",P.w+"px").attr("height",P.h+"px").attr("z-index",100),P.canvas.bg=$("<canvas/>").attr("width",P.w+"px").attr("height",P.h+"px").attr("z-index",101),P.canvas.main=$("<canvas/>").attr("width",P.w+"px").attr("height",P.h+"px").attr("z-index",102),P.canvas.fg=$("<canvas/>").attr("width",P.w+"px").attr("height",P.h+"px").attr("z-index",103),P.canvas.orders=$("<canvas/>").attr("width",P.w+"px").attr("height",P.h+"px").attr("z-index",104),P.canvas.lbl=$("<canvas/>").attr("width",P.w+"px").attr("height",P.h+"px").attr("z-index",105),P.canvas.line=$("<canvas/>").attr("width",P.w+"px").attr("height",P.h+"px").attr("z-index",106).attr("class","line"),P.canvas.i=$("<canvas/>").attr("width",P.w+"px").attr("height",P.h+"px").attr("z-index",107),$(P.element).append(P.canvas.base).append(P.canvas.bg).append(P.canvas.main).append(P.canvas.fg).append(P.canvas.orders).append(P.canvas.lbl).append(P.canvas.line).append(P.canvas.i),P.canvas.line[0].getContext("2d"),Mt(),i(o),function(){var t,e,o;for(t=0;t<P.slots.length;t++){if(P.slots[t].hasOwnProperty("main")){for(e=0;e<P.slots[t].u.length;e++)o=void 0!==P.slots[t].u[e].c&&null!=P.slots[t].u[e].c?P.slots[t].u[e].c:B(t),P.slots[t].u[e].i=(new Indicator).build(P.slots[t].u[e].t,P.slots[t].u[e].s).color(o);for(e=0;e<P.slots[t].o.length;e++)o=void 0!==P.slots[t].o[e].c&&null!=P.slots[t].o[e].c?P.slots[t].o[e].c:B(t),P.slots[t].o[e].i=(new Indicator).build(P.slots[t].o[e].t,P.slots[t].o[e].s).color(o)}else P.slots[t].i=(new Indicator).build(P.slots[t].t,P.slots[t].s);P.slots[t].control=f(t),$(P.element).append(P.slots[t].control)}}(),$(P.element).attr("tabindex",0).keydown(function(t){if(37==t.keyCode||39==t.keyCode){if(P.mouse.x<0&&(P.mouse.x=0),P.mouse.x>bt(0)&&(P.mouse.x=bt(0)),37==t.keyCode){P.mode.display,P.CANDLE;var e=P.mouse.x-P.px.bar.width-P.px.bar.spacing;(o=xt(e<0?0:e))>P.bars.visible-4?yt(o)<P.bars.data.length&&(P.bars.offset++,S()):(P.mouse.x-=P.px.bar.width+P.px.bar.spacing,P.mouse.x<0&&(P.mouse.x=0))}else if(39==t.keyCode){var o;0==(o=xt(P.mouse.x+P.px.bar.width+P.px.bar.spacing))&&0<P.bars.offset?(P.bars.offset--,S()):P.mouse.x+=P.px.bar.width+P.px.bar.spacing}P.bars.data[yt(xt(P.mouse.x))]&&(P.mouse.y=gt(P.bars.data[yt(xt(P.mouse.x))][4],0)),window.reqAnimFrame(function(){z(P.mouse.x,P.mouse.y,!0)})}}),n(),window.setTimeout(function(){BJBTC.trigger("what-theme",null)},100),$(P.element).on("mouseleave",function(){!function(){var t,e;for(t=0;t<P.slots.length;t++)(e=$(".control-"+t,P.element)).data("popped")||e.hide()}()}),$(P.element).on("keydown",function(t){38==t.keyCode&&Et(P.element,0,0,1),40==t.keyCode&&Et(P.element,0,0,-1)}),this},lblWidth:function(){return P.px.lbl.w},module:function(t){return P.module=t,Gt(),BJBTC.handler("barclose",P.module.id(),P.self.onBarClose),BJBTC.handler("theme",P.module.id(),P.self.onTheme),BJBTC.handler("trade",P.module.id(),P.self.onTrade),BJBTC.handler("bidask",P.module.id(),P.self.bidask),BJBTC.handler("orders",P.module.id(),p),BJBTC.handler("order-canceled",P.module.id(),o),this},self:function(t){return P.self=t,this},settings:function(){return function(){var t,e=[],o=[],s=[{val:0,text:_("Indicatorâ€¦")}],i=[{val:0,text:_("Overlayâ€¦")}];for(t=0;t<P.period.avail.length;t++)e.push({val:P.period.avail[t],text:Ut(P.period.avail[t])});for(t=0;t<P.mode.avail_display.length;t++)o.push({val:t,text:P.mode.avail_display[t]});for(t in P.indicators)P.indicators.hasOwnProperty(t)&&s.push({val:t,text:P.indicators[t]});for(t in P.overlays)P.overlays.hasOwnProperty(t)&&i.push({val:t,text:P.overlays[t]});return[$("<p/>").append(BJBTC.select(P.period.avail[P.period.current],e,function(t){P.period.current=P.period.avail.indexOf(+t),Gt(),S()})).append($("<span/>").addClass("control-label").html(_("Time Period"))),$("<p/>").append(BJBTC.select(P.mode.display,o,function(t){P.mode.display=+t,S()})).append($("<span/>").addClass("control-label").html(_("Draw Style"))),$("<p/>").append(BJBTC.toggle(P.settings.bidask,function(){P.settings.bidask=!0},function(){P.settings.bidask=!1},function(){S()})).append($("<span/>").addClass("control-label").html(_("Show Bid / Ask"))),$("<p/>").append(BJBTC.toggle(P.settings.crosshairs,function(){P.settings.crosshairs=!0},function(){P.settings.crosshairs=!1},function(){S()})).append($("<span/>").addClass("control-label").html(_("Show Crosshair"))),$("<p/>").append(BJBTC.toggle(P.settings.grid,function(){P.settings.grid=!0},function(){P.settings.grid=!1},function(){S()})).append($("<span/>").addClass("control-label").html(_("Show Grid"))),$("<p/>").append(BJBTC.toggle(P.settings.icontrols,function(){P.settings.icontrols=!0},function(){P.settings.icontrols=!1;for(var t=0;t<P.slots.length;t++)$(".control-"+t,P.element).hide().data("popped",!1)},function(){S()})).append($("<span/>").addClass("control-label").html(_("Show Indicator Controls"))),$("<p/>").append(BJBTC.toggle(P.settings.logscale,function(){P.settings.logscale=!0},function(){P.settings.logscale=!1},function(){S()})).append($("<span/>").addClass("control-label").html(_("Logarithmic Scale"))),$("<p/>").append(BJBTC.select(0,i,function(t){0!=+t&&l(t)},!0)).append($("<span/>").addClass("control-label").html(_("Add Overlay"))),$("<p/>").append(BJBTC.select(0,s,function(t){0!=+t&&c(t)},!0)).append($("<span/>").addClass("control-label").html(_("Add Indicator"))),$("<p/>").append(BJBTC.toggle(P.settings.userorders,function(){P.settings.userorders=!0},function(){P.settings.userorders=!1},function(){S()})).append($("<span/>").addClass("control-label").html(_("Show User Orders")))]}()},save:function(){return function(){var t,e,o={};for(o.r=P.settings.repaint,o.g=P.settings.grid,o.c=P.settings.crosshairs,o.k=P.settings.icontrols,o.b=P.settings.bidask,o.l=P.settings.logscale,o.o=P.settings.userorders,o.m=+~~P.mode.current,o.d=+~~P.mode.display,o.t=+~~P.period.avail[P.period.current],o.w=+~~P.px.bar.width,o.s=+~~P.px.bar.spacing,o.i=[],t=0;t<P.slots.length;t++)if(P.slots[t].hasOwnProperty("main")){var s,i=[],r=[];for(e=0;e<P.slots[t].o.length;e++)s=B(t,e,"o"),i.push({t:P.slots[t].o[e].t,s:P.slots[t].o[e].i.settings(),c:s});for(e=0;e<P.slots[t].u.length;e++)s=B(t,e,"u"),r.push({t:P.slots[t].u[e].t,s:P.slots[t].u[e].i.settings(),c:s});o.i.push({m:!0,p:+~~P.slots[t].px,h:+~~P.slots[t].h,o:i,u:r})}else o.i.push({m:!1,t:P.slots[t].t,p:+~~P.slots[t].px,h:+~~P.slots[t].h,r:P.slots[t].i.settings()});return o}()},load:function(t){i(t),S()},unload:function(){BJBTC.unregisterAll(P.module.id())},onBarClose:function(t){Yt(t)},onTheme:function(t){var e;e=t,Colors.hasOwnProperty(e)&&(P.colors=Colors[e]),S()},setPreClose:function(t){P.preClose=Number(t)},showDetail:function(){n()},onTrade:function(t){S()},wheel:function(t){Et(P.element,0,0,-t)},loadTicks:function(t){var e=P.bars.ticks;P.bars.ticks=[];for(var o=0;o<t.length;o++)a(t[o])&&P.bars.ticks.push(t[o]);return 0==P.bars.ticks.length?(P.bars.ticks=e,s("Failed to load any new ticks!")):(!function(){var t;if(P.bars.data=[],0!=P.period.avail[P.period.current])for(P.bars.data.push([P.bars.ticks[0][0],P.bars.ticks[0][1],P.bars.ticks[0][1],P.bars.ticks[0][1],P.bars.ticks[0][1],P.bars.ticks[0][2]]),t=1;t<P.bars.ticks.length;t++)r(P.bars.ticks[t]);else for(t=0;t<P.bars.ticks.length;t++)P.bars.splice(0,0,[P.bars.ticks[t][0],P.bars.ticks[t][1],P.bars.ticks[t][1],P.bars.ticks[t][1],P.bars.ticks[t][1],P.bars.ticks[t][2]])}(),u()),this},loadBars:function(t){var e,o,s=P.bars.ticks,i=P.bars.data;if(0<t.length){for(P.bars.ticks=[],e=t.length-1;0<=e;e--)a(o=[t[e][0],t[e][1],t[e][5]/4])&&P.bars.ticks.push(o),a(o=[t[e][0],t[e][2],t[e][5]/4])&&P.bars.ticks.push(o),a(o=[t[e][0],t[e][3],t[e][5]/4])&&P.bars.ticks.push(o),a(o=[t[e][0],t[e][4],t[e][5]/4])&&P.bars.ticks.push(o);0<P.bars.ticks.length?(P.bars.data=t,P.flags.redrawBG=!0,P.flags.recompute=!0,u()):(P.bars.ticks=s,P.bars.data=i)}return this},tick:function(t){var e=P.bars.data.length;a(t)&&(P.bars.ticks.push([t[0],t[1],t[2]]),r(t),P.bars.data.length>e&&(P.flags.redrawFG=!0),u())},bar:function(t){P.bars.data.length;if(0<P.bars.data.length){if(t[0]<P.bars.data[0][0])return;if(t[0]==P.bars.data[0][0]&&t[5]<=P.bars.data[0][5])return;t[0]==P.bars.data[0][0]?P.bars.data[0]=t:(P.bars.data.splice(0,0,t),P.flags.redrawFG=!0)}else P.bars.data.splice(0,0,t),P.flags.redrawFG=!0;P.flags.recompute=!0,u()},bidask:function(t){var e=!1;return t.hasOwnProperty("bid")&&P.price.bid!=t.bid&&(P.price.bid=t.bid,e=!0),t.hasOwnProperty("ask")&&P.price.ask!=t.ask&&(P.price.ask=t.ask,e=!0),e&&(P.flags.redraw.main=!0,u()),this},resize:function(){h(),jt(),window.reqAnimFrame(Jt),qt()},drag:function(t){switch(t){case"start":e()}},widget:function(t){return null==t||void 0===t?P.flags.widget:(P.flags.widget=t,this)},addIndicator:function(t){return c(t),this},addOrUpdateIndicator:function(t,e){return P.indicators.hasOwnProperty(t)?c(t):P.overlays.hasOwnProperty(t)&&l(t,e),this},AddRemoveIndicatorCallback:function(t){P.removeIndicatorCallback=t},removeIndicator:function(){for(;2<P.slots.length;)T(P.slots.length-1);for(;1<P.slots[0].u.length;)C(P.slots[0].u.length-1,"u",0);return this},addOverlay:function(t,e){l(t,e)},removeIndicatorByname:function(t){return t instanceof Array&&t.forEach(function(t){for(var e=P.slots[0].u,o=e.length,s=0;s<o;s++)e[s]&&e[s].t==t&&C(s,"u",0);for(var i=P.slots,r=0;r<i.length;r++)i[r].t==t&&T(r)}),this},setResolution:function(t){return 0<=P.period.avail.indexOf(t)&&P.period.current!=P.period.avail.indexOf(t)&&(P.period.current=P.period.avail.indexOf(t),P.bars.offset=0,P.bars.blank=0),Data.setup(t),this},crossHairH:function(t){P.crossHairH=t},fixTime:function(t){P.bars.fixTime=t,P.offset=t?40:0,P.bars.offset=0,P.settings.grid=!0},setBarwidth:function(t){P.px.bar.width=t},setData:function(t){P.data=t},clearData:function(){Data.data.bars[Ht()]=[],S()},setOffset:function(t){P.offset=t},setShowRateOnLeft:function(t){P.setShowRateOnLeft=t},setLastColorIndex:function(t){P.lastColorIndex=t},setMode:function(t){return 0<=P.mode.avail_display.indexOf(t)&&P.mode.display!=P.mode.avail_display.indexOf(t)&&(P.mode.display=P.mode.avail_display.indexOf(t),S()),$(".icontrol",P.element).css("left",P.offset+2+"px"),this},setCrossHair:function(t){P.showMainCrosshairs=t,P.stopEvent=!t,t?(P.canvas.i.removeClass("showHand"),0==$("#chartCtrlFixed").length&&n()):(P.canvas.i.addClass("showHand"),$("#chartCtrlFixed").remove())},getMode:function(){return P.mode.display},getInernal:function(){return P.yToVal=vt,P.xToBar=xt,P.toPxX=bt,P.barToIndex=yt,P.toPxY=gt,P},getCurDay:function(){if(P.bars.data[P.curIndex])return $("#chartCtrlFixed").hide(),P.bars.data[P.curIndex][0]},getPerClose:function(){if(P.bars.data[P.curIndex+1])return P.bars.data[P.curIndex+1][4]},LblWidthChangeEvent:function(t){P.LblWidthChange=t},showHighlowPriceAtAngles:function(){P.colors.stroke.priceShow=!0},setMainSlotHeightPercent:function(t){P.mainSlotHeightPercent=t},redraw:function(){S()},isIndicator:function(t){return!!P.indicators[t]},internals:function(){return P}}};Date.prototype.get8Date=function(){var t=6e4*this.getTimezoneOffset(),e=this.getTime()+t;return new Date(e+288e5)};var UserAccount,Currency=function(){var t=[],i={AUD:{symbol:"$",before:!0,digits:2,name:_("Australian dollar")},BTC:{symbol:"BTC",before:!1,digits:8,name:_("Bitcoin")},USDT:{symbol:"USDT",before:!1,digits:2,name:_("USDT")},ANS:{symbol:"ANS",before:!1,digits:8,name:_("Antshares")},BNB:{symbol:"BNB",before:!1,digits:8,name:_("Binance")},XRP:{symbol:"XRP",before:!1,digits:6,name:_("XRP")},USDC:{symbol:"USDC",before:!1,digits:4,name:_("USDC")},PAX:{symbol:"PAX",before:!1,digits:4,name:_("PAX")},TUSD:{symbol:"TUSD",before:!1,digits:4,name:_("TUSD")},ETH:{symbol:"ETH",before:!1,digits:8,name:_("Ethereum")},UGX:{symbol:"UGX",before:!1,digits:2,name:_("UGX")},SGD:{symbol:"SGD",before:!1,digits:2,name:_("SGD")},123:{symbol:"123",before:!1,digits:8,name:_("123")},456:{symbol:"456",before:!1,digits:8,name:_("456")},CAD:{symbol:"$",before:!0,digits:2,name:_("Canadian dollar")},CHF:{symbol:"Sâ‚£",before:!1,digits:2,name:_("Swiss franc")},CLP:{symbol:"$",before:!0,digits:2,name:_("Chilean peso")},CNY:{symbol:"CNY",before:!1,digits:2,name:_("Chinese yuan")},DKK:{symbol:"kr",before:!1,digits:2,name:_("Danish krone")},EUR:{symbol:"â‚¬",before:!0,digits:2,name:_("Euro")},GBP:{symbol:"Â£",before:!0,digits:2,name:_("Pound sterling")},HKD:{symbol:"åœ“",before:!0,digits:2,name:_("Hong Kong dollar")},JPY:{symbol:"Â¥",before:!0,digits:2,name:_("Japanese yen")},FTC:{symbol:"FTC",before:!1,digits:8,name:_("Feathercoin")},LTC:{symbol:"Å",before:!0,digits:6,name:_("Litecoin")},NMC:{symbol:"â„•",before:!0,digits:8,name:_("Namecoin")},NVC:{symbol:"NVC",before:!1,digits:8,name:_("Novacoin")},NOK:{symbol:"kr",before:!1,digits:2,name:_("Norwegian krone")},NZD:{symbol:"$",before:!0,digits:2,name:_("New Zealand dollar")},PLN:{symbol:"zÅ‚",before:!1,digits:2,name:_("Polish zÅ‚oty")},PPC:{symbol:"PPC",before:!1,digits:8,name:_("Peercoin")},RUB:{symbol:"Ñ€ÑƒÐ±",before:!1,digits:2,name:_("Russian ruble")},SEK:{symbol:"kr",before:!1,digits:2,name:_("Swedish krona")},SGD:{symbol:"S",before:!0,digits:2,name:_("Singapore dollar")},THB:{symbol:"à¸¿",before:!0,digits:2,name:_("Thai baht")},TRC:{symbol:"TRC",before:!1,digits:8,name:_("Terracoin")},USD:{symbol:"$",before:!0,digits:2,name:_("United States dollar")},XPM:{symbol:"Î¨",before:!0,digits:8,name:_("Primecoin")}};for(var e in i)i.hasOwnProperty(e)&&t.push(e);return t.sort(),{list:function(){return t},before:function(t){try{return i[t].before}catch(t){return!0}},fullname:function(t){try{return i[t].name}catch(t){return _("Currency")}},format:function(t,e,o){try{null==o&&(o=i[t].digits);var s=numberWithCommas((e=parseFloat(e)).toFixed(o));return i[t].before?i[t].symbol+s:s+" "+i[t].symbol}catch(t){return"Â¤0.00"}},symbol:function(t){try{return i[t].symbol}catch(t){return"Â¤"}},valid:function(t){return i.hasOwnProperty(t)}}}(),OrderBookDaemon=function(){var t=null;function e(){var r={book:{bid:{price:[],amount:[]},ask:{price:[],amount:[]}}};return{book:r.book,sumToPrice:function(t,e){return function(t,e){var o=0,s=0,i=BJBTC.baseInt();if(t*=BJBTC.quoteInt(),"bid"==e)for(s=0;s<r.book.bid.price.length&&!(r.book.bid.price[s]<t);s++)o+=r.book.bid.amount[s]/i;else if("ask"==e)for(s=0;s<r.book.ask.price.length&&!(r.book.ask.price[s]>t);s++)o+=r.book.ask.amount[s]/i;return o}(t,e)},loadBook:function(e,o,t){r.book.bid.price=[],r.book.bid.amount=[],r.book.ask.price=[],r.book.ask.amount=[];var s=Object.keys(o).sort(function(t,e){return t-e}).reverse(),i=Object.keys(e).sort(function(t,e){return t-e});s.slice(0,t||20).forEach(function(t){r.book.bid.price.push(parseFloat(t)),r.book.bid.amount.push(o[t])}),i.slice(0,t||20).forEach(function(t){r.book.ask.price.push(parseFloat(t)),r.book.ask.amount.push(e[t])}),BJBTC.trigger("newbook",null)}}}return new function(){this.Build=function(){return null==t&&((t=new e).constructor=null),t}}}(),TWOPI=2*Math.PI,OBD=OrderBookDaemon.Build(),VisualDepth=function(){var v={element:"",parent:null,module:null,self:null,canvas:{bg:null,bidFill:null,askFill:null,bid:null,ask:null,sweepFill:null,sweep:null,orders:null,userOrders:null,axes:null,lbl:null,i:null},w:0,h:0,price:{low:5,high:10,range:5,scale:.3,defaultScale:.3,minScale:1e-5,maxScale:1e5,decimals:4},volume:100,volDecimals:2,orders:[],orderDelay:1250,userOrders:0,yVals:[],allowScale:!1,sums:{bid:[],ask:[]},log:{m:0,b:0,b10:0},px:{pad:5,lbl:{w:65,h:16,tick:4,halftick:2,font:11},crosshairs:{x:0,y:0}},flags:{redraw:{base:!0,bid:!0,ask:!0},recompute:!0,widget:!1},interacted:!1,mouse:{down:!1,zoom:!1,x:0,y:0,sx:0,sy:0,s0:null,shift:!1},colors:Colors.c1,SOLID:0,DOTTED:1,DASHED:2,DASHDOT:3,font:{precision:6,labels:'11px/1.0em BinanceDIN, Consolas, "Courier New", monospace',size:11,lineHeight:1,face:'BinanceDIN, Consolas, "Courier New", monospace',overlays:"10px/1.0em BinanceDIN, Arial, sans-serif",overlaySize:10,heading:"12px/1.0em BinanceDIN, Arial, sans-serif",headingBold:"bold 12px/1.0em BinanceDIN, Arial, sans-serif",headingSize:12},watermark:"bijietech.com",settings:{grid:!0,fill:!0,orders:!0},debug:BJBTC.isDebug()},f=BJBTC.debug,y=OBD.book;function s(t){if(void 0!==t){var e=new Validator,o=(new Validator).create(e.FLOAT),s=(new Validator).create(e.BOOL);v.settings.grid=s.set(v.settings.grid).set(t.g).get(),v.settings.fill=s.set(v.settings.fill).set(t.f).get(),v.price.scale=o.set(v.price.scale).set(t.s).get()}}function t(){return[$("<p/>").append(BJBTC.toggle(v.settings.fill,function(){v.settings.fill=!0},function(){v.settings.fill=!1,v.canvas.bidFill[0].getContext("2d").clearRect(0,0,v.w,v.h),v.canvas.askFill[0].getContext("2d").clearRect(0,0,v.w,v.h)},function(){a()})).append($("<span/>").addClass("control-label").html(_("Fill the Chart"))),$("<p/>").append(BJBTC.toggle(v.settings.grid,function(){v.settings.grid=!0},function(){v.settings.grid=!1},function(){a()})).append($("<span/>").addClass("control-label").html(_("Show Grid")))]}function o(){var t,e,o=v.canvas.bg[0].getContext("2d"),s=v.canvas.bidFill[0].getContext("2d"),i=v.canvas.askFill[0].getContext("2d"),r=v.canvas.bid[0].getContext("2d"),a=v.canvas.ask[0].getContext("2d"),n=v.canvas.axes[0].getContext("2d"),l=v.canvas.lbl[0].getContext("2d");if(v.flags.recompute&&function(t){v.price.low,v.price.high;var e=BJBTC.quoteInt(),o=!1,s=(y=OBD.book).bid.price,i=y.ask.price;if(0==s.length&&0<i.length)y.bid.price=[i[0]],y.bid.amount=[y.ask.amount[0]];else if(0<s.length&&0==i.length)y.ask.price=[s[0]],y.ask.amount=[y.bid.amount[0]];else if(0==s.length&&0==i.length)return;if(0<y.bid.price.length&&0<y.ask.price.length){v.price.low<y.bid.price[y.bid.price.length-1]/e&&(o=!0),v.price.high>y.ask.price[y.ask.price.length-1]/e&&(o=!0),v.price.low,y.bid.price[y.bid.price.length-1],v.price.high,y.ask.price[y.ask.price.length-1];var r=(y.ask.price[0]+y.bid.price[0])/2;0<r*(1-v.price.scale)&&(v.price.high=r*(1+v.price.scale),v.price.low=r*(1-v.price.scale)),(0==s.length||1==s.length&&s[0]==i[0])&&0<i.length?v.price.low<0&&(v.price.low=0):0<s.length&&(0==i.length||1==i.length&&(i[0],s[0])),v.allowScale?v.allowScale=!1:v.price.range=v.price.high-v.price.low,v.price.range=v.price.high-v.price.low,o&&(v.price.range=v.price.high-v.price.low,v.price.range<=0&&(v.price.range=1),v.price.high<v.price.low&&(v.price.high=v.price.low+1/BJBTC.quoteInt()),v.price.scale<v.price.minScale?v.price.scale=v.price.minScale:v.price.scale>v.price.maxScale&&(v.price.scale=v.price.maxScale))}var a,n=0;for(v.sums.bid=[],a=0;a<y.bid.amount.length&&(n+=y.bid.amount[a]/BJBTC.baseInt(),v.sums.bid[a]=n,!(y.bid.price[a]/e<v.price.low));a++);for(n=0,v.sums.ask=[],a=0;a<y.ask.amount.length&&(n+=y.ask.amount[a]/BJBTC.baseInt(),v.sums.ask[a]=n,!(y.ask.price[a]/e>v.price.high));a++);var l=0,c=0;l=y.ask.price[v.sums.ask.length-1]>v.price.high?v.sums.ask[v.sums.ask.length-2]:v.sums.ask[v.sums.ask.length-1];c=y.bid.price[v.sums.bid.length-1]<v.price.low?v.sums.bid[v.sums.bid.length-2]:v.sums.bid[v.sums.bid.length-1];v.volume=Math.max(l,c),v.volume*=1.15,v.flags.recompute=!1,v.flags.redraw.base=!0,v.flags.redraw.bid=!0,v.flags.redraw.ask=!0,void 0===v.asdf&&(f(v),v.asdf=!0)}(),v.flags.redraw.base){o.clearRect(0,0,v.w,v.h),function(t,e){void 0===e&&(e=!1);var o=v.px.lbl.h+v.px.lbl.tick+1,s=v.h-o;t.fillStyle=v.colors.fill.bg,p(t,0,s,v.w,o),t.strokeStyle=v.colors.stroke.border,t.beginPath(),M(t,0,s),E(t,v.w,s),t.stroke()}(o),n.clearRect(0,v.h-v.px.lbl.h-2*v.px.lbl.tick-2,v.w,v.px.lbl.h+2*v.px.lbl.tick+2),n.font=v.font.labels;var c=n.measureText(v.volume).width;n.clearRect(0,0,v.px.lbl.tick+c+5,v.h-v.px.lbl.h-v.px.lbl.tick-1),function(t,e){t.font=v.font.labels,t.fillStyle=v.colors.fill.label,t.strokeStyle=v.colors.stroke.border,t.textBaseline="middle",t.textAlign="center";var o,s,i=1/BJBTC.quoteInt(),r=7,a=1.5*v.font.size,n=0,l=[1e-6,2e-5,1e-4,2e-4,5e-4,.001,.01,.5,1,2,2.5,5],c=1e-8,u=0,f=!1;for(i=1e-8,o=0;o<15;o++){for(r=Math.max(Math.abs(Math.log(i)/Math.LN10)+1,2),s=0;s<l.length;s++)if(c=i*l[s],n=t.measureText(v.price.high.toFixed(r)).width,u=m(2*c)-m(c),n+a<=u){f=!0;break}if(f)break;i*=10}v.price.decimals=r;var d=Math.ceil(v.price.high/c)*c,p=m(d),h="";for(v.settings.grid&&(e.strokeStyle=v.colors.stroke.grid,e.beginPath()),t.beginPath();d>=v.price.low&&!(p<0);)h=d.toFixed(r),b(t,h,d),v.settings.grid&&g(e,p,v.DOTTED),p=m(d-=c);t.stroke(),v.settings.grid&&e.stroke()}(t=n,e=o),function(t,e){t.font=v.font.labels,t.fillStyle=v.colors.fill.label,t.strokeStyle=v.colors.stroke.border,t.textBaseline="middle",t.textAlign="left";var o,s,i=1e-8,r=8,a=.625*v.font.size,n=v.px.lbl.font,l=[1,2,2.5,5],c=1e-8,u=0,f=!1;for(o=0;o<20;o++){for(r=Math.max(Math.abs(Math.log(i)/Math.LN10)+1,2),s=0;s<l.length;s++)if(u=N(c=i*l[s])-N(2*c),n+a<=u){f=!0;break}if(f)break;i*=10}1<=i&&(r=0);var d,p,h,g,b=c,m=N(b),x="";for(v.settings.grid&&(e.strokeStyle=v.colors.stroke.grid,e.beginPath()),t.beginPath();b<v.volume;)x=numberWithCommas(b.toFixed(r)),d=t,p=x,h=void 0,g=N(b),O(d,p,g,h),v.settings.grid&&T(e,m,v.DOTTED),m=N(b+=c);t.stroke(),v.settings.grid&&e.stroke()}(t,e),v.flags.redraw.base=!1}var u=v.flags.redraw.bid||v.flags.redraw.ask;v.flags.redraw.bid&&(!function(t,e){t.clearRect(0,0,v.w,v.h),t.strokeStyle=v.colors.stroke.bid,v.settings.fill&&(e.clearRect(0,0,v.w,v.h),e.fillStyle=v.colors.fill.down,C(e,v.sums.bid,y.bid.price,!0));var o=!1;if(v.interacted&&0<y.bid.price.length){var s=y.bid.price[0]/BJBTC.quoteInt();v.px.crosshairs.x<=m(s)&&(B(),o=!0)}k(t,v.sums.bid,y.bid.price,!0),o&&d(v.mouse.x,v.mouse.y)}(r,s),v.flags.redraw.bid=!1),v.flags.redraw.ask&&(!function(t,e){t.clearRect(0,0,v.w,v.h),t.strokeStyle=v.colors.stroke.ask,v.settings.fill&&(e.clearRect(0,0,v.w,v.h),e.fillStyle=v.colors.fill.up,C(e,v.sums.ask,y.ask.price,!1));var o=!1;if(v.interacted&&0<y.ask.price.length){var s=y.ask.price[0]/BJBTC.quoteInt();v.px.crosshairs.x>=m(s)&&(B(),o=!0)}k(t,v.sums.ask,y.ask.price,!1),o&&d(v.mouse.x,v.mouse.y)}(a,i),v.flags.redraw.ask=!1),u&&function(t){t.clearRect(0,v.h-v.px.lbl.h-v.px.lbl.tick-1,v.w,v.px.lbl.h+v.px.lbl.tick+1),t.clearRect(0,0,v.w,v.font.overlaySize+v.px.lbl.tick+5);var e=0,o=0;try{e=y.bid.price.length,o=y.ask.price.length}catch(t){return}if(0==e&&0==o)return;var s=y.bid.price[0]/BJBTC.quoteInt(),i=y.ask.price[0]/BJBTC.quoteInt(),r="",a=0,n=0,l=0<i?100*(i-s)/i:NaN;t.font=v.font.labels,t.lineWidth=1,t.fillStyle=v.colors.fill.crosshair,t.textAlign="center",t.textBaseline="middle",i>v.price.low&&i<v.price.high&&(r=Currency.format(BJBTC.quote(),i),a=m(i),t.strokeStyle=v.colors.stroke.ask,A(t,a,t.measureText(r).width),t.fillStyle=v.colors.fill.flagtext,P(t,r,a));s>v.price.low&&s<v.price.high&&(t.fillStyle=v.colors.fill.crosshair,r=Currency.format(BJBTC.quote(),s),n=m(s),t.strokeStyle=v.colors.stroke.bid,A(t,n,t.measureText(r).width),t.fillStyle=v.colors.fill.flagtext,P(t,r,n));i>v.price.low&&i<v.price.high&&s>v.price.low&&s<v.price.high&&!isNaN(l)&&(r=l.toFixed(2)+"%",t.fillStyle=v.colors.fill.ordertext,t.strokeStyle=v.colors.stroke.order,t.textAlign="center",t.textBaseline="top",t.font=v.font.overlays,t.fillText(r,(a+n)/2,1),t.beginPath(),M(t,n,v.font.overlaySize+v.px.lbl.tick+3),E(t,n,v.font.overlaySize+3),E(t,a,v.font.overlaySize+3),E(t,a,v.font.overlaySize+v.px.lbl.tick+3),t.stroke())}(l),J()}function a(t){v.flags.recompute=!0,t?o():window.reqAnimFrame(o)}function k(t,e,o,s,i){if(0!=o.length){var r,a,n,l=e.length,c=BJBTC.quoteInt(),u=m(o[l-1]/c),f=(N(e[l-1]),u),d=void 0!==i,p=d?m(i):s?v.w+1:-1;if(t.beginPath(),d)for(f=u=p,r=l-1;0<=r;r--)if(s&&o[r]/c>i||!s&&o[r]/c<i){l=r+1;break}for(M(t,u,n=N(e[l-1])),!d&&0<u&&(v.yVals[u]=n),r=l-1;0<=r;r--){if(u=m(o[r]/c),s&&f<u||!s&&u<f){if(n=N(e[r]),s&&f+1<u&&E(t,f+1,n),!s&&u<f-1&&E(t,f-1,n),E(t,u,n),!d&&0<u&&(v.yVals[u]=n),!d){if(s&&f+1<u)for(a=f+1;a<u;a++)v.yVals[a]=void 0;if(!s&&u<f-1)for(a=f-1;u<a;a--)v.yVals[a]=void 0}f=u}if(u<-100*v.w||u>100*v.w)break}t.stroke()}}function C(t,e,o,s,i){if(0!=o.length){var r,a=e.length,n=BJBTC.quoteInt(),l=m(o[a-1]/n),c=l,u=l,f=0,d=N(0),p=t.createLinearGradient(0,0,0,d),h=void 0!==i,g=h?m(i):s?v.w+1:-1;if(t.beginPath(),h)for(c=u=l=g,r=a-1;0<=r;r--)if(s&&o[r]/n>i||!s&&o[r]/n<i){a=r+1;break}for(M(t,l,f=N(e[a-1])),r=a-1;0<=r;r--)l=m(o[r]/n),(s&&u<l||!s&&l<u)&&(f=N(e[r]),s&&u+1<l&&E(t,u+1,f),!s&&l<u-1&&E(t,u-1,f),E(t,l,f),u=l);E(t,u,d),E(t,c,d),t.closePath(),p.addColorStop(0,t.fillStyle),p.addColorStop(1,v.colors.fill.blankBG),t.fillStyle=p,t.fill()}}function i(t){var e=v.canvas.orders[0].getContext("2d"),o=m(t.price/BJBTC.quoteInt());if(!(o<0||o>v.w)){if(0<t.amount)e.strokeStyle=v.colors.stroke.up;else{if(!(t.amount<0))return;e.strokeStyle=v.colors.stroke.down}var s;v.orders.length>o&&0<=o&&(e.beginPath(),M(e,o,v.h),E(e,o,v.h-v.px.lbl.h-v.px.lbl.tick),e.stroke(),void 0===v.orders[o]?v.orders[o]=1:v.orders[o]++),window.setTimeout((s=o,function(){!function(t){if(v.orders.length>t&&0<=t){if(void 0===v.orders[t])return;if(0<--v.orders[t])return;var e=v.canvas.orders[0].getContext("2d");e.clearRect(t,v.h-v.px.lbl.h-v.px.lbl.tick,1,v.px.lbl.h+v.px.lbl.tick)}}(s)}),v.orderDelay)}}function g(t,e,o){var s,i=v.h-v.px.lbl.h-v.px.lbl.tick-2;switch(M(t,e,0),s=0,o){case v.DOTTED:for(;s<i;)E(t,e,++s),M(t,e,++s);break;case v.DASHED:for(;s<i;)E(t,e,s=i<(s+=6)?i:s),M(t,e,s+=2);break;case v.DASHDOT:for(;s<i&&(E(t,e,s=i<(s+=7)?i:s),!(i<=(s+=4)));)M(t,e,s),E(t,e,s=i<(s+=2)?i:s),M(t,e,s+=4);break;case v.SOLID:default:E(t,e,i)}}function T(t,e,o){var s,i=v.w;switch(M(t,i,e),s=i,o){case v.DOTTED:for(;1<s;)E(t,--s,e),M(t,--s,e);break;case v.DASHED:for(;0<s;)E(t,s=(s-=6)<0?0:s,e),M(t,s-=2,e);break;case v.DASHDOT:for(;0<s&&(E(t,s=(s-=7)<0?0:s,e),!((s-=4)<=0));)M(t,s,e),E(t,s=(s-=2)<0?0:s,e),M(t,s-=4,e);break;case v.SOLID:default:E(t,0,e)}}function S(t){var e=v.h-v.px.lbl.h-v.px.lbl.tick-2;if(0<y.bid.price.length&&0<y.ask.price.length){var o=y.bid.price[0]/BJBTC.quoteInt(),s=y.ask.price[0]/BJBTC.quoteInt(),i=m(o),r=m(s);if(i<t&&t<r)return e;if(void 0!==v.yVals[t])return v.yVals[t];v.price.high,v.price.low;var a=t;if(L(t)>=s)for(;Math.ceil(1e6*L(--a))/1e6>=s;){if(void 0!==v.yVals[a])return v.yVals[a];if(a<=0)break}else if(L(t)<=o)for(;Math.floor(1e6*L(++a))/1e6<=o;){if(void 0!==v.yVals[a])return v.yVals[a];if(a>=v.w)break}}return e}function d(t,e){var o,s,i,r,a,n;v.mouse.shift&&(D(),o=t,s=v.canvas.sweep[0].getContext("2d"),i=v.canvas.sweepFill[0].getContext("2d"),r=L(o),a=y.bid.price[0]/BJBTC.quoteInt(),n=y.ask.price[0]/BJBTC.quoteInt(),s.clearRect(0,0,v.w,v.h),s.strokeStyle=v.colors.stroke.order,i.clearRect(0,0,v.w,v.h),i.fillStyle=v.colors.fill.ordertext,n<=r?(C(i,v.sums.ask,y.ask.price,!1,r),k(s,v.sums.ask,y.ask.price,!1,r)):r<=a&&(C(i,v.sums.bid,y.bid.price,!0,r),k(s,v.sums.bid,y.bid.price,!0,r)));var l=v.canvas.i[0].getContext("2d");if(!F(t,e)){var c=L(t),u=S(t),f=(1-u/(v.h-v.px.lbl.h-v.px.lbl.tick-2))*v.volume;B(l),l.font=v.font.labels,l.lineWidth=1,l.fillStyle=v.colors.fill.crosshair,l.strokeStyle=v.colors.stroke.crosshair,l.beginPath(),l.arc(t+.5,u+.5,2,0,TWOPI,!1),l.stroke();var d,p,h,g,b,m=Currency.format(BJBTC.quote(),c),x=f.toFixed(v.volDecimals);A(l,t,l.measureText(m).width),p=u,h=(d=l).measureText(x).width,g=v.px.lbl.tick+2+h+3,b=v.px.lbl.font/2,p=I(p,v.px.lbl.font+2),d.beginPath(),M(d,0,p),E(d,b,p-1-b),d.lineTo(.6+(0|g),.5+(p-1-b|0)),M(d,g,p-1-b),E(d,g,p+1+b),E(d,b,p+1+b),E(d,0,p),d.fill(),d.stroke(),l.fillStyle=v.colors.fill.flagtext,l.textAlign="left",l.textBaseline="middle",O(l,x,u,!0),l.textAlign="center",P(l,m,t),v.px.crosshairs.x=t,v.px.crosshairs.y=e,v.interacted=!0}}function B(t,e){v.interacted=!1;var o=t||v.canvas.i[0].getContext("2d");if(!0!==e){o.font=v.font.labels;var s=S(v.px.crosshairs.x),i=o.measureText(Currency.format("CNY",v.volume,v.volDecimals)).width+v.px.lbl.tick+6;o.clearRect(v.px.crosshairs.x-4,s-4,8,8),o.clearRect(0,v.h-v.px.lbl.h-v.px.lbl.tick-1,v.w,v.px.lbl.h+v.px.lbl.tick+1),o.clearRect(0,s-v.px.lbl.font-3,i,2*v.px.lbl.font+6)}else o.clearRect(0,0,v.w,v.h)}function e(){window.reqAnimFrame(function(){B()})}function D(){var t=v.canvas.sweep[0].getContext("2d"),e=v.canvas.sweepFill[0].getContext("2d");t.clearRect(0,0,v.w,v.h),e.clearRect(0,0,v.w,v.h)}function b(t,e,o){var s=v.h-(v.px.lbl.h-v.px.lbl.tick)/2-2,i=m(o);M(t,i,v.h-v.px.lbl.h-2*v.px.lbl.tick-1),E(t,i,v.h-v.px.lbl.h-.5*v.px.lbl.tick),t.fillText(e,i,s)}function P(t,e,o){var s=v.h-(v.px.lbl.h-v.px.lbl.tick)/2-2;t.fillText(e,n(o,10+t.measureText(e).width),s)}function O(t,e,o,s){!0!==s&&(M(t,0,o),E(t,v.px.lbl.tick,o)),o=I(o,v.px.lbl.font+2),t.save(),t.strokeStyle=v.colors.fill.blankBG,t.strokeText(e,v.px.lbl.tick+2,o),t.restore(),t.fillText(e,v.px.lbl.tick+2,o)}function n(t,e){return t>v.w-e/2?v.w-e/2:t<e/2?e/2:t}function I(t,e){var o=v.h-v.px.lbl.h-v.px.lbl.tick-1-e/2;return o<t?o:t<e/2?e/2:t}function A(t,e,o){var s=0|n(e,o+10),i=o/2+5|0,r=n(e,7);t.beginPath(),M(t,s-i,v.h-1),E(t,s+i,v.h-1),E(t,s+i,v.h-v.px.lbl.h),E(t,r+3.5,v.h-v.px.lbl.h),E(t,r,v.h-v.px.lbl.h-4),E(t,r-3.5,v.h-v.px.lbl.h),E(t,s-i,v.h-v.px.lbl.h),E(t,s-i,v.h-1),t.fill(),t.stroke()}function M(t,e,o){t.moveTo(.5+(0|e),.5+(0|o))}function E(t,e,o){t.lineTo(.5+(0|e),.5+(0|o))}function p(t,e,o,s,i){t.fillRect(0|e,0|o,0|s,0|i)}function N(t){var e=1-t/v.volume;return(v.h-v.px.lbl.h-v.px.lbl.tick-2)*e|0}function m(t){return v.w*(t-v.price.low)/v.price.range|0}function L(t){return v.price.low+t/v.w*v.price.range}function F(t,e){return!(e<v.h-v.px.lbl.h-v.px.lbl.tick-1)}function r(){v.canvas.i.on({mousedown:function(t){u(t),v.mouse.sx=v.mouse.x,v.mouse.sy=v.mouse.y,v.mouse.s0=v.price.scale,v.mouse.down=!0,F(v.mouse.x,v.mouse.y)&&(v.mouse.zoom=!0),stopEvent(t)},click:function(t){u(t),v.mouse.sx=v.mouse.x,v.mouse.sy=v.mouse.y,v.mouse.s0=v.price.scale,d(v.mouse.x,v.mouse.y)},mouseup:function(t){v.mouse.down=!1,v.mouse.zoom=!1,t.ctrlKey&&t.shiftKey||function(t){if(u(t),!F(v.mouse.x,v.mouse.y)){var e=+L(v.mouse.x).toFixed(v.price.decimals),o="",s=0,i={side:"",price:e};0<y.bid.price.length&&e<=y.bid.price[0]/BJBTC.quoteInt()?v.mouse.shift?(o="sell",s=OBD.sumToPrice(e,"bid"),i.amount=s):o="buy":0<y.ask.price.length&&e>=y.ask.price[0]/BJBTC.quoteInt()&&(v.mouse.shift?(o="buy",s=OBD.sumToPrice(e,"ask"),i.amount=s):o="sell"),i.side=o,BJBTC.trigger("set-order-entry-"+o,i),v.mouse.shift&&D()}}(t)},mouseout:function(t){v.mouse.down=!1,v.mouse.zoom=!1,e(),D()},mousemove:function(t){v.mouse.down?(!function(t){if(u(t),v.mouse.zoom){var e=v.mouse.x-v.mouse.sx,o=v.price.scale;t.shiftKey?v.price.scale=v.mouse.s0*(1-e/1e3):v.price.scale=v.mouse.s0*(1-e/100),v.price.scale>v.price.maxScale&&(v.price.scale=v.price.maxScale),v.price.scale<v.price.minScale&&(v.price.scale=v.price.minScale),v.price.scale!=o&&a()}}(t),v.mouse.zoom&&v.canvas.i.css("cursor","e-resize")):(v.mouse.shift&&!t.shiftKey&&D(),u(t),J(),F(v.mouse.x,v.mouse.y)?(e(),v.canvas.i.css("cursor","e-resize")):(d(v.mouse.x,v.mouse.y),v.canvas.i.css("cursor","pointer")))},dblclick:function(t){v.mouse.down=!1,v.mouse.zoom=!1,v.price.scale!=v.price.defaultScale&&(v.price.scale=v.price.defaultScale,v.flags.recompute=!0,a(),stopEvent(t))}}),v.canvas.i.bind("pinch",c),window.MouseWheel.addMouseWheelHandler($(v.canvas.i),l),BJBTC.handler("newbook",v.element,j),BJBTC.handler("orders",v.element,J)}function l(t,e,o,s){v.allowScale=!0,stopEvent(t);var i=1;if(void 0!==s||void 0!==o){0!=o&&(i=1-.1*o);var r=v.price.scale;v.price.scale*=i,v.price.scale>v.price.maxScale&&(v.price.scale=v.price.maxScale),v.price.scale<v.price.minScale&&(v.price.scale=v.price.minScale),v.price.scale!=r&&a()}}function c(t,e){if(null!=e.scale){w=v.px.bar.width;var o=v.price.scale;v.price.scale*=e.scale,v.price.scale>v.price.maxScale&&(v.price.scale=v.price.maxScale),v.price.scale<v.price.minScale&&(v.price.scale=v.price.minScale),v.price.scale!=o&&a()}e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()}function u(t){if(t.offsetX)v.mouse.x=t.offsetX,v.mouse.y=t.offsetY;else if(t.pageX){var e=v.canvas.i.offset();v.mouse.x=t.pageX-e.left,v.mouse.y=t.pageY-e.top}v.mouse.shift=t.shiftKey}function h(){var t=$(v.element).width(),e=$(v.element).height();v.w==t&&v.h==e||(v.w=t,v.h=e,$("canvas",v.element).each(function(t,e){$(e).attr("width",v.w+"px").attr("height",v.h+"px")}),$("canvas",v.element).attr("val",!1),a(!0))}function x(){if(!isNaN(parseInt(v.w))&&(v.w=0|v.w,0<=v.w)){try{v.orders=new Array(v.w+1),v.yVals=new Array(v.w+1)}catch(t){try{"console"in window&&console.log("Warning: "+v.w)}catch(t){}}a()}}function R(t){var e=t.price/BJBTC.quoteInt();!function(){var t=y.bid.amount.length,e=y.ask.amount.length,o=BJBTC.quoteInt();if(y.bid.price[t-1]/o<v.price.low&&0<v.sums.bid.length&&y.bid.price[v.sums.bid.length-1]>v.price.low)return v.flags.recompute=!0;if(y.ask.price[e-1]/o>v.price.high&&0<v.sums.ask.length&&y.ask.price[v.sums.ask.length-1]<v.price.high)v.flags.recompute=!0}(),"bid"==t.location?e>=v.price.low&&(v.flags.redraw.bid=!0,o()):"ask"==t.location&&e<=v.price.high&&(v.flags.redraw.ask=!0,o()),v.settings.orders&&i(t)}function j(){v.flags.recompute=!0,v.flags.redraw.base=!0,v.flags.redraw.bid=!0,B(null,v.flags.redraw.ask=!0),a(!0)}function J(){var t,e,o=UserAccount.orders(),s=null,i=0;if(o.hasOwnProperty("BIJIE")){var r;for(t in o=o.BIJIE)o.hasOwnProperty(t)&&(i++,null==s&&((s=v.canvas.userOrders[0].getContext("2d")).clearRect(0,0,v.w,v.h),s.text=v.font.overlays,s.textBaseline="bottom",s.strokeStyle=v.colors.stroke.order,s.fillStyle=v.colors.fill.ordertext,s.beginPath()),(e=o[t]).quote==BJBTC.quote()&&(V(s,e)?r=e:q(s,e,!1)));r&&q(s,r,V(s,r)),null!=s&&(s.fill(),s.stroke()),0==i&&0<v.userOrders&&(s=v.canvas.userOrders[0].getContext("2d")).clearRect(0,0,v.w,v.h),v.userOrders=i}}function V(t,e){t.fillStyle;var o,s,i=m(e.price),r="",a=e.quote;o=S(i),"buy"==e.action?(r=_("BUY"),i-=v.px.lbl.tick/2):"sell"==e.action&&(r=_("SELL"),i+=v.px.lbl.tick/2),s=Currency.format(a,e.price),r+=" "+BJBTC.numFormatShort(e.amount,8)+" @ "+s;var n=t.measureText(r).width,l=t.fillStyle;if(t.fillStyle=v.colors.fill.order,"buy"==e.action){if(v.mouse.x>i&&v.mouse.x<i+n&&v.mouse.y<o-1.5*v.px.lbl.tick&&v.mouse.y>o-1.5*v.px.lbl.tick-14)return p(t,i-3,o-1.5*v.px.lbl.tick-15,n+8,16),t.fillStyle=l,!0}else if("sell"==e.action&&v.mouse.x<i&&v.mouse.x>i-n&&v.mouse.y<o-1.5*v.px.lbl.tick&&v.mouse.y>o-1.5*v.px.lbl.tick-14)return p(t,i-n-3,o-1.5*v.px.lbl.tick-15,n+8,16),t.fillStyle=l,!0;return t.fillStyle=l,!1}function q(t,e,o){var s,i,r=m(e.price),a="",n=e.quote;if(!(r<0||r>v.w)){var l,c,u;M(t,r,s=S(r)),E(t,r-v.px.lbl.tick/2,s-v.px.lbl.tick),l=t,c=r+v.px.lbl.tick/2,u=s-v.px.lbl.tick,l.lineTo(.6+(0|c),.5+(0|u)),E(t,r,s),"buy"==e.action?(a=_("BUY"),t.textAlign="left",r-=v.px.lbl.tick/2):"sell"==e.action&&(a=_("SELL"),t.textAlign="right",r+=v.px.lbl.tick/2),i=Currency.format(n,e.price),a+=" "+BJBTC.numFormatShort(e.amount,8)+" @ "+i;var f=t.fillStyle;o&&(t.fillStyle=v.colors.stroke.orderHighLine),t.fillText(a,r,s-1.5*v.px.lbl.tick),t.fillStyle=f}}return{build:function(t,e,o){return v.element=$(t),v.parent=$(e),function(){v.parent.addClass("visualdepth"),v.element=$(".box-inner",v.parent),v.element.empty(),v.w=v.element.width(),v.h=v.element.height(),v.canvas.bg=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",100),v.canvas.bidFill=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",101),v.canvas.askFill=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",102),v.canvas.bid=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",103),v.canvas.sweepFill=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",104),v.canvas.sweep=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",105),v.canvas.ask=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",106),v.canvas.orders=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",107),v.canvas.userOrders=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",108),v.canvas.axes=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",109),v.canvas.lbl=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",110),v.canvas.i=$("<canvas/>").attr("width",v.w+"px").attr("height",v.h+"px").attr("z-index",111),v.element.append(v.canvas.bg).append(v.canvas.bidFill).append(v.canvas.askFill).append(v.canvas.bid).append(v.canvas.ask).append(v.canvas.sweepFill).append(v.canvas.sweep).append(v.canvas.orders).append(v.canvas.userOrders).append(v.canvas.axes).append(v.canvas.lbl).append(v.canvas.i),v.defaultColors=deepCopy(v.colors);var t=v.canvas.bg[0].getContext("2d");t.font=v.font.labels,v.px.lbl.w=t.measureText("100.00").width+v.px.pad+2}(),r(),s(o),window.setTimeout(function(){BJBTC.trigger("what-theme",null)},100),this},module:function(t){return v.module=t,v.module.setTitle(_("Visual Depth")),BJBTC.handler("newbook",v.module.id(),v.self.onBook),BJBTC.handler("depth",v.module.id(),v.self.onDepth),BJBTC.handler("theme",v.module.id(),v.self.onTheme),BJBTC.handler("orders",v.module.id(),J),BJBTC.handler("order-canceled",v.module.id(),J),this},self:function(t){v.self=t},settings:function(){return t()},save:function(){return(t={}).g=v.settings.grid,t.f=v.settings.fill,t.s=v.price.scale,t;var t},load:function(t){s(t),a()},unload:function(){BJBTC.unregisterAll(v.module.id())},onDepth:function(t){R(t)},onTheme:function(t){var e;e=t,Colors.hasOwnProperty(e)&&(v.colors=Colors[e],a())},onBook:function(t){j()},resize:function(t){window.reqAnimFrame(h),x()},resizeStop:function(){x()},drag:function(t){t},widget:function(t){return null==t||void 0===t?v.flags.widget:(v.flags.widget=t,this)},internals:function(){return v}}},UserAccount_Class=function(){var t=null;function e(){var i={orders:{}};function e(t){if(null!=t&&void 0!==t){var e=null;t.hasOwnProperty("exch")&&(e=t.exch,t.hasOwnProperty("orders")&&null!=t.orders&&t.orders.hasOwnProperty("length")&&(!function(t,e){var o="",s=0;millitime();for(o in i.orders[e])i.orders[e].hasOwnProperty(o)&&(i.orders[e][o],delete i.orders[e][o]);for(s=0;s<t.length;s++)r(t[s],e)}(t.orders,e),BJBTC.trigger("orders")))}else _ordersFail()}function r(t,e){var o=t.id,s=millitime();null!=e&&void 0!==e&&(i.orders[e]||(i.orders[e]={}),i.orders[e].hasOwnProperty(o)?i.orders[e][o].hasOwnProperty("added")&&(i.orders[e][o].added=0):(i.orders[e][o]={},i.orders[e][o].added=s),i.orders[e][o].action=t.action,i.orders[e][o].amount=parseFloat(t.amount),i.orders[e][o].price=parseFloat(t.price),i.orders[e][o].base=t.base,i.orders[e][o].quote=t.quote,i.orders[e][o].status=t.status,"Unknown"==i.orders[e][o].status&&(i.orders[e][o].status="Open"))}return{orders:function(){return i.orders},ordersAdd:function(t){e(t)}}}return new function(){this.Build=function(){return null==t&&((t=new e).constructor=null),t}}}(),CustLine=function(t){var y={canvas:$(".line",t),chart:null,w:0,h:0,objLines:[],curLine:null,points:[],selectDrawObj:null,LINES:0,CIRCLE:1,RECT:2,ARROW:3,mouse:{},mouseOri:{}},c=y.canvas[0].getContext("2d");function i(){window.reqAnimFrame(function(){!function(){y.canvas[0].getContext("2d").clearRect(0,0,y.chart.w,y.chart.h);for(var t=0;t<y.objLines.length;t++)y.objLines[t].draw();e=p(),c.globalCompositeOperation="destination-out",c.fillStyle="rgba(250,250,250,1)",c.beginPath(),c.rect(0,0,y.chart.w,y.chart.h),r(c,e.x,e.y),a(c,e.x,e.y+e.h),a(c,e.x+e.w,e.y+e.h),a(c,e.x+e.w,e.y),a(c,e.x,e.y),c.closePath(),c.fill(),c.globalCompositeOperation="source-over";var e}()})}function r(t,e,o){t.moveTo(.5+(0|e),.5+(0|o))}function a(t,e,o){t.lineTo(.5+(0|e),.5+(0|o))}function e(t){c.strokeStyle=C.line,c.lineWidth=1,c.beginPath();for(var e=0;e<t.points.length;e++){var o=t.points[e];r(c,o[0],o[1]),a(c,o[2],o[3])}c.stroke(),c.fillStyle=C.text,c.textBaseline="bottom",c.textAlign="left",c.font="12px Arial";var s=0;if("periodicLine"!=t.name&&"fibonacciSequence"!=t.name||(s=40),0<t.text.length){for(e=0;e<t.points.length;e++){o=t.points[e];c.fillText(t.text[e],o[0],o[1]+s)}c.stroke()}y.selectDrawObj&&t.id==y.selectDrawObj.id&&u(t)}function o(t){c.fillStyle=c.strokeStyle=t.up?C.upArrow:C.downArrow,c.lineWidth=1,c.beginPath();var e=t.points[0];r(c,e[0],e[1]);for(var o=0;o<t.points.length;o++)e=t.points[o],a(c,e[0],e[1]);c.stroke(),c.fill()}function u(t){c.strokeStyle=C.pot,c.fillStyle="black",c.lineWidth=1;var e=3;1==t.large&&(e=5),t.pots.forEach(function(t){c.beginPath(),c.arc(t[0]+.5,t[1]+.5,e,0,2*Math.PI,!0),c.stroke(),c.beginPath(),c.arc(t[0]+.5,t[1]+.5,e-1,0,2*Math.PI,!0),c.fill()})}function f(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()}function n(t){var b=!1;return t.forEach(function(t){var e=y.mouse.x,o=y.mouse.y,s=t[0],i=t[1],r=t[2],a=t[3],n=a-i,l=s-r,c=r*i-s*a,u=n,f=l,d=c+5*Math.sqrt(n*n+l*l),p=n,h=l,g=c-5*Math.sqrt(n*n+l*l);0<u*e+f*o+d&&p*e+h*o+g<0&&0<-l*e+n*o+(l*s-n*i)&&-l*e+n*o+(l*r-n*a)<0&&(b=!0)}),b}function l(i){var r=!1;return i.pots.forEach(function(t,e){var o=y.mouse.x,s=y.mouse.y;Math.sqrt((o-t[0])*(o-t[0])+(s-t[1])*(s-t[1]))<=5&&(i.selectPotIndex=e,r=!0)}),r}function s(){y.chart.canvas.i.on({mousedown:function(t){0==t.button&&(d(t),y.mouseOri.x=y.mouse.x,y.mouseOri.y=y.mouse.y,y.mouseDown=!0,y.curLine?(y.objLines.push(y.curLine),y.curLine.init(),y.selectDrawObj=y.curLine,y.curLine=null):function(){y.selectDrawObj=null;for(var t=0;t<y.objLines.length;t++)switch(drawType=y.objLines[t].drawType||y.LINES,drawType){case y.LINES:var e=n(y.objLines[t].points),o=l(y.objLines[t]);1!=e&&1!=o||(y.selectDrawObj=y.objLines[t],0==o&&(y.selectDrawObj.selectPotIndex=null));break;case y.RECT:var s=[];y.objLines[t].points.forEach(function(t){s.push([t[0],t[1],t[2],t[1]]),s.push([t[2],t[1],t[2],t[3]]),s.push([t[2],t[3],t[0],t[3]]),s.push([t[0],t[3],t[0],t[1]])}),e=n(s),o=l(y.objLines[t]),1!=e&&1!=o||(y.selectDrawObj=y.objLines[t],0==o&&(y.selectDrawObj.selectPotIndex=null));break;case y.ARROW:PtInPolygon([y.mouse.x,y.mouse.y],y.objLines[t].points)&&(y.selectDrawObj=y.objLines[t])}i()}(),i())},mousemove:function(t){d(t);var e=!1;if(y.selectDrawObj&&1==y.mouseDown&&(y.selectDrawObj.moving(),e=!0),y.selectDrawObj&&0==y.mouseDown){var o=y.selectDrawObj.large,s=l(y.selectDrawObj);y.selectDrawObj.large=1==s}y.selectDrawObj&&(e||o!=y.selectDrawObj.large)&&i()}}),$(document).on({mouseup:function(t){1==y.mouseDown&&(y.mouseDown=!1,y.objLines&&y.objLines.forEach(function(t){t.selectPotIndex=null}))},keydown:function(t){var e=t||window.event;46==(e.keyCode||e.which||e.charCode)&&y.selectDrawObj&&(y.objLines.forEach(function(t,e){t.name==y.selectDrawObj.name&&t.id==y.selectDrawObj.id&&(y.objLines.splice(e,1),0==y.objLines.length&&y.nullDrawObj&&y.nullDrawObj())}),i())}})}function d(t){if(t.offsetX)y.mouse.x=t.offsetX,y.mouse.y=t.offsetY;else if(t.pageX){var e=y.canvas.offset();y.mouse.x=t.pageX-e.left,y.mouse.y=t.pageY-e.top}}function p(){return{x:y.chart.offset,y:0,w:y.chart.w-y.chart.offset-y.chart.px.lbl.w-y.chart.px.lbl.tick-1,h:y.chart.slots[0].px+y.chart.slots[0].h}}function h(){this.name="percentLine",this.points=[],this.pots=[],this.text=[];var r=[0,(this.selectPotIndex=1)/8,.25,1/3,3/8,.5,5/8,2/3,.75,7/8,1];this.init=function(){var t=p();this.points=[];for(var e=y.chart.yToVal(0,y.mouse.y),o=0;o<11;o++)this.points.push([t.x,y.mouse.y,t.w+t.x,y.mouse.y]),this.text.push((100*r[o]).toFixed(2)+"% "+e.toFixed(2));return this.pots=[],this.pots.push([y.w/2,y.mouse.y,0]),this.pots.push([y.w/2,y.mouse.y,10]),this.points},this.moving=function(){if(y.mouseDown){var s=y.mouse.y-y.mouseOri.y;null!=this.selectPotIndex&&0!=s?1==this.selectPotIndex?(this.points.forEach(function(t,e,o){t[1]=t[3]+=s*r[e]}),this.pots.forEach(function(t,e,o){t[1]+=s*r[t[2]]})):0==this.selectPotIndex&&(this.points.forEach(function(t,e,o){t[1]=t[3]+=s*(1-r[e])}),this.pots.forEach(function(t,e,o){t[1]+=s*(1-r[t[2]])})):null==this.selectPotIndex&&0!=s&&(this.points.forEach(function(t,e,o){t[1]=t[3]+=s}),this.pots.forEach(function(t,e,o){t[1]+=s})),this.text=[];var i=this;this.points.forEach(function(t,e){var o=y.chart.yToVal(0,t[1]);i.text.push((100*r[e]).toFixed(2)+"% "+o.toFixed(2))}),y.mouseOri.y=y.mouse.y}},this.draw=function(){e(this)}}function g(){this.name="godPercentLines",this.points=[],this.pots=[],this.text=[];var r=[0,.191,.382,.5,.618,this.selectPotIndex=1,1.191,1.382,1.5,1.618,2];this.init=function(){var t=p();this.points=[];for(var e=y.chart.yToVal(0,y.mouse.y),o=0;o<11;o++)this.points.push([t.x,y.mouse.y,t.w+t.x,y.mouse.y]),this.text.push((100*r[o]).toFixed(2)+"% "+e.toFixed(2));return this.pots=[],this.pots.push([y.w/2,y.mouse.y,0]),this.pots.push([y.w/2,y.mouse.y,5]),this.points},this.moving=function(){if(y.mouseDown){var s=y.mouse.y-y.mouseOri.y;null!=this.selectPotIndex&&0!=s?1==this.selectPotIndex?(this.points.forEach(function(t,e,o){t[1]=t[3]+=s*r[e]}),this.pots.forEach(function(t,e,o){t[1]+=s*r[t[2]]})):0==this.selectPotIndex&&(this.points.forEach(function(t,e,o){t[1]=t[3]+=s*(1-r[e])}),this.pots.forEach(function(t,e,o){t[1]+=s*(1-r[t[2]])})):null==this.selectPotIndex&&0!=s&&(this.points.forEach(function(t,e,o){t[1]=t[3]+=s}),this.pots.forEach(function(t,e,o){t[1]+=s})),this.text=[];var i=this;this.points.forEach(function(t,e){var o=y.chart.yToVal(0,t[1]);i.text.push((100*r[e]).toFixed(2)+"% "+o.toFixed(2))}),y.mouseOri.y=y.mouse.y}},this.draw=function(){e(this)}}function b(){this.name="wavePercentLines",this.points=[],this.pots=[],this.text=[];var r=[0,.25,.333,.5,this.selectPotIndex=1];this.init=function(){var t=p();this.points=[];for(var e=y.chart.yToVal(0,y.mouse.y),o=0;o<5;o++)this.points.push([t.x,y.mouse.y,t.w+t.x,y.mouse.y]),this.text.push((100*r[o]).toFixed(2)+"% "+e.toFixed(2));return this.pots=[],this.pots.push([y.w/2,y.mouse.y,0]),this.pots.push([y.w/2,y.mouse.y,4]),this.points},this.moving=function(){if(y.mouseDown){var s=y.mouse.y-y.mouseOri.y;null!=this.selectPotIndex&&0!=s?1==this.selectPotIndex?(this.points.forEach(function(t,e,o){t[1]=t[3]+=s*r[e]}),this.pots.forEach(function(t,e){t[1]+=s*r[t[2]]})):0==this.selectPotIndex&&(this.points.forEach(function(t,e,o){t[1]=t[3]+=s*(1-r[e])}),this.pots.forEach(function(t,e,o){t[1]+=s*(1-r[t[2]])})):null==this.selectPotIndex&&0!=s&&(this.points.forEach(function(t,e,o){t[1]=t[3]+=s}),this.pots.forEach(function(t,e,o){t[1]+=s})),this.text=[];var i=this;this.points.forEach(function(t,e){var o=y.chart.yToVal(0,t[1]);i.text.push((100*r[e]).toFixed(2)+"% "+o.toFixed(2))}),y.mouseOri.y=y.mouse.y}},this.draw=function(){e(this)}}function m(){this.name="fibonacciSequence",this.points=[],this.pots=[],this.text=[],this.selectPotIndex=null;var r=[];this.id=f(),this.init=function(){var t=p();this.points=[];y.chart.yToVal(0,y.mouse.y);for(var e=0;e<100;e++)0==e?r.push(0):r.push(e+r[e-1]);for(var o=y.chart.xToBar(y.mouse.x),s=0;s<r.length;s++){var i=y.chart.toPxX(o-r[s]);if(i>t.x+t.w)break;this.points.push([i,0,i,t.h]),this.text.push(s)}return this.pots=[],this.pots.push([y.chart.toPxX(o),t.h/2,0]),this.points},this.moving=function(){if(y.mouseDown){var t=p();this.points=[],this.text=[];for(var s=y.chart.xToBar(y.mouse.x),e=0;e<r.length;e++){var o=y.chart.toPxX(s-r[e]);if(o>t.x+t.w)break;this.points.push([o,0,o,t.h]),this.text.push(e)}this.pots.forEach(function(t,e,o){t[0]=y.chart.toPxX(s)})}},this.draw=function(){e(this)}}function x(){this.name="periodicLine",this.points=[],this.pots=[],this.text=[],this.id=f(),this.selectPotIndex=1;var s=0;this.init=function(){var t=p();this.points=[];y.chart.yToVal(0,y.mouse.y);for(var e=y.chart.xToBar(y.mouse.x),o=0;o<300;o++){var s=y.chart.toPxX(e-o);this.points.push([s,0,s,t.h]),this.text.push(o)}return this.pots=[],this.pots.push([y.chart.toPxX(e),t.h/2,0]),this.pots.push([y.chart.toPxX(e-1),t.h/2,0]),this.points},this.moving=function(){if(y.mouseDown){p();var t=y.mouse.x-y.mouseOri.x;if(null!=this.selectPotIndex&&0!=t)if(0==this.selectPotIndex){s+=t;for(var e=parseInt(s/(y.chart.px.bar.spacing+y.chart.px.bar.width)),o=0;o<this.points.length;o++)this.points[o][0]=this.points[o][2]+=e*(y.chart.px.bar.spacing+y.chart.px.bar.width);this.pots[1][0]+=e*(y.chart.px.bar.spacing+y.chart.px.bar.width),this.pots[0][0]+=e*(y.chart.px.bar.spacing+y.chart.px.bar.width),s%=y.chart.px.bar.spacing+y.chart.px.bar.width}else{s+=t;for(e=parseInt(s/(y.chart.px.bar.spacing+y.chart.px.bar.width)),o=0;o<this.points.length;o++)this.points[o][0]=this.points[o][2]+=o*e*(y.chart.px.bar.spacing+y.chart.px.bar.width),this.text[o]+=e*o;this.pots[1][0]+=e*(y.chart.px.bar.spacing+y.chart.px.bar.width),s%=y.chart.px.bar.spacing+y.chart.px.bar.width}y.mouseOri.x=y.mouse.x}},this.draw=function(){e(this)}}function v(){this.name="lineSegment",this.points=[],this.pots=[],this.text=[],this.id=f(),this.selectPotIndex=1;var l=0;this.init=function(){p();this.points=[];for(var t=y.chart.yToVal(0,y.mouse.y),e=y.chart.xToBar(y.mouse.x),o=y.chart.barToIndex(e),s=new Date(y.chart.bars.data[o][0]).Format("yyyy.MM.dd")+" "+t.toFixed(2),i=y.chart.toPxX(e),r=y.chart.toPxY(t,0),a=0;a<1;a++)this.points.push([i,r,i,r]),this.text.push(s);return this.pots=[],this.pots.push([i,r]),this.pots.push([i,r]),this.points},this.moving=function(){if(y.mouseDown){var s=y.mouse.y-y.mouseOri.y,t=y.mouse.x-y.mouseOri.x;l+=t;var i=parseInt(l/(y.chart.px.bar.spacing+y.chart.px.bar.width))*(y.chart.px.bar.spacing+y.chart.px.bar.width);null==this.selectPotIndex||0==s&&0==i?null!=this.selectPotIndex||0==s&&0==i||(this.points.forEach(function(t,e,o){t[0]+=i,t[1]+=s,t[2]+=i,t[3]+=s}),this.pots.forEach(function(t,e,o){t[1]+=s,t[0]+=i})):1==this.selectPotIndex?(this.points[0][2]+=i,this.points[0][3]+=s,this.pots[1][0]+=i,this.pots[1][1]+=s):0==this.selectPotIndex&&(this.points[0][0]+=i,this.points[0][1]+=s,this.pots[0][0]+=i,this.pots[0][1]+=s),this.text=[];var e=this.points[0],o=y.chart.yToVal(0,e[1]),r=y.chart.xToBar(e[0]),a=y.chart.barToIndex(r),n=y.chart.bars.data[a]?new Date(y.chart.bars.data[a][0]).Format("yyyy.MM.dd"):"";this.text.push(n+" "+o.toFixed(2)),o=y.chart.yToVal(0,e[3]),r=y.chart.xToBar(e[2]),a=y.chart.barToIndex(r),n=y.chart.bars.data[a]?new Date(y.chart.bars.data[a][0]).Format("yyyy.MM.dd"):"",this.text.push(n+" "+o.toFixed(2)),l%=y.chart.px.bar.spacing+y.chart.px.bar.width,y.mouseOri.y=y.mouse.y,y.mouseOri.x=y.mouse.x}},this.draw=function(){!function(t){c.strokeStyle=C.line,c.lineWidth=1,c.beginPath();for(var e=0;e<t.points.length;e++){var o=t.points[e];r(c,o[0],o[1]),a(c,o[2],o[3])}c.stroke(),c.fillStyle=C.text,c.textBaseline="bottom",c.textAlign="left",c.font="12px Arial",o=t.points[0],c.fillText(t.text[0],o[0],o[1]),c.fillText(t.text[1],o[2],o[3]),c.stroke(),y.selectDrawObj&&t.id==y.selectDrawObj.id&&u(t)}(this)}}function w(){this.name="regressionLine",this.points=[],this.pots=[],this.text=[],this.id=f(),this.selectPotIndex=1;var a=0;function n(t,e){var o=y.chart.bars.data.slice(t,e+1),s=o.length,i=(1+s)/2,r=0,a=0,n=0;o.forEach(function(t,e){r+=t[4],a+=t[4]*(e+1),n+=(e+1)*(e+1)});var l,c,u=r/s,f=(a-s*i*u)/(n-s*i*i),d=u-f*i,p=d+1*f,h=d+f*s,g=0,b=0;o.forEach(function(t,e){var o=(t[2]-(e+1)*f-d)/Math.sqrt(d*d+f*f);g<o&&(g=o,l=e),(o=(t[3]-(e+1)*f-d)/Math.sqrt(d*d+f*f))<b&&(b=o,c=e)});var m=o[l||0][2]-((l||0)+1)*f,x=m+1*f,v=m+f*s,w=o[c||0][3]-((c||0)+1)*f;return[[p,h],[x,v],[w+1*f,w+f*s]]}this.init=function(){var t=p();this.points=[];for(var e=y.chart.yToVal(0,y.mouse.y),o=y.chart.xToBar(y.mouse.x),s=(y.chart.barToIndex(o),y.chart.toPxX(o)),i=(y.chart.toPxY(e,0),0);i<2;i++)this.points.push([s,0,s,t.h]);for(var r=0;r<3;r++)this.points.push([s,0,s,0]);return this.pots=[],this.pots.push([s,t.h/2]),this.pots.push([s,t.h/2]),this.points},this.moving=function(){if(y.mouseDown){var t=y.mouse.y-y.mouseOri.y,e=y.mouse.x-y.mouseOri.x;a+=e;var o,s=parseInt(a/(y.chart.px.bar.spacing+y.chart.px.bar.width))*(y.chart.px.bar.spacing+y.chart.px.bar.width);null==this.selectPotIndex||0==t&&0==s?null!=this.selectPotIndex||0==t&&0==s||(this.points.forEach(function(t,e,o){t[0]+=s,t[2]+=s}),this.pots.forEach(function(t,e,o){t[0]+=s})):1==this.selectPotIndex?(this.points[1][0]=this.points[1][2]+=s,this.points[2][2]+=s,this.points[3][2]+=s,this.points[4][2]+=s,this.pots[1][0]+=s):0==this.selectPotIndex&&(this.points[0][0]=this.points[0][2]+=s,this.points[2][0]+=s,this.points[3][0]+=s,this.points[4][0]+=s,this.pots[0][0]+=s),index1=y.chart.barToIndex(y.chart.xToBar(this.points[0][0])),index2=y.chart.barToIndex(y.chart.xToBar(this.points[1][0]));var i=0,r=0;index1>index2?(o=n(index2,index1),i=y.chart.toPxY(o[0][0],0),r=y.chart.toPxY(o[0][1],0),y2=y.chart.toPxY(o[1][0],0),y3=y.chart.toPxY(o[1][1],0),y4=y.chart.toPxY(o[2][0],0),y5=y.chart.toPxY(o[2][1],0),this.points[2][3]=i,this.points[2][1]=r,this.points[3][3]=y2,this.points[3][1]=y3,this.points[4][3]=y4,this.points[4][1]=y5):index1<index2?(o=n(index1,index2),i=y.chart.toPxY(o[0][0],0),r=y.chart.toPxY(o[0][1],0),y2=y.chart.toPxY(o[1][0],0),y3=y.chart.toPxY(o[1][1],0),y4=y.chart.toPxY(o[2][0],0),y5=y.chart.toPxY(o[2][1],0),this.points[2][3]=r,this.points[2][1]=i,this.points[3][3]=y3,this.points[3][1]=y2,this.points[4][3]=y5,this.points[4][1]=y4):(this.points[2][3]=0,this.points[2][1]=0,this.points[3][3]=0,this.points[3][1]=0,this.points[4][3]=0,this.points[4][1]=0),a%=y.chart.px.bar.spacing+y.chart.px.bar.width,y.mouseOri.y=y.mouse.y,y.mouseOri.x=y.mouse.x}},this.draw=function(){e(this)}}function k(){this.name="rectLine",this.drawType=y.RECT,this.id=f(),this.points=[],this.pots=[],this.text=[],this.selectPotIndex=1;var l=0;this.init=function(){p();this.points=[];for(var t=y.chart.yToVal(0,y.mouse.y),e=y.chart.xToBar(y.mouse.x),o=y.chart.barToIndex(e),s=new Date(y.chart.bars.data[o][0]).Format("yyyy.MM.dd")+" "+t.toFixed(2),i=y.chart.toPxX(e),r=y.chart.toPxY(t,0),a=0;a<1;a++)this.points.push([i,r,i,r]);return this.text.push(s),this.text.push(s),this.pots=[],this.pots.push([i,r]),this.pots.push([i,r]),this.points},this.moving=function(){if(y.mouseDown){var s=y.mouse.y-y.mouseOri.y,t=y.mouse.x-y.mouseOri.x;l+=t;var i=parseInt(l/(y.chart.px.bar.spacing+y.chart.px.bar.width))*(y.chart.px.bar.spacing+y.chart.px.bar.width);null==this.selectPotIndex||0==s&&0==i?null!=this.selectPotIndex||0==s&&0==i||(this.points.forEach(function(t,e,o){t[0]+=i,t[1]+=s,t[2]+=i,t[3]+=s}),this.pots.forEach(function(t,e,o){t[1]+=s,t[0]+=i})):1==this.selectPotIndex?(this.points[0][2]+=i,this.points[0][3]+=s,this.pots[1][0]+=i,this.pots[1][1]+=s):0==this.selectPotIndex&&(this.points[0][0]+=i,this.points[0][1]+=s,this.pots[0][0]+=i,this.pots[0][1]+=s),this.text=[];var e=this.points[0],o=y.chart.yToVal(0,e[1]),r=y.chart.xToBar(e[0]),a=y.chart.barToIndex(r),n=y.chart.bars.data[a]?new Date(y.chart.bars.data[a][0]).Format("yyyy.MM.dd"):"";this.text.push(n+" "+o.toFixed(2)),o=y.chart.yToVal(0,e[3]),r=y.chart.xToBar(e[2]),a=y.chart.barToIndex(r),n=y.chart.bars.data[a]?new Date(y.chart.bars.data[a][0]).Format("yyyy.MM.dd"):"",this.text.push(n+" "+o.toFixed(2)),l%=y.chart.px.bar.spacing+y.chart.px.bar.width,y.mouseOri.y=y.mouse.y,y.mouseOri.x=y.mouse.x}},this.draw=function(){!function(t){c.strokeStyle=C.line,c.lineWidth=1;for(var e=0;e<t.points.length;e++){var o=t.points[e];s=c,i=o[0],r=o[1],a=o[2]-o[0],n=o[3]-o[1],s.strokeRect(.5+(0|i),.5+(0|r),0|a,0|n)}var s,i,r,a,n;c.fillStyle=C.text,c.textBaseline="bottom",c.textAlign="left",c.font="12px Arial",(o=t.points[0])[0]<=o[2]?c.textAlign="left":c.textAlign="right",c.fillText(t.text[0],o[0],o[1]),o[0]>o[2]?c.textAlign="left":c.textAlign="right",c.textBaseline="top",c.fillText(t.text[1],o[2],o[3]),y.selectDrawObj&&t.id==y.selectDrawObj.id&&u(t)}(this)}}function T(){this.name="singleLine",this.points=[],this.pots=[],this.text=[],this.selectPotIndex=null,this.init=function(){var t=p();this.points=[];for(var e=y.chart.yToVal(0,y.mouse.y),o=0;o<1;o++)this.points.push([t.x,y.mouse.y,t.w+t.x,y.mouse.y]),this.text.push(e.toFixed(2));return this.pots=[],this.pots.push([y.w/2,y.mouse.y,0]),this.points},this.moving=function(){if(y.mouseDown){var s=y.mouse.y-y.mouseOri.y;0!=s&&(this.points.forEach(function(t,e,o){t[1]=t[3]+=s}),this.pots.forEach(function(t,e,o){t[1]+=s})),this.text=[];var i=this;this.points.forEach(function(t,e){var o=y.chart.yToVal(0,t[1]);i.text.push(o.toFixed(2))}),y.mouseOri.y=y.mouse.y}},this.draw=function(){e(this)}}function S(){this.name="upArrow",this.up=!0,this.id=f(),this.drawType=y.ARROW,this.points=[],this.pots=[],this.text=[],this.selectPotIndex=null;var i=0;this.init=function(){p();this.points=[];var t=y.chart.toPxX(y.chart.xToBar(y.mouse.x)),e=y.mouse.y;return this.points.push([t,e]),this.points.push([t+10,e+10]),this.points.push([t+10,e+14]),this.points.push([t+2,e+6]),this.points.push([t+2,e+20]),this.points.push([t-2,e+20]),this.points.push([t-2,e+6]),this.points.push([t-10,e+14]),this.points.push([t-10,e+10]),this.points.push([t,e]),this.points},this.moving=function(){if(y.mouseDown){var t=y.mouse.x-y.mouseOri.x,s=y.mouse.y-y.mouseOri.y;i+=t,0==s&&0==t||this.points.forEach(function(t,e,o){t[0]+=i-i%(y.chart.px.bar.spacing+y.chart.px.bar.width),t[1]+=s}),i%=y.chart.px.bar.spacing+y.chart.px.bar.width,y.mouseOri.x=y.mouse.x,y.mouseOri.y=y.mouse.y}},this.draw=function(){o(this)}}function B(){this.name="downArrow",this.up=!1,this.id=f(),this.drawType=y.ARROW,this.points=[],this.pots=[],this.text=[],this.selectPotIndex=null;var i=0;this.init=function(){p();this.points=[];var t=y.chart.toPxX(y.chart.xToBar(y.mouse.x)),e=y.mouse.y;return this.points.push([t,e]),this.points.push([t+10,e-10]),this.points.push([t+10,e-14]),this.points.push([t+2,e-6]),this.points.push([t+2,e-20]),this.points.push([t-2,e-20]),this.points.push([t-2,e-6]),this.points.push([t-10,e-14]),this.points.push([t-10,e-10]),this.points.push([t,e]),this.points},this.moving=function(){if(y.mouseDown){var t=y.mouse.x-y.mouseOri.x,s=y.mouse.y-y.mouseOri.y;i+=t,0==s&&0==t||this.points.forEach(function(t,e,o){t[0]+=i-i%(y.chart.px.bar.spacing+y.chart.px.bar.width),t[1]+=s}),i%=y.chart.px.bar.spacing+y.chart.px.bar.width,y.mouseOri.x=y.mouse.x,y.mouseOri.y=y.mouse.y}},this.draw=function(){o(this)}}return{build:function(){return y.w=y.canvas.width(),y.h=y.canvas.height(),this},add:function(t,e){switch(t){case"percentLine":y.curLine=new h;break;case"godPercentLine":y.curLine=new g;break;case"wavePercentLines":y.curLine=new b;break;case"fibonacciSequence":y.curLine=new m;break;case"periodicLine":y.curLine=new x;break;case"lineSegment":y.curLine=new v;break;case"regressionLine":y.curLine=new w;break;case"rectLine":y.curLine=new k;break;case"singleLine":y.curLine=new T;break;case"upArrow":y.curLine=new S;break;case"downArrow":y.curLine=new B}},setType:function(t){y._drawType=t},resize:function(){return y.w=y.canvas.width(),y.h=y.canvas.height(),this},setChartData:function(t){y.chart=t,s()},ifNull:function(t){y.nullDrawObj=t},clean:function(){y.objLines=[],y.curLine=null,y.selectDrawObj=null,c.clearRect(0,0,y.w,y.h),y.nullDrawObj&&y.nullDrawObj()},deleteLine:function(){y.selectDrawObj&&(y.objLines.forEach(function(t,e){t.name==y.selectDrawObj.name&&t.id==y.selectDrawObj.id&&(y.objLines.splice(e,1),0==y.objLines.length&&y.nullDrawObj&&y.nullDrawObj())}),i())}}},C={upArrow:"#ff4056",downArrow:"#34ce6b",line:"#787878",text:"#20acea",pot:"#20acea"};function PtInPolygon(t,e){for(var o=0,s=0;s<e.length;s++){if(p1=e[s],p2=e[(s+1)%e.length],p1[1]!=p2[1])if(!(t[1]<Math.min(p1[1],p2[1])))if(!(t[1]>=Math.max(p1[1],p2[1])))(t[1]-p1[1])*(p2[0]-p1[0])/(p2[1]-p1[1])+p1[0]>t[0]&&o++}return o%2==1}Array.prototype.clone=function(){return JSON.parse(JSON.stringify(this))};